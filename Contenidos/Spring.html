<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="Victor Herrero Cazurro">
<title>Spring</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:block;vertical-align:middle;margin-left: auto;margin-right: auto;}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>Spring</h1>
<div class="details">
<span id="author" class="author">Victor Herrero Cazurro</span><br>
<span id="email" class="email">&lt;<a href="https://github.com/victorherrerocazurro">@vherrero11</a>&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Contenidos</div>
<ul class="sectlevel1">
<li><a href="#__que_es_spring">¿Que es Spring?</a></li>
<li><a href="#_ioc">IoC</a></li>
<li><a href="#_inyección_de_dependencias">Inyección de dependencias</a></li>
<li><a href="#_spring_context">Spring Context</a>
<ul class="sectlevel2">
<li><a href="#_applicationcontext">ApplicationContext</a></li>
<li><a href="#_creación_de_beans">Creación de Beans</a></li>
<li><a href="#_ambitos_scope">Ambitos (Scope)</a></li>
<li><a href="#_ciclo_de_vida">Ciclo de Vida</a></li>
<li><a href="#_extension_del_contexto">Extension del contexto</a></li>
<li><a href="#_inyeccion_de_dependencias">Inyeccion de Dependencias</a></li>
<li><a href="#_definición_de_colecciones">Definición de Colecciones</a></li>
<li><a href="#_ficheros_de_propiedades">Ficheros de propiedades</a></li>
<li><a href="#_herencia">Herencia</a></li>
<li><a href="#_autoinyección">Autoinyección</a></li>
<li><a href="#_internacionalización">Internacionalización</a></li>
<li><a href="#_profiles">Profiles</a></li>
<li><a href="#_applicationlistener_y_applicationevent">ApplicationListener y ApplicationEvent</a></li>
</ul>
</li>
<li><a href="#_spring_expression_language_spel">Spring Expression Language (SpEL)</a>
<ul class="sectlevel2">
<li><a href="#_operadores">Operadores</a></li>
</ul>
</li>
<li><a href="#_spring_aop">Spring AOP</a>
<ul class="sectlevel2">
<li><a href="#_definiciones_importantes">Definiciones importantes</a></li>
<li><a href="#_configuración_de_aop_con_spring">Configuración de AOP con Spring</a>
<ul class="sectlevel3">
<li><a href="#_pointcut">Pointcut</a></li>
<li><a href="#_aspect">Aspect</a></li>
<li><a href="#_advice">Advice</a></li>
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_advisor">Advisor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spring_jdbc">Spring Jdbc</a></li>
<li><a href="#_spring_orm">Spring ORM</a>
<ul class="sectlevel2">
<li><a href="#_hibernate">Hibernate</a></li>
<li><a href="#_jpa">Jpa</a></li>
<li><a href="#_gestion_de_excepciones">Gestion de Excepciones</a></li>
</ul>
</li>
<li><a href="#_transacciones">Transacciones</a>
<ul class="sectlevel2">
<li><a href="#_transacciones_con_jdbc">Transacciones con JDBC</a></li>
<li><a href="#_transacciones_con_hibernate">Transacciones con Hibernate</a></li>
<li><a href="#_transacciones_con_jpa">Transacciones con Jpa</a></li>
<li><a href="#_transacciones_con_jta">Transacciones con Jta</a></li>
<li><a href="#_transacciones_programaticas">Transacciones programaticas</a></li>
<li><a href="#_transacciones_declarativas">Transacciones declarativas</a></li>
<li><a href="#_configuracion_de_transacciones">Configuracion de Transacciones</a>
<ul class="sectlevel3">
<li><a href="#_propagation_behavior">Propagation Behavior</a></li>
<li><a href="#_isolation_level">Isolation Level</a></li>
<li><a href="#_read_only">Read Only</a></li>
<li><a href="#_timeout">Timeout</a></li>
<li><a href="#_rollback">Rollback</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_spring_data_jpa">Spring Data Jpa</a>
<ul class="sectlevel2">
<li><a href="#_introducción">Introducción</a></li>
<li><a href="#_querys_personalizadas">Querys Personalizadas</a></li>
<li><a href="#_paginación_y_ordenación">Paginación y Ordenación</a></li>
<li><a href="#_inserción_actualización">Inserción / Actualización</a></li>
</ul>
</li>
<li><a href="#_spring_web">Spring Web</a>
<ul class="sectlevel2">
<li><a href="#_ambitos">Ambitos</a></li>
<li><a href="#_recursos_jndi_del_servidor">Recursos JNDI del Servidor</a></li>
<li><a href="#_filtros">Filtros</a></li>
</ul>
</li>
<li><a href="#_spring_mvc">Spring MVC</a>
<ul class="sectlevel2">
<li><a href="#_introduccion">Introduccion</a></li>
<li><a href="#_arquitectura">Arquitectura</a>
<ul class="sectlevel3">
<li><a href="#_dispatcherservlet">DispatcherServlet</a></li>
<li><a href="#_contextloaderlistener">ContextLoaderListener</a></li>
</ul>
</li>
<li><a href="#_namespace_mvc">Namespace MVC</a></li>
<li><a href="#_acceso_a_recursos_directamente">Acceso a recursos directamente</a></li>
<li><a href="#_asignar_url_a_view">Asignar URL a View</a></li>
<li><a href="#_handlermapping">HandlerMapping</a>
<ul class="sectlevel3">
<li><a href="#_beannameurlhandlermapping">BeanNameUrlHandlerMapping</a></li>
<li><a href="#_simpleurlhandlermapping">SimpleUrlHandlerMapping</a></li>
<li><a href="#_controllerclassnamehandlermapping">ControllerClassNameHandlerMapping</a></li>
<li><a href="#_defaultannotationhandlermapping">DefaultAnnotationHandlerMapping</a></li>
<li><a href="#_requestmappinghandlermapping">RequestMappingHandlerMapping</a></li>
</ul>
</li>
<li><a href="#_controller">Controller</a>
<ul class="sectlevel3">
<li><a href="#__controller">@Controller</a></li>
<li><a href="#_activación_de_controller">Activación de @Controller</a></li>
<li><a href="#__pathvariable">@PathVariable</a></li>
<li><a href="#__requestparam">@RequestParam</a></li>
<li><a href="#__requestbody">@RequestBody</a></li>
<li><a href="#__responsebody">@ResponseBody</a></li>
<li><a href="#_model">Model</a></li>
</ul>
</li>
<li><a href="#_viewresolver">ViewResolver</a>
<ul class="sectlevel3">
<li><a href="#_internalresourceviewresolver">InternalResourceViewResolver</a></li>
<li><a href="#_xmlviewresolver">XmlViewResolver</a></li>
<li><a href="#_resourcebundleviewresolver">ResourceBundleViewResolver</a></li>
</ul>
</li>
<li><a href="#_view">View</a>
<ul class="sectlevel3">
<li><a href="#_abstractexcelview">AbstractExcelView</a></li>
<li><a href="#_abstractpdfview">AbstractPdfView</a></li>
<li><a href="#_jasperreportspdfview">JasperReportsPdfView</a></li>
<li><a href="#_mappingjackson2jsonview">MappingJackson2JsonView</a></li>
</ul>
</li>
<li><a href="#_formularios">Formularios</a>
<ul class="sectlevel3">
<li><a href="#_etiquetas">Etiquetas</a></li>
<li><a href="#_paths_absolutos">Paths Absolutos</a></li>
<li><a href="#_inicialización">Inicialización</a></li>
</ul>
</li>
<li><a href="#_validaciones">Validaciones</a>
<ul class="sectlevel3">
<li><a href="#_mensajes_personalizados">Mensajes personalizados</a></li>
<li><a href="#_anotaciones_jsr_303">Anotaciones JSR-303</a></li>
<li><a href="#_validaciones_custom">Validaciones Custom</a></li>
</ul>
</li>
<li><a href="#_internacionalización_i18n">Internacionalización - i18n</a></li>
<li><a href="#_interceptor">Interceptor</a>
<ul class="sectlevel3">
<li><a href="#_localechangeinterceptor">LocaleChangeInterceptor</a></li>
<li><a href="#_themechangeinterceptor">ThemeChangeInterceptor</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_rest">Rest</a>
<ul class="sectlevel2">
<li><a href="#_httpmessageconverter">HttpMessageConverter</a></li>
<li><a href="#_personalizar_el_mapping_de_la_entidad">Personalizar el Mapping de la entidad</a></li>
<li><a href="#_estado_de_la_petición">Estado de la petición</a></li>
<li><a href="#_localización_del_recurso">Localización del recurso</a></li>
<li><a href="#_cliente_se_servicios_con_resttemplate">Cliente se servicios con RestTemplate</a></li>
</ul>
</li>
<li><a href="#_spring_webservice">Spring WebService</a>
<ul class="sectlevel2">
<li><a href="#_servicio_standalone">Servicio Standalone</a></li>
<li><a href="#_cliente_servicio">Cliente Servicio</a></li>
<li><a href="#_mapping_de_entidades">Mapping de entidades</a></li>
<li><a href="#_despliegue_en_contenedor_web">Despliegue en contenedor web</a></li>
</ul>
</li>
<li><a href="#_spring_security">Spring Security</a>
<ul class="sectlevel2">
<li><a href="#_arquitectura_2">Arquitectura</a></li>
<li><a href="#_dependencias_con_maven">Dependencias con Maven</a></li>
<li><a href="#_filtro_de_seguridad">Filtro de seguridad</a></li>
<li><a href="#_contexto_de_seguridad">Contexto de Seguridad</a></li>
<li><a href="#_authenticationmanagerbuilder">AuthenticationManagerBuilder</a></li>
<li><a href="#_proteccion_de_recursos">Proteccion de recursos</a></li>
<li><a href="#_login">Login</a></li>
<li><a href="#_logout">Logout</a></li>
<li><a href="#_csrf">CSRF</a></li>
<li><a href="#_userdetailservice">UserDetailService</a></li>
<li><a href="#_encriptación">Encriptación</a></li>
<li><a href="#_remember_me">Remember Me</a></li>
<li><a href="#_seguridad_en_la_capa_transporte_https">Seguridad en la capa transporte - HTTPS</a></li>
<li><a href="#_sesiones_concurrentes">Sesiones concurrentes</a></li>
<li><a href="#_sessionfixation">SessionFixation</a></li>
<li><a href="#_libreria_de_etiquetas">Libreria de etiquetas</a></li>
<li><a href="#_expresiones_spel">Expresiones SpEL</a></li>
<li><a href="#_seguridad_de_métodos">Seguridad de métodos</a></li>
</ul>
</li>
<li><a href="#_spring_boot">Spring Boot</a>
<ul class="sectlevel2">
<li><a href="#_introducción_a_spring_boot">Introducción a Spring Boot</a></li>
<li><a href="#_instalación_de_spring_boot_cli">Instalación de Spring Boot CLI</a></li>
<li><a href="#_creación_e_implementación_de_una_aplicación">Creación e implementación de una aplicación</a></li>
<li><a href="#_recolección_de_métricas">Recolección de métricas</a></li>
<li><a href="#_uso_de_java_con_start_spring_io">Uso de Java con start.spring.io</a></li>
<li><a href="#_starters">Starters</a></li>
<li><a href="#_soporte_a_propiedades">Soporte a propiedades</a>
<ul class="sectlevel3">
<li><a href="#_configuracion_del_servidor">Configuracion del Servidor</a></li>
<li><a href="#_configuracion_del_logger">Configuracion del Logger</a></li>
<li><a href="#_configuracion_del_datasource">Configuracion del Datasource</a></li>
<li><a href="#_custom_properties">Custom Properties</a></li>
</ul>
</li>
<li><a href="#_jpa_2">JPA</a></li>
<li><a href="#_profiles_2">Profiles</a></li>
<li><a href="#_errores">Errores</a></li>
<li><a href="#_seguridad_de_las_aplicaciones">Seguridad de las aplicaciones</a></li>
<li><a href="#_soporte_jms">Soporte JMS</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="__que_es_spring">¿Que es Spring?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Framework para el de desarrollo de aplicaciones java.</p>
</div>
<div class="paragraph">
<p>Es un contenedor ligero de POJOS que se encarga de la creación de beans (Factoría de Beans) mediante la Inversión de control y la inyección de dependencias.</p>
</div>
<div class="paragraph">
<p>Creado en 2002 por Rod Johnson</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/intro_rod_jhonson.jpg" alt="intro rod jhonson">
</div>
</div>
<div class="paragraph">
<p>Spring se centra en proporcionar mecanismos de gestión de los objetos de negocio.</p>
</div>
<div class="paragraph">
<p>Spring es un framework idóneo para proyectos creados desde cero y orientados a pruebas unitarias, ya que permite independizar todos los componentes que forman a arquitectura de la aplicación.</p>
</div>
<div class="paragraph">
<p>Esta estructurado en capas, puede introducirse en proyectos de forma gradual, usando las capas que nos interesen, permaneciendo toda la arquitectura consistente.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/intro_arquitectura.png" alt="intro arquitectura">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ioc">IoC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Patrón de diseño que permite quitar la resposabilidad a los objetos de crear aquellos otros objetos que necesitan para llevar a cabo una acción, delegandola en otro componente, denominado Contedor o Contexto.</p>
</div>
<div class="paragraph">
<p>Los objetos simplemente ofrecen una determinada lógica y es el Contenedor que el orquesta esas logicas para montar la aplicación.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_inyección_de_dependencias">Inyección de dependencias</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Patrón de diseño que permite desacoplar dos algortimos que tienen una relación de necesidad, uno necesita de otro para realizar su trabajo.</p>
</div>
<div class="paragraph">
<p>Se basa en la definición de Interfaces que definan que son capaces de hacer los objetos, pero no como realizan dicho trabajo (implementación).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">interface</span> <span class="class">GestorPersonas</span> {

        <span class="type">void</span> alta(Persona persona);

}

<span class="type">interface</span> <span class="class">PersonaDao</span> {

        <span class="type">void</span> insertar(Persona persona);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y la definición de propiedades en los objetos, que representarán la necesidad, la dependencia, de tipo la Interface antes creada, asociado a un método de <strong>Set</strong>, inyeccion por setter y/o a un constructor, inyección por construcción, para proporcionar la capacidad de que un elemeno externo, el contenedor, inyecte la dependencia al objeto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">GestorPersonasImpl</span> {

        <span class="directive">private</span> PersonaDao dao;

        <span class="comment">//Inyeccion por contruccion</span>
        <span class="directive">public</span> GestorPersonasImpl(PersonaDao dao){
                <span class="local-variable">this</span>.dao = dao;
        }

        <span class="comment">//Inyeccion por setter</span>
        <span class="directive">public</span> setDao(PersonaDao dao){
                <span class="local-variable">this</span>.dao = dao;
        }

        <span class="directive">public</span> <span class="type">void</span> alta(Persona persona){
                dao.insertar(persona);
        }

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_context">Spring Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>El contexto de Spring describe una Factoria de Beans y la relación entre dichos Beans.</p>
</div>
<div class="paragraph">
<p>Se define con un objeto de tipo <strong>ApplicationContext</strong>.</p>
</div>
<div class="paragraph">
<p>Proporciona:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Factoría de beans, previamente configurados. Realizando la inyección de dependencias.</p>
</li>
<li>
<p>Manejo de textos con <strong>MessageSource</strong>, para internacionalización con i18n.</p>
</li>
<li>
<p>Acceso a recursos, como URLs y ficheros.</p>
</li>
<li>
<p>Propagación de eventos, para las beans que implementen ApplicationListener.</p>
</li>
<li>
<p>Carga de múltiples contextos en jerarquía, permitiendo enfocar cada uno en cada capa.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_applicationcontext">ApplicationContext</h3>
<div class="paragraph">
<p>ApplicationContext es una interfaz, de la que se proporcionan diferentes implementaciones:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ClassPathXmlApplicationContext &#8594; Carga el archivo de configuración desde un archivo XML que se encuentra en el classpath</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">appContext.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>FileSystemXmlApplicationContext &#8594; Carga el archivo de configuración desde un archivo en el sistema de ficheros</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext ctx = <span class="keyword">new</span> FileSystemXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">appContext.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>AnnotationConfigApplicationContext &#8594; Carga de archivo de configuracion anotado</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(Configuracion.class);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Para el caso de JavaConfig, se pueden registrar nuevos ficheros de configuración en caliente con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext();
context.register(Configuracion.class);
context.refresh();</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>XmlWebApplicationContext &#8594; Carga el archivo de configuración desde un XML contenido dentro de una aplicación web</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>
                /WEB-INF/daoContext.xml
                /WEB-INF/applicationContext.xml
        <span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>
<span class="tag">&lt;listener&gt;</span>
        <span class="tag">&lt;listener-class&gt;</span>
                org.springframework.web.context.ContextLoaderListener
        <span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dos formas de definir el contexto</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Por XML: Definiendo un fichero XML con los Beans del contexto de Spring.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:p</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/p</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        <span class="comment">&lt;!-- Inyección de dependencias por setter --&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plantilla</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Persona</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edad</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">99</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">altura</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.75</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>

        <span class="error">&lt;</span>!–- Inyección de dependencias por constructor --<span class="error">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pConstructor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Pepe</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">7.3</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Por JavaConfig: Definiendo una o varias clases anotadas con <strong>@Configuration</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>@Configuration
public class Configuracion {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creación_de_beans">Creación de Beans</h3>
<div class="paragraph">
<p>Existen varias formas de instanciación de Beans, dependiendo de la naturaleza del Bean o de si se definen en un XML, con anotaciones o con JavaConfig.</p>
</div>
<div class="paragraph">
<p>Dependiendo de la naturaleza de la clase existen dos casos particulares</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Factoría estática: Clase con un método estatico, en el ejemplo <strong>createInstance</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejemplos.Bean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createInstance</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Factoría instanciada:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejemplos.FactoriaDeBeans</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myFactoryBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">factory-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createInstance</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejemplos.Bean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para la definición con JavaConfig, se definen métodos anotados con @Bean en la clase de Configuracion</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> Persona juan(){
        <span class="keyword">return</span> <span class="keyword">new</span> Persona(<span class="string"><span class="delimiter">&quot;</span><span class="content">Juan</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para la definición con anotaciones, se emplearán alguna de las siguientes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@Component &#8594; Beans generales</p>
</li>
<li>
<p>@Repository &#8594; Beans de la capa de persistencia</p>
</li>
<li>
<p>@Controller &#8594; Beans de la capa de controlador en MVC</p>
</li>
<li>
<p>@Service &#8594; Beans de la capa de servicio</p>
</li>
<li>
<p>@Named (JSR-330)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para que estas anotaciones se puedan interpretar, habra que activarlas en el contexto, para ello:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Si el contexto se define con xml</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.curso.spring</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/context:component-scan&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Si el contexto se define con JavaConfig, en alguna de las clases de configuracion añadir la anotación @ConponentScan</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(basePackages={ <span class="string"><span class="delimiter">&quot;</span><span class="content">controllers</span><span class="delimiter">&quot;</span></span> })</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ambitos_scope">Ambitos (Scope)</h3>
<div class="paragraph">
<p>Se definen cuatro tipos de ambitos para una Bean</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Singleton: Una instancia única por JVM (por defecto).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejemplos.Bean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Prototype: Una nueva instancia cada vez que se pida la bean.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bean1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ejemplos.Bean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">prototype</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Request</p>
</li>
<li>
<p>Session</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Las beans singleton se instancian una vez que el contexto se carga. Esto se puede cambiar con la propiedad lazy-init="true" que indica al contexto que no cargue la bean hasta que se pida por primera vez.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ciclo_de_vida">Ciclo de Vida</h3>
<div class="paragraph">
<p>El ciclo de vida de una bean en el contexto de Spring, permite conocer el momento de la creación y de la destrucción de la bean.</p>
</div>
<div class="paragraph">
<p>Se pueden definir métodos que se ejecuten en esos dos momentos empleando las propiedades <strong>init-method</strong> y <strong>destroy-method</strong>.</p>
</div>
<div class="paragraph">
<p>Si se mantiene una homegeneidad en los nombres de los métodos para todas las Bean, se puede definir en la etiqueta &lt;beans/&gt; los nombres de los métodos para facilitar la configuración con las propiedades <strong>default-init-method</strong> y <strong>default-destroy-method</strong>.</p>
</div>
<div class="paragraph">
<p>Existen algunas interfaces que nos permiten manejar el ciclo de vida sin necesidad de definir las propiedades init-method y destroy-method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>InizializingBean &#8594; Obliga a la clase que la implemente a implementar el método afterPropertiesSet() que será llamado después de que todas las propiedades de la bean hayan sido configuradas.</p>
</li>
<li>
<p>DisposableBean &#8594; Obliga a implementar el método destroy que será llamado justo antes de destruir la bean por el contenedor.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_extension_del_contexto">Extension del contexto</h3>
<div class="paragraph">
<p>Se puede definir el contexto en multiples ficheros puediendose estos referenciar desde el principal.</p>
</div>
<div class="paragraph">
<p>Con XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;import</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cicloDeVida.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con Javaconfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@Import</span>(ConfiguracionPersistencia.class)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se pueden mezclar las dos formas de definir el contexto, importando desde la clase de configuración un fichero de XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ImportResource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:/config/seguridad.xml</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>O bien importando desde un XML una clase de configuracion, para lo unico que hay que hacer es escanear el paquete donde este dicha clase</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.curso.spring.configuracion</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>En las clases de configuración, se puede emplea la anotacion @Autowired para obtener la referencia a un Bean que este definido en otro fichero</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_inyeccion_de_dependencias">Inyeccion de Dependencias</h3>
<div class="paragraph">
<p>Las dependencias pueden ser de tipos complejos, por lo que se hará por referencia</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fernando</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javabeans.Persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pareja</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucia</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O de tipos simples, incluido String, que se hará por valor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fernando</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javabeans.Persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Fernando</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se pueden inyectar los Beans por Setter</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fernando</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javabeans.Persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pareja</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucia</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O por contructor</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lucia</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javabeans.Persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Otralucia</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edad</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">31</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pareja</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fernando</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se pueden inyectar Beans exclusivos para otro Bean, a los que solo este tiene acceso, suelen ser anonimos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fernando</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javabeans.Persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pareja</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javabeans.Persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Otralucia</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">edad</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">31</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pareja</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fernando</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede indicar de forma explicita que se quiere inyectar un valor NULL con la etiqueta &lt;null/&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fernando</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javabeans.Persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pareja</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;null</span><span class="tag">/&gt;</span><span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_definición_de_colecciones">Definición de Colecciones</h3>
<div class="paragraph">
<p>Se dispone de etiquetas particulares para la definición de colecciones</p>
</div>
<div class="ulist">
<ul>
<li>
<p>List</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;list&gt;</span>
        <span class="tag">&lt;value&gt;</span>a list element followed by a reference<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/list&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Set</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;set&gt;</span>
        <span class="tag">&lt;value&gt;</span>just some string<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/set&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Map</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;map&gt;</span>
        <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="error">“</span><span class="attribute-value">JUAN</span><span class="error">”</span> <span class="attribute-name">value</span>=<span class="error">“</span><span class="attribute-value">Un</span> <span class="attribute-name">valor</span><span class="error">”</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="error">“</span><span class="attribute-value">PEPE</span><span class="error">”</span> <span class="attribute-name">value-ref</span>=<span class="error">“</span><span class="attribute-value">miPersona</span><span class="error">”</span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/map&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Properties</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;props&gt;</span>
        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">adm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> administrator@somecompany.org<span class="tag">&lt;/prop&gt;</span>
<span class="tag">&lt;/props&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ficheros_de_propiedades">Ficheros de propiedades</h3>
<div class="paragraph">
<p>Se pueden obtener literales de ficheros de propiedades a traves de expresiones EL (SpEl), para ello hay que cargar los ficheros properties como <strong>PropertyPlaceholderConfigurer</strong></p>
</div>
<div class="paragraph">
<p>Desde el XML definiendo un bean</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locations</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;array&gt;</span>
                        <span class="tag">&lt;value&gt;</span>configuracion/configuracionBD.properties<span class="tag">&lt;/value&gt;</span>
                        <span class="tag">&lt;value&gt;</span>configuracion/configuracionServicio.properties<span class="tag">&lt;/value&gt;</span>
                <span class="tag">&lt;/array&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O de forma mas sencilla empleando el espacio de nombres <strong>context</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:property-placeholder</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">db.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O desde JavaConfig definiendo un bean</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> PropertyPlaceholderConfigurer propertyPlaceholderConfigurer() {

        PropertyPlaceholderConfigurer propertyPlaceholderConfigurer = <span class="keyword">new</span> PropertyPlaceholderConfigurer();
        propertyPlaceholderConfigurer.setLocation(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">db.properties</span><span class="delimiter">&quot;</span></span>));

        <span class="keyword">return</span> propertyPlaceholderConfigurer;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y posteriormente se pueden refereciar las properties desde el XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.DataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${service.provincias.password}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${service.provincias.url}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${service.provincias.user}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>o desde las clases con la anotacion @Value</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource(
                <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${dbDriver}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> driverClass,
                <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${dbUrl}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> jdbcUrl,
                <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${dbUsername}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> user,
                <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${dbPassword}</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> password) {
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Notar que el acceso a las propiedades se hace con la sintaxis ${} y no #{}, esta última esta reservada a SpEL</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Otra alternativa, sería emplear la anotacion <strong>PropertySource</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:db.properties</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ApplicationConfiguration</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y referenciar las propiedades a través del Bean <strong>Environment</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Environment environment;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Leyendo posteriormente las propiedades</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">environment.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">dbDriver</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_herencia">Herencia</h3>
<div class="paragraph">
<p>Se pueden reutilizar configuraciones de Beans a través de la herencia, para ello se dispone de dos propiedades</p>
</div>
<div class="ulist">
<ul>
<li>
<p>abstract &#8594; Si es <strong>true</strong> indica que la bean declarada es abstracta, es decir, no podrá ser nunca instanciada.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">personaGenerica</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Persona</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">abstract</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;null</span> <span class="tag">/&gt;</span><span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">28001</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>parent &#8594; Indica el id de otra bean que se utilizará como padre. Concepto similar al extends en las clases Java.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">julio</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parent</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">personaGenerica</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Julio</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_autoinyección">Autoinyección</h3>
<div class="paragraph">
<p>Consiste en la inyección de dependencias automática sin necesidad de indicarla en la configuración de una bean.</p>
</div>
<div class="paragraph">
<p>Se proporcionan 4 tipos de autowiring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Por nombre (byName) &#8594; El contenedor busca un bean cuyo nombre (ID) sea el mismo que el nombre de la propiedad. Si no se encuentra coincidencia la propiedad se devolverá sin dependencia.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Persona</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">autowire</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">byName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direccion</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Direccion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">28900</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Por tipo (byType) &#8594; El contenedor busca un único bean cuyo tipo coincida con el tipo de la propiedad a inyectar. Si no se encuentra coincidencia la propiedad se devolverá sin dependencia y si se encuentra mas de una coincidencia el contenedor lanzará una excepción del tipo <strong>org.springframework.beans.factory.UnsatisfiedDependencyException</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Direccion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">28900</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Persona</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">autowire</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">byType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Por constructor (constructor) &#8594; El contenedor busca algun bean que contenga un constructor con el tipo del bean que se quiere inyectar. Si no se encuentra coincidencia la propiedad se devolverá sin dependencia y si se encuentra mas de una coincidencia el contenedor lanzará una excepción del tipo <strong>org.springframework.beans.factory.UnsatisfiedDependencyException</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dir</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Direccion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">28900</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Persona</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">autowire</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">constructor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para el ejemplo la clase Persona debe tener un constructor del tipo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Persona(Direccion dir){
        <span class="local-variable">this</span>.direccion= dir;
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Autodetectado (autodetect) &#8594; Se intenta realizar el autowiring por constructor. Si no se produce intentará realizarlo por tipo. Si no se encuentra coincidencia la propiedad se devolverá sin dependencia y si se encuentra mas de una coincidencia el contenedor lanzará una excepción del tipo <strong>org.springframework.beans.factory.UnsatisfiedDependencyException</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">beans.Persona</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">autowire</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autodetect</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede configurar la autoinyección con anotaciones, empleando la anotacion @Autowired, aplicado al constructor o al método de set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Negocio</span> {

        <span class="annotation">@Autowired</span>
        <span class="directive">private</span> Persistencia persistencia;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se puede emplear @Inject del estandar JSR-330</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Named</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Negocio</span> {

        <span class="annotation">@Inject</span>
        <span class="directive">private</span> Persistencia persistencia;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para el uso de las anotaciones, se ha de configurar el contexto para que sea capaz de interpretarlas, esto se consigue de dos formas con la etiqueta &lt;context:component-scan&gt; o con &lt;context:annotation-config&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:annotation-config</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La autoinyeccion si se define en el atributo o en el método de set, es por tipo, si se define en el constructor es por constructor y si se desea realizar una autoinyección por nombre, se dispone de @Qualifier, que asociado a la propiedad o al parametro del setter o el constructor, permite indicar el Id del bean a inyectar</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">[source, java]</code></pre>
</div>
</div>
<div class="paragraph">
<p>@Component
public class Negocio {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>	@Autowired
	@Qualifier("dao")
	private Persistencia persistencia;
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_internacionalización">Internacionalización</h3>
<div class="paragraph">
<p><strong>ApplicationContext</strong> extiende una interfaz llamada <strong>MessageSource</strong>, la cual proporciona funcionalidades para el manejo de properties dependientes del Locale.</p>
</div>
<div class="paragraph">
<p>Cuando se carga el contexto, automáticamente busca la bean MessageSource definida en la configuración, esta bean debe llamarse messageSource, si no se encuentra, se instancia un StaticMessageSource vacío.</p>
</div>
<div class="paragraph">
<p>Se proporcionan varias implementaciones de MessageSource</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ResourceBundleMessageSource.</p>
</li>
<li>
<p>StaticMessageSource.</p>
</li>
<li>
<p>ReloadableResourceBundleMessageSource.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El más usado es el primero, que permite definir las ubicaciones de los ficheros .properties que se van a utilizar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.ResourceBundleMessageSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basenames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;list&gt;</span>
                        <span class="tag">&lt;value&gt;</span>format<span class="tag">&lt;/value&gt;</span>
                        <span class="tag">&lt;value&gt;</span>exceptions<span class="tag">&lt;/value&gt;</span>
                        <span class="tag">&lt;value&gt;</span>windows<span class="tag">&lt;/value&gt;</span>
                <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso, deberemos tener tres ficheros en el raíz del classpath, con los nombres format.properties, exceptions.properties, windows.properties. Admitiendo el resto de ficheros con los sufijos de locale para internacionalización.</p>
</div>
<div class="paragraph">
<p>La interface <strong>MessageSource</strong> proporciona los siguientes métodos para el manejo de los properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String getMessage(String code, Object[] args, String default, Locale loc) &#8594; Método básico para recuperar un mensaje del MessageSource. Si no se encuentra un mensaje, se usa el default.</p>
</li>
<li>
<p>String getMessage(String code, Object[] args, Locale loc) &#8594; similar pero sin mensaje por defecto.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span><span class="type">[]</span> string = {<span class="string"><span class="delimiter">&quot;</span><span class="content">Alta</span><span class="delimiter">&quot;</span></span>};
context.getMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.cliente.alta.titulo</span><span class="delimiter">&quot;</span></span>, string, <span class="predefined-type">Locale</span>.getDefault());</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>String getMessage(MessageSourceResolvable resolvable, Locale locale) &#8594; En este caso, MessageSourceResolvable, agrupa los argumentos de los métodos anteriores.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_profiles">Profiles</h3>
<div class="paragraph">
<p>Permiten activar Beans definidos en el contexto.</p>
</div>
<div class="paragraph">
<p>Con XML basta con incluir la propiedad profile en la etiqueta <strong>&lt;beans&gt;</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">desarrollo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicio</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">con.curso.spring.ServicioImpl</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con Javaconfig basta con incluir la anotacion <strong>@Profile</strong> en la clase Configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">desarrollo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Configuracion</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>o en el Bean que se quiera activar o desactivar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Configuracion</span> {
        <span class="annotation">@Bean</span>
        <span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">desarrollo</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Servicio servicio() {
        <span class="keyword">return</span> <span class="keyword">new</span> ServicioImpl();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez declarado los Beans pertenecientes al Profile, habrá que activar el Profile deseado, para ello se emplea una variable de entorno que puede ser definida de varias formas</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A traves del contexto de Spring</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(Configuracion.class);
        context.getEnvironment().setActiveProfiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">desarrollo</span><span class="delimiter">&quot;</span></span>);
        context.refresh();
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>U obteniendo la referencia al objeto generado en el contexto que permite interaccionar con las varialbes de entorno <strong>ConfigurableEnvironment</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Configuracion</span> {
        <span class="annotation">@Autowired</span>
        <span class="directive">private</span> ConfigurableEnvironment env;

        <span class="annotation">@PostConstruct</span>
        <span class="directive">public</span> <span class="type">void</span> init(){
                env.setActiveProfiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">someProfile</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Estableciendo directamente la variable de entorno programaticamente con el API de la JRE</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
          <span class="predefined-type">System</span>.setProperty(AbstractEnvironment.ACTIVE_PROFILES_PROPERTY_NAME, <span class="string"><span class="delimiter">&quot;</span><span class="content">desarrollo</span><span class="delimiter">&quot;</span></span>);
          AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(Configuracion.class);
        }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Estableciendo el parametro de la JVM al arrancarla</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">-Dspring.profiles.active=desarrollo</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Estableciendo la variable de entorno en el SO</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">export spring_profiles_active=dev</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Para aplicaciones Web, definiendo del el fichero web.xml un <strong>context-param</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>spring.profiles.active<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>live<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>O para aplicaciones Web que no definan el web.xml</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InicializadorWeb</span> <span class="directive">implements</span> WebApplicationInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext servletContext) <span class="directive">throws</span> ServletException {
        servletContext.setInitParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.profiles.active</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">desarrollo</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>En Test con la anotacion @ActiveProflies</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="annotation">@ContextConfiguration</span>(classes = { Configuracion.class })
<span class="annotation">@ActiveProfiles</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">desarrollo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ServicioTest</span> {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_applicationlistener_y_applicationevent">ApplicationListener y ApplicationEvent</h3>
<div class="paragraph">
<p>Si una bean implementa ApplicationListener, cada vez que se publica un ApplicationEvent en el ApplicationContext, la bean es notificada.</p>
</div>
<div class="paragraph">
<p>Hay tres eventos proporcionados por Spring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ContextRefreshedEvent &#8594; Evento publicado cuando el ApplicationContext se inicializa o refresca.</p>
</li>
<li>
<p>ContextClosedEvent &#8594; Evento publicado cuando se cierra el ApplicationContext.</p>
</li>
<li>
<p>RequestHandledEvent &#8594; Un evento específico para aplicaciones web que avisa que todas las beans de una petición HTTP han sido servida.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pudiendose definir Listener asociados a cada uno de dichos eventos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Escuchador</span> <span class="directive">implements</span> ApplicationListener&lt;ContextRefreshedEvent&gt;{
        <span class="directive">public</span> <span class="type">void</span> onApplicationEvent(ContextRefreshedEvent event) {
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Se ha lanzado un evento de inicio: </span><span class="delimiter">&quot;</span></span> + event.getSource());
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cuando un escuchador de evento (ApplicationListener) recibe una notificación de un evento, se invoca su método onApplicationEvent.</p>
</div>
<div class="paragraph">
<p>Se pueden publicar eventos llamando al método <strong>publishEvent()</strong> de ApplicationContext, pasando como parámetro una instancia de una clase que implemente <strong>ApplicationEvent</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">context.publishEvent(<span class="keyword">new</span> MiEvento(<span class="string"><span class="delimiter">&quot;</span><span class="content">origen</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Los Listener recben el evento de forma síncrona, bloqueándo el hilo hasta terminar de procesar el evento.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_expression_language_spel">Spring Expression Language (SpEL)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Las expresiones SpEL siguen el formato #{ } y no ${}, que se reserva para el acceso a los properties.</p>
</div>
<div class="paragraph">
<p>Lenguaje de expresiones con el que Spring permite realizar</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Referencias a Beans por Id.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="SpEL">#{servicio}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Invocar metodos y acceder a propiedades.</p>
</li>
<li>
<p>Definir espresiones matematicas, relacionales y logicas</p>
</li>
<li>
<p>Busquedas por expresiones regulares</p>
</li>
<li>
<p>Manipulacion de colecciones</p>
</li>
<li>
<p>Acceso a propiedades del sistema</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="SpEL">#{systemProperties['disc.title']}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_operadores">Operadores</h3>
<div class="paragraph">
<p>El operador T(), permite referenciar a clases con métodos estaticos para invocarlos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="SpEL">#{T(System).currentTimeMillis()}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_aop">Spring AOP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Framework que proporciona capacidades para definir beans que actuan como Aspectos.</p>
</div>
<div class="paragraph">
<p>Un Aspecto es una funcionalidad o tarea genérica que puede afectar a varias/muchas funcionalidades/clases, sin formar parte de la funcionalidad en sí, se les denomina servicios horizontales declarativos.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/aop_esquema.png" alt="aop esquema">
</div>
</div>
<div class="paragraph">
<p>Algunos ejemplos son el logging, la gestión transaccional y la seguridad.</p>
</div>
<div class="sect2">
<h3 id="_definiciones_importantes">Definiciones importantes</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Target Object</strong>: Objeto observado por uno o más aspectos.</p>
</li>
<li>
<p><strong>Proxy</strong>: Objeto que suplanta al <strong>Target Object</strong> permitiendo la ejecución del <strong>Aspecto</strong>.</p>
</li>
<li>
<p><strong>Joint Point</strong>: Punto en la ejecución de un programa al que se asocia la ejecución de un aspecto en Spring todos los Joint Point son ejecuciones de métodos.</p>
</li>
<li>
<p><strong>Advice</strong>: Momento respecto al <strong>Joint Point</strong> en el que se ejecuta el Aspecto. Puede tomar valores como: around, before y after.</p>
</li>
<li>
<p><strong>Point Cut</strong>: Predicado que selecciona <strong>Join Point</strong>. Un <strong>Advice</strong> se asocia a una expresión <strong>Point Cut</strong> y se ejecuta en cualquier <strong>Join Point</strong> que coincide con el <strong>Point Cut</strong>.</p>
</li>
<li>
<p><strong>Introduction</strong>: <strong>Aspecto</strong> que permite declarar nuevos métodos o campos de un tipo.</p>
</li>
<li>
<p><strong>Advisor</strong>: Es un Aspecto, que define un único <strong>Advice</strong>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configuración_de_aop_con_spring">Configuración de AOP con Spring</h3>
<div class="paragraph">
<p>La definición de AOP en Spring empleando configuración por XML, se basa en el espacio de nombres <strong>aop</strong>, teniendo que estar toda la configuración contenida en la etiqueta <strong>&lt;aop:config&gt;</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:config&gt;</span>
        <span class="tag">&lt;aop:pointcut</span>
                <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.ejemplo.Negocio.*(com.ejemplo.Persona)) </span><span class="entity">&amp;amp;</span><span class="entity">&amp;amp;</span> <span class="content">args(p)</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicioPointCut</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;aop:aspect</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aspecto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;aop:after</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">despuesDeServicio</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicioPointCut</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">arg-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;aop:before</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antesDeServicio</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicioPointCut</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">arg-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;aop:around</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">durante</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicioPointCut</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">arg-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/aop:aspect&gt;</span>
        <span class="tag">&lt;aop:aspect&gt;</span>
                <span class="tag">&lt;aop:declare-parents</span>
                        <span class="attribute-name">types-matching</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.Negocio+</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">implement-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.AmpliacionServicio</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">default-impl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.AmpliacionServicioImpl</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/aop:aspect&gt;</span>
<span class="tag">&lt;/aop:config&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De emplearse las anotaciones, se han de activar, en los XML con</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:aspectj-autoproxy</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y con Javaconfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableAspectJAutoProxy</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Configuracion</span> {

}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_pointcut">Pointcut</h4>
<div class="paragraph">
<p>Predicado definido con el lenguaje de AspectJ, que selecciona métodos de Beans de Spring, que cuando se vayan a ejecutar provocarán la ejecución de un Aspecto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:pointcut</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.ejemplo.Negocio.*(com.ejemplo.Persona)) </span><span class="entity">&amp;amp;</span><span class="entity">&amp;amp;</span> <span class="content">args(p)</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicioPointCut</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Las expresiones de AspectJ que definen el predicado, se estructuran así:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="AspectJ">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern) throws-pattern?)</code></pre>
</div>
</div>
<div class="paragraph">
<p>El siguiente ejemplo afectará a las llamadas de todos los métodos públicos de todas las clases del paquete <strong>com.ats.test</strong>, independientemente de los parametros que reciban o del tipo de datos retornados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="AspectJ">execution(public com.ats.test.*.*(..))</code></pre>
</div>
</div>
<div class="paragraph">
<p>El * es un comodín para los tipos de acceso, nombres de clase y métodos, mientras que para los argumentos de un método es <strong>..</strong>.</p>
</div>
<div class="paragraph">
<p>Cuando en la seleccion, se quiere hacer participe a los argumentos, se pone el tipo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="AspectJ">execution(* transfer(int,int))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se pueden combinar expresiones con los operadores &amp;&amp;, || y !, con el significado tradicional que tienen en java.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>En el caso de definición XML, debe usarse en vez de &amp;&amp;, <strong>&amp;&amp;</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Los <strong>Point Cut</strong> soportados por Spring son</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>execution</strong> –&gt; para seleccionar la ejecución de un método</p>
</li>
<li>
<p><strong>within</strong> –&gt; para seleccionar la ejecución de cualquier metódo de un tipo especificado.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="AspectJ">within(com.ats.test.*)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>this</strong> –&gt; para seleccionar la ejecución de algún método de una bean cuyo <strong>proxy</strong> implemente la interfaz especificada.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="AspectJ">this(com.ats.AccountService)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>target</strong> &#8594; para seleccionar ejecución de algún método de una bean cuyo <strong>target object</strong> implemente la interfaz especificada.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="AspectJ">target(com.ats.services.MyService)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>args</strong> &#8594; seleccionar ejecución de algún método de un tipo cuyos argumentos son instancias de los tipos dados.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_aspect">Aspect</h4>
<div class="paragraph">
<p>Define el Bean de Spring que contiene la logica que se desea ejecutar y los <strong>Advice</strong> que definen cuando se ha de ejecutar cada uno de los métodos de Bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aspecto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Cuando se define un <strong>Aspecto</strong>, se esta asociando un Bean, el Aspecto, con un método a suplantar seleccionado por un PointCut y un momento en el que se ha de ejecutar un método del Aspecto respecto a la ejecución del método interceptado (Advice).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_advice">Advice</h4>
<div class="paragraph">
<p>Relación entre el método del <strong>Aspecto</strong> y el momento cuando se ha de ejecutar.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Before advice</strong> &#8594; Se ejecuta antes del join point, pero no puede cortar el flujo de ejecución, a no ser que lance una excepción.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:before</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antesDeServicio</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicioPointCut</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">arg-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.ejemplo.Negocio.*(com.ejemplo.Persona)) &amp;amp;&amp;amp; args(p)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> antesDeServicio(Persona p){
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Se va a proceder a ejecutar el servicio con la persona: </span><span class="delimiter">&quot;</span></span> + p);
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>After returning advice</strong> &#8594; Se ejecuta cuando el joint point ha sido ejecutado de forma correcta.</p>
</li>
<li>
<p><strong>After throwing advice</strong> &#8594; Se ejecuta cuando el joint point termina lanzando una excep.</p>
</li>
<li>
<p><strong>After (finally) advice</strong> &#8594; Se ejecuta tanto al retornar correctamente, como cuando se lanza una excep.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:aspect</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aspecto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;aop:after</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">despuesDeServicio</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicioPointCut</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">arg-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@After</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.ejemplo.Negocio.*(com.ejemplo.Persona)) &amp;amp;&amp;amp; args(p)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> despuesDeServicio(Persona p) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Se ha terminado de ejecutar el servicio con la persona: </span><span class="delimiter">&quot;</span></span> + p);
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Around advice</strong> &#8594; Permite ejecutar acciones antes y después de un join point. Puede cortar la ejecución devolviendo el valor que considere o lanzando una excepción.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:around</span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">durante</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pointcut-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicioPointCut</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">arg-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Around</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.ejemplo.Negocio.*(com.ejemplo.Persona)) &amp;amp;&amp;amp; args(p)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> durante(ProceedingJoinPoint joinPoint, Persona p){
        <span class="type">long</span> inicio = <span class="predefined-type">System</span>.currentTimeMillis();
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Antes de ejecutar el servicio con la persona </span><span class="delimiter">&quot;</span></span> + p);
        p.setEdad(<span class="integer">123</span>);
        <span class="keyword">try</span> {
                joinPoint.proceed();
        } <span class="keyword">catch</span> (<span class="predefined-type">Throwable</span> e) {
                e.printStackTrace();
        }
        <span class="type">long</span> duracion = <span class="predefined-type">System</span>.currentTimeMillis() - inicio;
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Despues de ejecutar el servicio, habiendo durado la operaci�n: </span><span class="delimiter">&quot;</span></span> + duracion + <span class="string"><span class="delimiter">&quot;</span><span class="content"> con la persona </span><span class="delimiter">&quot;</span></span> + p);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_introduction">Introduction</h4>
<div class="paragraph">
<p>Define la extensión de un determinado tipo de Bean con los mñetodos que define la interface, empleando una implementación por defecto de dichos métodos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:aspect&gt;</span>
        <span class="tag">&lt;aop:declare-parents</span>
                <span class="attribute-name">types-matching</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.Negocio+</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">implement-interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.AmpliacionServicio</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">default-impl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.AmpliacionServicioImpl</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/aop:aspect&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_advisor">Advisor</h4>
<div class="paragraph">
<p>Para la definición del Bean que represente el <strong>Aspecto</strong>, se emplearán las siguientes interfaces</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MethodBeforeAdvice</p>
</li>
<li>
<p>ThrowsAdvice</p>
</li>
<li>
<p>AfterReturningAdvice</p>
</li>
<li>
<p>MethodInterceptor</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AdvisorBefore</span> <span class="directive">implements</span> MethodBeforeAdvice{
        <span class="directive">public</span> <span class="type">void</span> before(<span class="predefined-type">Method</span> method, <span class="predefined-type">Object</span><span class="type">[]</span> args, <span class="predefined-type">Object</span> target) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
                <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Antes de ejecutar el metodo</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para la definición del <strong>Advisor</strong>, se asociará el <strong>Point Cut</strong> con el Bean que implemente alguna de las interfaces anteriores.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;aop:advisor</span> <span class="attribute-name">advice-ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">advisorBefore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pointcut</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* com.ejemplo.Negocio.*(com.ejemplo.Persona))</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_jdbc">Spring Jdbc</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Framework que pretende dar soporte avanzado a la especificación JDBC de Java.</p>
</div>
<div class="paragraph">
<p>Se basa en la utilización de un Bean de tipo <strong>JdbcTemplate</strong>, que permite abstraer de la complejidad del Api de JDBC, ya que gestiona la conexión y el procesamiento de los <strong>ResultSet</strong>, para esto último ayudado de una implementación de <strong>RowMapper&lt;T&gt;</strong>.</p>
</div>
<div class="paragraph">
<p>Spring tambien ofrece una clase de soporte <strong>JdbcDaoSupport</strong> que embebe el uso de <strong>JdbcTemplate</strong>.</p>
</div>
<div class="paragraph">
<p>Para emplearlo, habra que definir una clase que extienda de <strong>JdbcDaoSupport</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">JdbcTemplateClienteDao</span> extend JdbcDaoSupport <span class="directive">implements</span> ClienteDao {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez definida la clase, desde los métodos se tiene acceso a una instancia de <strong>JdbcTemplate</strong> con <strong>getJdbcTemplate()</strong>.</p>
</div>
<div class="paragraph">
<p>Y es esta clase <strong>JdbcTemplate</strong>, la que proporciona las funcionalidades para realizar las consultas, a traves de</p>
</div>
<div class="ulist">
<ul>
<li>
<p>query()</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;CLiente&gt; clientes = getJdbcTmplate().query(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM CLIENTE</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> ClienteRowMapper());</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>queryForObject()</p>
</li>
<li>
<p>update()</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; param = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;();
                param.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span>, cliente.getNombre());
                param.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">direccion</span><span class="delimiter">&quot;</span></span>, cliente.getDireccion());
                param.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">telefono</span><span class="delimiter">&quot;</span></span>, cliente.getTelefono());
getTemplate().update(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into clientes.cliente (nombre,direccion,telefono) values (:nombre,:direccion,:telefono)</span><span class="delimiter">&quot;</span></span>, param);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los métodos de la plantilla aceptarán de forma generica un String que represente la consulta a ejecutar, que se puede parametrizar con la sintaxis <strong>:&lt;nombre de parametro&gt;</strong> y un mapa, donde las claves son los nombres de los parametros de la consulta.</p>
</div>
<div class="paragraph">
<p>Siendo <strong>RowMapper</strong> una clase de utilleria que abstrae la extracción de los datos del <strong>ResultSet</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">RowMapperClienteImpl</span> <span class="directive">implements</span> <span class="predefined-type">RowMapper</span>&lt;Cliente&gt; {
        <span class="directive">public</span> Cliente mapRow(<span class="predefined-type">ResultSet</span> rs, <span class="type">int</span> rowNum) <span class="directive">throws</span> <span class="exception">SQLException</span> {
                <span class="keyword">return</span> <span class="keyword">new</span> Cliente(rs.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>),
                                rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span>),
                                rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">direccion</span><span class="delimiter">&quot;</span></span>),
                                rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">telefono</span><span class="delimiter">&quot;</span></span>)
                                );
        }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_orm">Spring ORM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Framework que permite la integración de otros framework Orm como Hibernate, Jpa o MyIbatis.</p>
</div>
<div class="paragraph">
<p>De forma analoga a lo que sucede con JDBC, se proporcionan plantillas que encapsulan el manejo del API del ORM, facilitando la creación de la capa de persistencia, así se dispone de</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HibernateTemplate</p>
</li>
<li>
<p>JpaTemplate</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Estas plantillas dependerán de objetos del API correspondiente como son <strong>SessionFactory</strong> o <strong>EntityManagerFactory</strong></p>
</div>
<div class="sect2">
<h3 id="_hibernate">Hibernate</h3>
<div class="paragraph">
<p>Spring proporciona las siguientes implementaciones para construir los objetos <strong>SessionFactory</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AnnotationSessionFactoryBean &#8594; Permite interpretar las anotaciones <strong>@Entity</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">packagesToScan</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;list&gt;</span>
                        <span class="tag">&lt;value&gt;</span>com.curso.spring<span class="tag">&lt;/value&gt;</span>
                <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernateProperties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;props&gt;</span>
                        <span class="tag">&lt;propkey</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">dialect</span><span class="error">&quot;</span><span class="tag">&gt;</span>org.hibernate.dialect.DerbyDialect<span class="tag">&lt;/prop&gt;</span>
                <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En vez del <strong>packageToScan</strong>, se pueden indicar las <strong>annotatedClases</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">annotatedClasses</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;list&gt;</span>
                        <span class="tag">&lt;value&gt;</span>com.entidades.Persona<span class="tag">&lt;/value&gt;</span>
                        <span class="tag">&lt;value&gt;</span>com.entidades.Factura<span class="tag">&lt;/value&gt;</span>
                <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;propertyname</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">hibernateProperties</span><span class="error">&quot;</span><span class="tag">&gt;</span>
                <span class="tag">&lt;props&gt;</span>
                        <span class="tag">&lt;propkey</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">dialect</span><span class="error">&quot;</span><span class="tag">&gt;</span>org.hibernate.dialect.DerbyDialect<span class="tag">&lt;/prop&gt;</span>
                <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>LocalSessionFactoryBean</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.hibernate3.LocalSessionFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappingResources</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;list&gt;</span>
                        <span class="tag">&lt;value&gt;</span>Persona.hbm.xml<span class="tag">&lt;/value&gt;</span>
                <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernateProperties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;props&gt;</span>
                        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dialect</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>org.hibernate.dialect.DerbyDialect<span class="tag">&lt;/prop&gt;</span>
                <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jpa">Jpa</h3>
<div class="paragraph">
<p>Spring proporciona las siguientes implementaciones para construir los objetos <strong>EntityManager</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>LocalContainerEntityManagerFactoryBean &#8594; Los Bean de entidad son gestionados por el contenedor, por lo que no es necesario definir el fichero <strong>META-INF/persistence.xml</strong> y  en cambio si será necesario definir un <strong>VendorAdapter</strong> de entre los que proporciona Spring, dependiendo de la implementacion de JPA a emplear.</p>
</li>
<li>
<p>EclipseLinkJpaVendorAdapter.</p>
</li>
<li>
<p>HibernateJpaVendorAdapter.</p>
</li>
<li>
<p>OpenJpaVendorAdapter.</p>
</li>
<li>
<p>TopLinkJpaVendorAdapter.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jpaVendorAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">database</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Derby</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">showSql</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">generateDdl</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">databasePlatform</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate.dialect.DerbyDialect</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ademas de la definicion del Bean de Spring</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emf</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jpaVendorAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jpaVendorAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">packagesToScan</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.cursospring.modelo.entidad</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jpaProperties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;props&gt;</span>
                        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>org.hibernate.dialect.DerbyDialect<span class="tag">&lt;/prop&gt;</span>
                        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.show_sql</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/prop&gt;</span>
                        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.format_sql</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/prop&gt;</span>
                        <span class="comment">&lt;!--&lt;prop key=&quot;hibernate.current_session_context_class&quot;&gt;thread&lt;/prop&gt;--&gt;</span><span class="comment">&lt;!-- &quot;jta&quot;, &quot;thread&quot; y &quot;managed&quot; --&gt;</span>
                        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>create<span class="tag">&lt;/prop&gt;</span><span class="comment">&lt;!-- create, validate, update --&gt;</span>
                        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.default_schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>CLIENTES<span class="tag">&lt;/prop&gt;</span>
                <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>LocalEntityManagerFactoryBean &#8594; Los Bean de entidad son gestionados por la aplicación, por lo que hay que definir el fichero <strong>META-INF/persistence.xml</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;persistence</span> <span class="attribute-name">xmlns</span>=<span class="attribute-value">http:</span><span class="error">/</span><span class="error">/</span><span class="attribute-name">java.sun.com</span><span class="error">/</span><span class="attribute-name">xml</span><span class="error">/</span><span class="attribute-name">ns</span><span class="error">/</span><span class="attribute-name">persistence</span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;persistence-unitname</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">miPersistenceUnit</span><span class="error">&quot;</span><span class="tag">&gt;</span>
                <span class="tag">&lt;class&gt;</span>com.entidades.Persona<span class="tag">&lt;/class&gt;</span>
                <span class="tag">&lt;properties&gt;</span><span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/persistence-unit&gt;</span>
<span class="tag">&lt;/persistence&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y se define el Bean de Spring</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emf</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.LocalEntityManagerFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistenceUnitName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">miPersistenceUnit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_gestion_de_excepciones">Gestion de Excepciones</h3>
<div class="paragraph">
<p>Se proporciona un API de excepciones mas extendido que el que proporciona JDBC, con su <strong>SQLException</strong>.</p>
</div>
<div class="paragraph">
<p>Hibernate, por ejemplo, también ofrece un conjunto de excepciones ampliado sobre JDBC, el problema, es que son solo útiles para este framework, si queremos independencia con el framework de persistencia, podemos emplear el API de excepciones de Spring.</p>
</div>
<div class="paragraph">
<p>Dado que muchas de las excepciones no son recuperables, Spring opta por ofrecer una jerarquía de excepciones <strong>unchecked</strong> (RuntimeException), es decir, ¿sino no se puede arreglar el problema porque esa necesidad añadir try o throws?</p>
</div>
<div class="paragraph">
<p>Para que Spring capture las excepciones lanzadas por hibernate y las convierta en excecpiones de Spring, hay que definir un nuevo bean el en contexto de Spring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este bean, se encarga  de capturar todas las excepciones lanzadas por clases anotadas con @repository y realizar la conversión.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transacciones">Transacciones</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Una transacción, es una operación de todo o nada, compuesta por una serie de suboperaciones, que se han de llevar a cabo como una unidad o no realizarse ninguna.</p>
</div>
<div class="paragraph">
<p>Características de las Transacciones (ACID)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Atómicas</strong>: Todas las suboperaciones de la transacción se realizan como una unidad, si alguna no se puede llevar a cabo, no se realiza ninguna.</p>
</li>
<li>
<p><strong>Coherentes</strong>: Una vez finalizada la transacción, ya sea con éxito o no, el sistema queda en un estado coherente.</p>
</li>
<li>
<p><strong>Independientes</strong>: Deben de estar aisladas unas de otras, evitando lecturas y escrituras simultaneas.</p>
</li>
<li>
<p><strong>Duraderas</strong>: Los resultados de la transacción, deben ser persistidos, evitando su perdida por un fallo del sistema.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tx_que_es_una_transaccion.png" alt="tx que es una transaccion">
</div>
</div>
<div class="paragraph">
<p>Spring es compatible con la gestión de transacciones de forma declarativa y programática.</p>
</div>
<div class="paragraph">
<p>La gestión programática, permite mayor precisión a la hora de establecer los limites de la transacción, ya que la unidad de operación de la transacción en este caso es la sentencia</p>
</div>
<div class="paragraph">
<p>La gestión declarativa, es menos precisa ya que la unidad de operación será el método, pero es más limpia ya que permite desacoplar un requisito de su comportamiento transaccional.</p>
</div>
<div class="paragraph">
<p>Para transacciones no distribuidas, cuyo ambito es un único recurso transaccional, por ejemplo la base de datos de clientes, Spring permite emplear como gestor de la transacción, el que incluye el proveedor de persistencia, Hibernate, OpenJpa, EclipseLink, &#8230;&#8203;., sea este gestor JTA, o no.</p>
</div>
<div class="paragraph">
<p>Para transacciones distribuidas, se empleara una implementación de JTA.</p>
</div>
<div class="paragraph">
<p>La forma de adaptar la implementación especifica al contexto de Spring, será a través de objetos <strong>PlatformTransactionManager</strong> proporcionados por Spring</p>
</div>
<div class="paragraph">
<p>Spring proporciona entre otras las siguientes implementaciones</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CciLocalTransactionManager</p>
</li>
<li>
<p>DataSourceTransactionManager</p>
</li>
<li>
<p>HibernateTransactionManager</p>
</li>
<li>
<p>JdoTransactionManager</p>
</li>
<li>
<p>JpaTransactionManager</p>
</li>
<li>
<p>JtaTransactionManager</p>
</li>
<li>
<p>JmsTransactionManager</p>
</li>
<li>
<p>WeblogicJtaTransactionManager, &#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_transacciones_con_jdbc">Transacciones con JDBC</h3>
<div class="paragraph">
<p>En el caso de JDBC puro, se empleará <strong>DataSourceTransactionManager</strong>, del cual se definirá un Bean</p>
</div>
<div class="paragraph">
<p>En XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">ds</span><span class="delimiter">&quot;</span></span>/&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>En JavaConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> DataSourceTransactionManager transactionManager(<span class="predefined-type">DataSource</span> dataSource){
        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transacciones_con_hibernate">Transacciones con Hibernate</h3>
<div class="paragraph">
<p>En el caso de Hibernate, se empleará <strong>HibernateTransactionManager</strong>, del cual se definirá un Bean</p>
</div>
<div class="paragraph">
<p>En el XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.hibernate5.HibernateTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionFactory</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En JavaConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> HibernateTransactionManager transactionManager(SessionFactory sessionFactory){
        <span class="keyword">return</span> <span class="keyword">new</span> HibernateTransactionManager(sessionFactory);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transacciones_con_jpa">Transacciones con Jpa</h3>
<div class="paragraph">
<p>En el caso de Jpa, se empleará <strong>JpaTransactionManager</strong>, del cual se definirá un Bean</p>
</div>
<div class="paragraph">
<p>En el XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.JpaTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En JavaConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JpaTransactionManager transactionManager(EntityManagerFactory entityManagerFactory){
        <span class="keyword">return</span> <span class="keyword">new</span> JpaTransactionManager(entityManagerFactory);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transacciones_con_jta">Transacciones con Jta</h3>
<div class="paragraph">
<p>En el caso de Jta, se empleará <strong>JtaTransactionManager</strong>, del cual se definirá un Bean</p>
</div>
<div class="paragraph">
<p>En el XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.transaction.jta.JtaTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;propertyname</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">transactionManagerName</span><span class="error">&quot;</span>         <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:/TransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En JavaConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JtaTransactionManager transactionManager(){
        JtaTransactionManager transactionManager = <span class="keyword">new</span> JtaTransactionManager();
        transactionManager.setUserTransactionName(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/UserTransaction</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> transactionManager;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transacciones_programaticas">Transacciones programaticas</h3>
<div class="paragraph">
<p>Spring proporciona <strong>TransactionTemplate</strong>, una clase que permite manejar transacciones programáticas.</p>
</div>
<div class="paragraph">
<p>Esta clase necesitará cualquiera de las implementaciones de <strong>TransactionManager</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.transaction.support.TransactionTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para emplearla, se deberá incluir como dependencia en aquellos Bean que precisen manejar el comportamiento transaccional, los <strong>commit</strong> y <strong>rollback</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MiServicio</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.servicio.MiServicioImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La clase <strong>TransactionTemplate</strong> ofrece el método <strong>execute(TransactionCallback)</strong>, que permite definir el ambito en el que se realiza la transacción, todas las operaciones que se ejecuten dentro del <strong>TransactionCallback</strong> estarán dentro de la misma transacción.</p>
</div>
<div class="paragraph">
<p>Para trabajar con <strong>TransactionCallback</strong>, existen dos posibilidades dependiendo de si la transacción retorna un resultado o no, si retorna un resultado se ha de implementar la interace <strong>TransactionCallback&lt;T&gt;</strong> y si no retorna resultado se ha implementar la clase abstracta <strong>TransactionCallbackWithoutResult</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">txTemplate.execute(<span class="keyword">new</span> TransactionCallbackWithoutResult() {
        <span class="annotation">@Override</span>
        <span class="comment">//Dentro de este método se ejecutan todas las operaciones que conformen la Tx</span>
        <span class="directive">protected</span> <span class="type">void</span> doInTransactionWithoutResult(TransactionStatus status) {
                em.persist(cliente);
        }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si no se produce ningun error en la ejecucion de las sentencias que forman la transacción, se hará <strong>commit</strong> y si se produce algun error, se hará <strong>rollback</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_transacciones_declarativas">Transacciones declarativas</h3>
<div class="paragraph">
<p>Para configurar las transacciones se emplearán las etiquetas <strong>@Transactional</strong> aplicadas a métodos o clases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>
<span class="directive">public</span> <span class="type">void</span> altaCliente(Cliente cliente) {
        clienteDAO.insertar(cliente);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ojo que hay dos anotaciones una del estandar y otra de Spring, la de Spring es mas configurable, la del estandar precisa de otra anotacion <strong>@TransactionAttribute</strong> para configurar el comportamiento transaccional</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Las cuales habrá que activar, para ello en XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;tx:annotation-driven</span> <span class="attribute-name">proxy-target-class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y en JavaConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableTransactionManagement</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Configuracion</span>{}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuracion_de_transacciones">Configuracion de Transacciones</h3>
<div class="paragraph">
<p>La configuracion de las transacciones consiste en definir las <strong>políticas transaccionales</strong> de la transacción.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Propagation Behavior</strong>. Limites de la transacción.</p>
</li>
<li>
<p><strong>Isolation Level</strong>. Nivel de aislamiento. Como la afectan otras transacciones.</p>
</li>
<li>
<p><strong>Read Only</strong>. En el caso de que sean de solo lectura para optimizar.</p>
</li>
<li>
<p><strong>Timeout</strong>. Máximo tiempo que es aceptable para la tx.</p>
</li>
<li>
<p><strong>Normas de reversión</strong>. Listado de excepciones que causan rollback y cuales no.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_propagation_behavior">Propagation Behavior</h4>
<div class="paragraph">
<p>Define los limites de la transacción, cuando empieza, cuando se pausa, cuando es obligatoria, &#8230;&#8203; puede ser:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>PROPAGATION_MANDATORY</strong>: La ejecución del método debe realizarse en una transacción. Si no la hay, se lanza una excepción.</p>
</li>
<li>
<p><strong>PROPAGATION_NESTED</strong>: La ejecución del método debe realizarse en una transacción anidada, no existe compatibilidad con todos los proveedores.</p>
</li>
<li>
<p><strong>PROPAGATION_NEVER</strong>: La ejecución del método NO debe realizarse en una transacción. Si hay una en curso se lanza una excepción.</p>
</li>
<li>
<p><strong>PROPAGATION_NOT_SUPPORTED</strong>: La ejecución del método NO debe realizarse en una transacción. Si hay una en curso esta se suspende.</p>
</li>
<li>
<p><strong>PROPAGATION_REQUIRED</strong>: La ejecución del método debe realizarse en una transacción. Si no existe una en curso, se genera una nueva.</p>
</li>
<li>
<p><strong>PROPAGATION_REQUIRES_NEW</strong>: La ejecución del método debe realizarse en una transacción propia, siempre se crea una transacción. Si hay una en curso se suspende.</p>
</li>
<li>
<p><strong>PROPAGATION_SUPPORTS</strong>: La ejecución del método no tiene porque realizarse en una transacción, pero si hay una en curso se ejecuta dentro de ella.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>El valor por defecto es <strong>PROPAGATION_REQUIRED</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_isolation_level">Isolation Level</h4>
<div class="paragraph">
<p>Cuando varias transacciones, comparten datos, se pueden producir una serie de problemas.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lectura de datos sucios</strong>: Ocurre cuando se le permite a una transacción la lectura de una fila que ha sido modificada por otra transacción concurrente pero todavía no ha sido cometida.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los datos leído por Tx1, han sido escritos por Tx2, pero todavía no son persistentes (commit).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tx_lectura_sucia.png" alt="tx lectura sucia">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lectura no repetible</strong>: Ocurre cuando en el curso de una transacción una fila se lee dos veces y los valores no coinciden.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los datos obtenido por Tx1 al realizar la misma consulta no son iguales, dado que Tx2, los esta variando.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tx_no_repetible.png" alt="tx no repetible">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Lectura fantasma</strong>: Ocurre cuando, durante una transacción, se ejecutan dos consultas idénticas, y los resultados de la segunda son distintos de los de la primera. Es una caso particular de las lecturas no repetibles</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tx_lectura_fantasma.png" alt="tx lectura fantasma">
</div>
</div>
<div class="paragraph">
<p>Para que esto no suceda, se puede recurrir a aislar los datos cuando estén siendo empleados por una transacción, bloqueándolos, pero esto produce una caída del rendimiento, por lo que hay que flexibilizar, permitiendo definir niveles de aislamiento.</p>
</div>
<div class="paragraph">
<p>Se definen los siguientes niveles de aislamiento</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ISOLATION_DEFAULT</strong>: Aplica el determinado por el almacén de datos al que accede.</p>
</li>
<li>
<p><strong>ISOLATION_READ_UNCOMMITED</strong>: Permite leer datos no consolidados.</p>
</li>
<li>
<p><strong>ISOLATION_READ_COMMITED</strong>: Permite leer datos de transacciones consolidadas. Evita lectura sucia.</p>
</li>
<li>
<p><strong>ISOLATION_REPEATABLE_READ</strong>: Varias lecturas del mismo campo, generan los mismos resultados excepto que la transacción lo modifique. Evita la lectura de datos sucios y la no repetible.</p>
</li>
<li>
<p><strong>ISOLATION_SERIALIZABLE</strong>: Aislamiento perfecto. Evita la lectura de datos sucios, la lectura no repetible y las lecturas fantasmas.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>No todos los orígenes son compatibles con estos niveles.</p>
</div>
<div class="paragraph">
<p>El nivel por defecto es <strong>ISOLATION_READ_COMMITED</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/tx_isolation_level.png" alt="tx isolation level">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_read_only">Read Only</h4>
<div class="paragraph">
<p>Si solo se van a realizar operaciones de solo lectura, Spring permite marcar esta opción, para llevar a cabo ciertas optimizaciones sobre la transacción.</p>
</div>
<div class="paragraph">
<p>Dado que esta optimización se aplica sobre una nueva transacción, tendrá sentido aplicarlo solo donde se inicien, esto es en transacciones cuya propagación sea:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PROPAGATION_REQUIRED.</p>
</li>
<li>
<p>PROPAGAION_REQUIRES_NEW.</p>
</li>
<li>
<p>PROPAGATION_NESTED.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Si se trabaja con hibernate, esto implica que se empelara el modo de vaciado FLUSH_NEVER, que permite que Hibernate no sincronice con la base de datos hasta el final.</p>
</div>
</div>
<div class="sect3">
<h4 id="_timeout">Timeout</h4>
<div class="paragraph">
<p>Cuando se quiere limitar el tiempo durante el cual, la transacción puede tener bloqueados recursos del entorno de persistencia, será necesario especificar un tiempo máximo de espera, esto solo tendrá sentido donde se inicien, esto es en transacciones cuya propagación sea:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PROPAGATION_REQUIRED.</p>
</li>
<li>
<p>PROPAGATION_REQUIRES_NEW.</p>
</li>
<li>
<p>PROPAGATION_NESTED.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_rollback">Rollback</h4>
<div class="paragraph">
<p>Conjunto de normas que definen cuando una excepción causa una reversión.</p>
</div>
<div class="paragraph">
<p>De forma predeterminada, solo se revierten las transacciones cuando hay excepciones en tiempo de ejecución (RuntimeException) y no con las comprobadas, al igual que con los EJB., aunque este comportamiento es configurable.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_data_jpa">Spring Data Jpa</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introducción">Introducción</h3>
<div class="paragraph">
<p>Framework que extiende las funcionalidades de Spring ORM, permitiendo definir <strong>Repositorios</strong> de forma mas sencilla, sin repetir código, dado que ofrece numerosos métodos ya implementados y la posibilidad de crear nuevos tanto de consulta como de actualización de forma sencilla.</p>
</div>
<div class="paragraph">
<p>El framework, se basa en la definición de interfaces que extiendan la siguiente jerarquia, concretando el tipo entidad y el tipo de la clave primaria.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/data_jerarquia_interfaces.png" alt="data jerarquia interfaces">
</div>
</div>
<div class="paragraph">
<p>De forma paralela a las interfaces Jpa, existen para Mongo y Redis.</p>
</div>
<div class="paragraph">
<p>Por lo que la creación de un repositorio con Spring Data Jpa, se basará en la implementación de la interface <strong>JpaRepository</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">CustomerRepository</span> <span class="directive">extends</span> JpaRepository&lt;Customer, <span class="predefined-type">Long</span>&gt; {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>El convenio indica que el nombre de la interface, será <strong>&lt;entidad&gt;Repository</strong>.</p>
</div>
<div class="paragraph">
<p>La magia de Spring Data, es que no es necesario definir las implementaciones, estas se crean en tiempo de ejecución según se defina el Repositorio.</p>
</div>
<div class="paragraph">
<p>Para que esto suceda, se tendrá que añadir a la configuración con JavaConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EnableJpaRepositories</span>(basePackages=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.cursospring.persistencia</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>o para configuraciones con XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;jpa:repositories</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.cursospring.persistencia</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Además Spring Data Jpa, exige la definición de un bean de tipo <strong>AbstractEntityManagerFactoryBean</strong> que se llame <strong>entityManagerFactory</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">ds</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jpaVendorAdapter</span><span class="delimiter">&quot;</span></span> ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">jpaVendorAdapter</span><span class="delimiter">&quot;</span></span> /&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">packagesToScan</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.curso.modelo.entidad</span><span class="delimiter">&quot;</span></span>/&gt;
        &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jpaProperties</span><span class="delimiter">&quot;</span></span>&gt;
                &lt;props&gt;
                        &lt;prop key=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.dialect</span><span class="delimiter">&quot;</span></span>&gt;org.hibernate.dialect.DerbyDialect&lt;/prop&gt;
                        &lt;prop key=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.show_sql</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">true</span>&lt;/prop&gt;
                        &lt;prop key=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.format_sql</span><span class="delimiter">&quot;</span></span>&gt;<span class="predefined-constant">true</span>&lt;/prop&gt;
                        &lt;prop key=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span>&gt;validate&lt;/prop&gt;
                        &lt;prop key=<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.default_schema</span><span class="delimiter">&quot;</span></span>&gt;CLIENTES&lt;/prop&gt;
                &lt;/props&gt;
        &lt;/property&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y otro de tipo <strong>TransactionManager</strong> que se llame <strong>transactionManager</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span> <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.orm.jpa.JpaTransactionManager</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span> ref=<span class="string"><span class="delimiter">&quot;</span><span class="content">entityManagerFactory</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ya que son dependencias de la implementación autogenerada que proporciona Spring Data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_querys_personalizadas">Querys Personalizadas</h3>
<div class="paragraph">
<p>Se pueden extender los métodos que ofrezca el Repositorio, siguiendo las siguientes reglas</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prefijo del nombre del método <strong>findBy</strong> para busquedas y <strong>countBy</strong> para conteo de coincidencias.</p>
</li>
<li>
<p>Seguido del nombre de los campos de busqueda concatenados por los operadores correspondientes: And, Or, Between, &#8230;&#8203; Todos los operadores <a href="http://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation">aquí</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Person&gt; findByLastname(<span class="predefined-type">String</span> lastname);

<span class="predefined-type">List</span>&lt;Person&gt; findByEmailAddressAndLastname(EmailAddress emailAddress, <span class="predefined-type">String</span> lastname);

<span class="predefined-type">List</span>&lt;Person&gt; findDistinctPeopleByLastnameOrFirstname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">String</span> firstname);
<span class="predefined-type">List</span>&lt;Person&gt; findPeopleDistinctByLastnameOrFirstname(<span class="predefined-type">String</span> lastname, <span class="predefined-type">String</span> firstname);

<span class="predefined-type">List</span>&lt;Person&gt; findByLastnameIgnoreCase(<span class="predefined-type">String</span> lastname);

<span class="predefined-type">List</span>&lt;Person&gt; findByLastnameAndFirstnameAllIgnoreCase(<span class="predefined-type">String</span> lastname, <span class="predefined-type">String</span> firstname);

<span class="predefined-type">List</span>&lt;Person&gt; findByLastnameOrderByFirstnameAsc(<span class="predefined-type">String</span> lastname);
<span class="predefined-type">List</span>&lt;Person&gt; findByLastnameOrderByFirstnameDesc(<span class="predefined-type">String</span> lastname);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se pueden definir consultas personalizadas con JPQL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Country c where lower(c.name) like lower(?1)</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">List</span>&lt;Country&gt; getByNameWithQuery(<span class="predefined-type">String</span> name);

<span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Country c where lower(c.name) like lower(?1)</span><span class="delimiter">&quot;</span></span>)
Country findByNameWithQuery(<span class="annotation">@Param</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name);

<span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select case when (count(c) &gt; 0)  then true else false end from Country c where c.name = ?1)</span><span class="delimiter">&quot;</span></span>)
<span class="type">boolean</span> exists(<span class="predefined-type">String</span> name);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_paginación_y_ordenación">Paginación y Ordenación</h3>
<div class="paragraph">
<p>De forma analoga a la definición</p>
</div>
<div class="paragraph">
<p>A las consultas se puede añadir un último parametro de tipo <strong>Pageable</strong> o <strong>Sort</strong>, que permite definir el criterio de paginación o de ordenación.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Country findByNameWithQuery(<span class="predefined-type">Integer</span> population, Sort sort);

<span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Country c where lower(c.name) like lower(?1)</span><span class="delimiter">&quot;</span></span>)
Page&lt;Country&gt; findByNameWithQuery(<span class="predefined-type">String</span> name, <span class="predefined-type">Pageable</span> page);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Definiendose el criterio a aplicar en tiempo de ejecución</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">countryRepository.findByNameWithQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">%i%</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> Sort( <span class="keyword">new</span> Sort.Order(Sort.Direction.ASC,<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)));

Page&lt;Country&gt; page = countryRepository.findByNameWithQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">%i%</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> PageRequest(<span class="integer">0</span>, <span class="integer">3</span>, <span class="keyword">new</span> Sort( <span class="keyword">new</span> Sort.Order(Sort.Direction.ASC,<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inserción_actualización">Inserción / Actualización</h3>
<div class="paragraph">
<p>Se pueden definir con JPQL, siempre que se cumpla</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El método debe estar anotado con @Modifying si no Spring Data JPA interpretará que se trata de una select y la ejecutará como tal.</p>
</li>
<li>
<p>Se devolverá o void o un entero (int\Integer) que contendrá el número de objetos modificados o eliminados.</p>
</li>
<li>
<p>El método deberá ser transaccional o bien ser invocado desde otro que sí lo sea.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>
<span class="annotation">@Modifying</span>
<span class="annotation">@Query</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE Country set creation = (?1)</span><span class="delimiter">&quot;</span></span>
<span class="type">int</span> updateCreation(<span class="predefined-type">Calendar</span> creation);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transactional</span>
<span class="type">int</span> deleteByName(<span class="predefined-type">String</span> name);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_web">Spring Web</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Framework que permite incluir el contexto de Spring en una aplicación web.</p>
</div>
<div class="paragraph">
<p>Se basa en la definición de un <strong>Listener</strong> de contexto web, que cree el contexto de Spring.</p>
</div>
<div class="paragraph">
<p>Para configuraciones tradicionales con <strong>web.xml</strong>, se define el <strong>Listener</strong> y la ubicación de todos los ficheros que formen el contexto de Spring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;listener&gt;</span>
    <span class="tag">&lt;listener-class&gt;</span>
        org.springframework.web.context.ContextLoaderListener
    <span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span>
<span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>
        classpath:xfiles-config.xml,
        /WEB-INF/security.xml
    <span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para configuraciones basadas en JavaConfig, el Api proporciona una interface <strong>WebApplicationInitializer</strong>, que permtite la sustitución del <strong>web.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppInitializer</span> <span class="directive">implements</span> WebApplicationInitializer {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext servletContext) <span class="directive">throws</span> ServletException {
        WebApplicationContext context = getContext();
        servletContext.addListener(<span class="keyword">new</span> ContextLoaderListener(context));
    }

    <span class="directive">private</span> AnnotationConfigWebApplicationContext getContext() {
        AnnotationConfigWebApplicationContext context = <span class="keyword">new</span> AnnotationConfigWebApplicationContext();
        context.setConfigLocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.cursospring</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> context;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso el contexto de Spring tambien se basa en JavaConfig.</p>
</div>
<div class="paragraph">
<p>Una vez definido el contexto de Spring y creado en la creación del contexto Web, cualquier componente Web JEE, podrá acceder a dicho contexto a través del contexto Web, de la siguiente manera</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(getServletContext());</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_ambitos">Ambitos</h3>
<div class="paragraph">
<p>A parte de los ambitos conocidos <strong>singleton</strong> y <strong>prototype</strong>, se introducen otros 2 scope</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>request</strong> &#8594; Los Bean se crearán por cada nueva petición a la aplicación que lo precise.</p>
</li>
<li>
<p><strong>session</strong> &#8594; Los Bean se crearán por cada nueva sesión de usuario que lo precise.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para asociarlos a un Bean se puede emplear la anotación <strong>@Scope</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_recursos_jndi_del_servidor">Recursos JNDI del Servidor</h3>
<div class="paragraph">
<p>Es habitual que el Servidor de Aplicaciones donde se despliega la aplicación web, provea a esta de recursos empleando el api JNDI, desde Spring se puede incluir dichos recursos en el contexto de spring con la siguiente configuracion xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans:bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jndi.JndiObjectFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;beans:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jndiName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/MyLocalDB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/beans:bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>O de forma mas sencilla empleando el espacio de nombres jee</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">expected-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.sql.DataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyLocalDB</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>o JavaConfig</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${db.jndi}</span><span class="delimiter">&quot;</span></span> <span class="predefined-type">String</span> jndiName) {
    JndiDataSourceLookup lookup = <span class="keyword">new</span> JndiDataSourceLookup();
    lookup.setResourceRef(<span class="predefined-constant">true</span>);
    <span class="keyword">return</span> lookup.getDataSource(jndiName);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>La clase especializada en DataSource, <strong>JndiDataSourceLookup</strong>, se obtiene con <strong>spring-jdbc</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Donde db.jndi, valdra algo como <strong>java:comp/env/jdbc/MyDB</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para publicar el recurso JNDI se ha de consultar la documentación del servidor en concreto, dado que cada uno lo hace de una forma distinta.</p>
</div>
<div class="paragraph">
<p>Por ejemplo para un Tomcat 8, se haría definiciendo en <strong>&lt;TOMCAT_HOME&gt;/conf/context.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;Context&gt;</span>
  <span class="tag">&lt;Resource</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDB</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">auth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Container</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.sql.DataSource</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">maxTotal</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxIdle</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxWaitMillis</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">driverClassName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.derby.jdbc.ClientDriver</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:derby://localhost:1527/jndi</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/Context&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Mapeando dicho recurso en el fichero <strong>/WEB-INF/web.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;resource-ref&gt;</span>
  <span class="tag">&lt;description&gt;</span>DB Connection<span class="tag">&lt;/description&gt;</span>
  <span class="tag">&lt;res-ref-name&gt;</span>jdbc/MyDB<span class="tag">&lt;/res-ref-name&gt;</span>
  <span class="tag">&lt;res-type&gt;</span>javax.sql.DataSource<span class="tag">&lt;/res-type&gt;</span>
  <span class="tag">&lt;res-auth&gt;</span>Container<span class="tag">&lt;/res-auth&gt;</span>
<span class="tag">&lt;/resource-ref&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>En configuraciones JavaConfig, se puede añadir al <strong>@Bean</strong> la anotacion <strong>@Resource</strong> del api de servlets</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Configuracion</span> {
  <span class="annotation">@Bean</span>
  <span class="annotation">@Resource</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc/MyDB</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSourceLookup() {
      <span class="directive">final</span> JndiDataSourceLookup dsLookup = <span class="keyword">new</span> JndiDataSourceLookup();
      dsLookup.setResourceRef(<span class="predefined-constant">true</span>);
      <span class="predefined-type">DataSource</span> dataSource = dsLookup.getDataSource(<span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/jdbc/MyDB</span><span class="delimiter">&quot;</span></span>);
      <span class="keyword">return</span> dataSource;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filtros">Filtros</h3>
<div class="paragraph">
<p>Como se ha comentado Spring Web, pretende extender el contenedor web estandar con los Bean del contexto de Spring, se ha visto como a traves del <strong>ContextLoaderListener</strong>, se crea el contexto y se permite el acceso a dicho Contexto desde componente dentro del contenedor web.</p>
</div>
<div class="paragraph">
<p>Cuando se trabaja con Spring MVC, se realiza algo parecido, ya que se asocia un contexto de Spring a un Servlet.</p>
</div>
<div class="paragraph">
<p>Tambien es posible extender los Filtros Web, Spring proporciona una implementación de Filtro Web <strong>DelegatingFilterProxy</strong> que permite delegar las intercepciones que realice dicho Filtro Web sobre Beans de Spring que implementen la interface <strong>Filter</strong>, en concreto delega la petición, sobre un Bean de Spring, que se llame como el Filtro Web <strong>DelegatingFilterProxy</strong>.</p>
</div>
<div class="paragraph">
<p>Con XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
  <span class="tag">&lt;display-name&gt;</span>elNombreDeMiBeanEnSpring<span class="tag">&lt;/display-name&gt;</span>
  <span class="tag">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="tag">&lt;/filter-name&gt;</span>
  <span class="tag">&lt;filter-class&gt;</span>
    org.springframework.web.filter.DelegatingFilterProxy
  <span class="tag">&lt;/filter-class&gt;</span>
<span class="tag">&lt;/filter&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
  <span class="tag">&lt;filter-name&gt;</span>elNombreDeMiBeanEnSpring<span class="tag">&lt;/filter-name&gt;</span>
  <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con Java Config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppInitializer</span> <span class="directive">implements</span> WebApplicationInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext servletContext) <span class="directive">throws</span> ServletException {
    <span class="comment">// ...</span>
    servletContext.addFilter(<span class="string"><span class="delimiter">&quot;</span><span class="content">elNombreDeMiBeanEnSpring</span><span class="delimiter">&quot;</span></span>,
      <span class="keyword">new</span> DelegatingFilterProxy(<span class="string"><span class="delimiter">&quot;</span><span class="content">elNombreDeMiBeanEnSpring</span><span class="delimiter">&quot;</span></span>))
        .addMappingForUrlPatterns(<span class="predefined-constant">null</span>, <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span>);
    <span class="comment">// ...</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>En los ejemplos anteriores, deberá existir en el contexto de Spring un Bean llamado <strong>elNombreDeMiBeanEnSpring</strong>, que implemente la interface <strong>Filter</strong> del API de Servlets.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_mvc">Spring MVC</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduccion">Introduccion</h3>
<div class="paragraph">
<p>Spring MVC, como su nombre indica es un framework que implementa Modelo-Vista-Controlador, esto quiere decir que proporcionará componentes especializados en cada una de esas tareas.</p>
</div>
<div class="paragraph">
<p>Para incorporar las librerias con Maven, se añade al pom.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-webmvc<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>4.2.3.RELEASE<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_arquitectura">Arquitectura</h3>
<div class="paragraph">
<p>Spring MVC, como la mayoría de frameworks MVC, se basa en el patrón <strong>FrontController</strong>, en este caso el componente que realiza esta tarea es <strong>DispatcherServlet</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mvc_arquitectura.png" alt="mvc arquitectura">
</div>
</div>
<div class="sect3">
<h4 id="_dispatcherservlet">DispatcherServlet</h4>
<div class="paragraph">
<p>El <strong>DispatcherServlet</strong>, realiza las siguientes tareas.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consulta con los <strong>HandlerMapping</strong>, que <strong>Controller</strong> ha de resolver la petición.</p>
</li>
<li>
<p>Una vez el <strong>HandlerMapping</strong> le retorna que <strong>Controller</strong> ha de invocar, lo invoca para que resuelva la petición.</p>
</li>
<li>
<p>Recoge los datos del <strong>Model</strong> que le envía el <strong>Controller</strong> como respuesta y el identificador de la <strong>View</strong> (o la propia <strong>View</strong> dependerá de la implementación del <strong>Controller</strong>) que se empleará para mostrar dichos datos.</p>
</li>
<li>
<p>Consulta a la cadena de <strong>ViewResolver</strong> cual es la <strong>View</strong> a emplear, basandose en el identificador que le ha retornado el <strong>Controller</strong>.</p>
</li>
<li>
<p>Procesa la <strong>View</strong> y el resultado lo retorna como resultado de la petición.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La configuración del <strong>DispatcherServlet</strong> se puede realizar siguiendo dos formatos</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Con ficheros XML. Para ello se han de declarar el servlet en el <strong>web.xml</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>miApp<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/servlet-class&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>/WEB-INF/miApp-servlet.xml<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
<span class="tag">&lt;/servlet&gt;</span>
<span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>miApp<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/expedientesx/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/servlet-mapping&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>De no incluir el parametro de configuracion <strong>contextConfigLocation</strong> para el servlet, sera importante el nombre del servlet, ya que por defecto este buscara en el directorio WEB-INF, el xml de Spring con el nombre <strong>&lt;servlet-name&gt;-servlet.xml</strong> en este caso <strong>miApp-servlet.xml</strong></p>
</div>
<div class="paragraph">
<p>Se puede incluir más de un fichero de configuracion de contexto, separandolos con comas.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Con clases anotadas al estilo <strong>JavaConfig</strong>. Para ello el API proporciona una interface que se ha de implementar <strong>WebApplicationInitializer</strong> y allí se ha de registrar el servlet.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppInitializer</span> <span class="directive">implements</span> WebApplicationInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext servletContext) <span class="directive">throws</span> ServletException {
            WebApplicationContext context = getContext();
        ServletRegistration.Dynamic dispatcher = servletContext.addServlet(<span class="string"><span class="delimiter">&quot;</span><span class="content">DispatcherServlet</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> DispatcherServlet(context));
        dispatcher.setLoadOnStartup(<span class="integer">1</span>);
        dispatcher.addMapping(<span class="string"><span class="delimiter">&quot;</span><span class="content">/expedientesx/*</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="directive">private</span> AnnotationConfigWebApplicationContext getContext() {
        AnnotationConfigWebApplicationContext context = <span class="keyword">new</span> AnnotationConfigWebApplicationContext();
        context.setConfigLocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">expedientesx.cfg</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> context;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_contextloaderlistener">ContextLoaderListener</h4>
<div class="paragraph">
<p>Adicionalmente, se puede definir otro contexto de Spring global a la aplicación, para ello se ha de declarar el listener <strong>ContextLoaderListener</strong>, que al igual que el <strong>DispatcherServlet</strong> puede ser declarado de dos formas.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Con XML</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>
                classpath:aplicacion.xml,
                /WEB-INF/seguridad.xml
        <span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>
<span class="tag">&lt;listener&gt;</span>
        <span class="tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/listener-class&gt;</span>
<span class="tag">&lt;/listener&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Se puede incluir más de un fichero de configuracion de contexto, separandolos con comas.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Con JavaConfig</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppInitializer</span> <span class="directive">implements</span> WebApplicationInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext servletContext) <span class="directive">throws</span> ServletException {

            WebApplicationContext context = getContext();
        servletContext.addListener(<span class="keyword">new</span> ContextLoaderListener(context));
    }

    <span class="directive">private</span> AnnotationConfigWebApplicationContext getContext() {
        AnnotationConfigWebApplicationContext context = <span class="keyword">new</span> AnnotationConfigWebApplicationContext();
        context.setConfigLocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">expedientesx.cfg</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> context;
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>La clase <strong>AnnotationConfigWebApplicationContext</strong> es una clase capaz de descubrir y considerar los Beans declarados en clases anotadas con <strong>@Configuration</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_namespace_mvc">Namespace MVC</h3>
<div class="paragraph">
<p>Se incluye el siguiente namespace con algunas etiquetas nuevas, que favorecen la configuracion del contexto</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_acceso_a_recursos_directamente">Acceso a recursos directamente</h3>
<div class="paragraph">
<p>No todas las peticiones que se realizan a la aplicación necesitarán que se ejecute un <strong>Controller</strong>, algunas de ellas harán referencia a imagenes, hojas de estilo, &#8230;&#8203; Se puede añadir con XML o JavaConfig</p>
</div>
<div class="paragraph">
<p>Con XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mvc:resources</span> <span class="attribute-name">mapping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/resources/**</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/resources/</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Donde <strong>mapping</strong> hace referencia al patrón de URL de la petición y <strong>location</strong> al directorio donde encontrar los recursos.</p>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>La forma de abordar esta explicación, es retomar la arquitectura y el patrón <strong>FrontController</strong>, y la no necesidad de un <strong>Controller</strong> para ofrecer un recurso estatico, los <strong>Controller</strong> son necesarios para los recursos dinamicos, para los estaticos introducen demasida complejidad de forma inecesaria.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con JavaConfig, se ha de hacer extender la clase <strong>@Configuration</strong> de <strong>WebMvcConfigurerAdapter</strong> y sobrescribir el método <strong>addResourceHandlers</strong> con lo siguiente.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> addResourceHandlers(<span class="directive">final</span> ResourceHandlerRegistry registry) {
    registry.addResourceHandler(<span class="string"><span class="delimiter">&quot;</span><span class="content">/resources/**</span><span class="delimiter">&quot;</span></span>).addResourceLocations(<span class="string"><span class="delimiter">&quot;</span><span class="content">/resources/</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Donde <strong>ResourceHandler</strong> hace referencia al patrón de URL de la petición y <strong>ResourceLocation</strong> al directorio donde encontrar los recursos.</p>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>La forma de abordar esta explicación, es retomar la arquitectura y el patrón <strong>FrontController</strong>, y la no necesidad de un <strong>Controller</strong> para ofrecer un recurso estatico, los <strong>Controller</strong> son necesarios para los recursos dinamicos, para los estaticos introducen demasida complejidad de forma inecesaria.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_asignar_url_a_view">Asignar URL a View</h3>
<div class="paragraph">
<p>En ocasiones se necesita acceder a una <strong>View</strong> directamente, sin pasar por un controlador, para ello Srping MVC ofrece los <strong>ViewControllers</strong>. Se puede añadir con XML o JavaConfig</p>
</div>
<div class="paragraph">
<p>Con XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mvc:view-controller</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">view-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">welcome</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con JavaConfig, de nuevo se ha de hacer extender la clase <strong>@Configuration</strong> de la clase <strong>WebMvcConfigurerAdapter</strong>, en este caso implementando el método</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> addViewControllers(ViewControllersRegistry registry) {
    registry.addViewController(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>).setViewName(<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>En este caso <strong>ViewController</strong> representa el path que le llega al <strong>DispatcherServlet</strong> y <strong>ViewName</strong> el nombre de la <strong>View</strong> que deberá ser resuelto por un <strong>ViewResolver</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handlermapping">HandlerMapping</h3>
<div class="paragraph">
<p>Es el primero de los componentes necesarios dentro del flujo de Spring MVC, siendo el encargado de encontrar el controlador capaz de procesar la petición recibida.</p>
</div>
<div class="paragraph">
<p>Este componente extrae de la URL un Path, que coteja con las entradas configuradas dependiendo de la implementación empleada.</p>
</div>
<div class="paragraph">
<p>Para activar los HandlerMapping unicamente hay que declararlos en el contexto de Spring como Beans.</p>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dado que se pueden configurar varios <strong>HandlerMapping</strong>, para establecer en que orden se han de emplear, existe la propiedad <strong>Order</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>El API proporciona las siguientes implementaciones</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>BeanNameUrlHandlerMapping</strong> &#8594; Usa el nombre del Bean <strong>Controller</strong> como mapeo <strong>&lt;bean name="/inicio.htm" … &gt;</strong>, debe comenzar por <strong>/</strong>.</p>
</li>
<li>
<p><strong>SimpleUrlHandlerMapping</strong> &#8594; Mapea mediante propiedades <strong>&lt;prop key="/verClientes.htm"&gt;beanControlador&lt;/prop&gt;</strong></p>
</li>
<li>
<p><strong>ControllerClassNameHandlerMapping</strong> &#8594; Usa el nombre de la clase asumiendo que termina en <strong>Controller</strong> y sustituyéndo la palabra <strong>Controller</strong> por <strong>.htm</strong></p>
</li>
<li>
<p><strong>DefaultAnnotationHandlerMapping</strong> &#8594; Emplea la propiedad path de la anotación <strong>@RequestMapping</strong></p>
</li>
</ul>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Las implementaciones por defecto en Spring MVC 3 son <strong>BeanNameUrlHandlerMapping</strong> y <strong>DefaultAnnotationHandlerMapping</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_beannameurlhandlermapping">BeanNameUrlHandlerMapping</h4>
<div class="paragraph">
<p>Al emplear esta configuración, cuando lleguen peticiones con path <strong>/helloWoorld.html</strong>, el <strong>Controller</strong> que lo procesará será de tipo <strong>EjemploAbstractController</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/helloWorld.html</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.ejemplos.springmvc.HelloWorldController</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_simpleurlhandlermapping">SimpleUrlHandlerMapping</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.handler.SimpleUrlHandlerMapping</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;props&gt;</span>
                <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/helloWorld.htm</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>helloWorldController<span class="tag">&lt;/prop&gt;</span>
        <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWorldController</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.ejemplos.springmvc.HelloWorldController</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_controllerclassnamehandlermapping">ControllerClassNameHandlerMapping</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldController</span> extend AbstractController{
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> ModelAndView handleRequestInternal(HttpServletRequest request, HttpServletResponse response)
                        <span class="directive">throws</span> <span class="exception">Exception</span> {
                <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string"><span class="delimiter">&quot;</span><span class="content">otro</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_defaultannotationhandlermapping">DefaultAnnotationHandlerMapping</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWorld</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldController</span> extend AbstractController{
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> ModelAndView handleRequestInternal(HttpServletRequest request, HttpServletResponse response)
                        <span class="directive">throws</span> <span class="exception">Exception</span> {
                <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string"><span class="delimiter">&quot;</span><span class="content">otro</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_requestmappinghandlermapping">RequestMappingHandlerMapping</h4>
<div class="paragraph">
<p>Esta implementacion permite interpretar las anotaciones <strong>@RequestMapping</strong> en los controladores, haciendo coincidir la url, con el atributo <strong>path</strong> de dichas anotaciones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWorld</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldController</span> extend AbstractController{
    <span class="annotation">@Override</span>
    <span class="directive">protected</span> ModelAndView handleRequestInternal(HttpServletRequest request, HttpServletResponse response)
            <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string"><span class="delimiter">&quot;</span><span class="content">otro</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>El espacio de nombres <strong>mvc</strong>, ofrece una etiqueta que simplifica la configuracion</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mvc:annotation-driven</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se ofrece una anotacion <strong>@EnableWebMvc</strong> a añadir a la clase <strong>@Configuration</strong> para la configuracion con JavaConfig, esta anotación, define por convencion una pila de <strong>HandlerMapping</strong>, ya que en realidad lo que hace es cargar la clase <strong>WebMvcConfigurationSupport</strong> como calse <strong>@Configuration</strong>, en esta clase se describen los <strong>HandlerMapping</strong> cargados.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebMvc</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ContextoGlobal</span> {
}</code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>En la ultima version de Spring no es necesario añadirlo, la unica diferencia al añadirlo, es que se consideran menos path validos para cada <strong>@RequestMapping</strong> definido, con ella solo <strong>/helloWorld</strong> y sin ella <strong>/helloWorld</strong>, <strong>/helloWorld.\</strong> * y <strong>/helloWorld/</strong></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controller">Controller</h3>
<div class="paragraph">
<p>El siguiente de los componentes en el que delega el <strong>DispatcherServlet</strong>, será el encargado de ejecutar la logica de negocio.</p>
</div>
<div class="paragraph">
<p>Spring proporciona las siguientes implementaciones</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AbstractController</strong></p>
</li>
<li>
<p><strong>ParametrizableViewController</strong></p>
</li>
<li>
<p><strong>AbstractCommandController</strong></p>
</li>
<li>
<p><strong>SimpleFormController</strong></p>
</li>
<li>
<p><strong>AbstractWizardFormController</strong></p>
</li>
<li>
<p><strong>@Controller</strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="__controller">@Controller</h4>
<div class="paragraph">
<p>Anotacion de Clase, que permite indicar que una clase contiene funcionalidades de Controlador.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWorldController</span> {
    <span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWorld</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> helloWorld(){
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">exito</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>La firma de los métodos de la clase anotada es flexible, puede retornar</p>
</div>
<div class="ulist">
<ul>
<li>
<p>String</p>
</li>
<li>
<p>View</p>
</li>
<li>
<p>ModelAndView</p>
</li>
<li>
<p>Objeto (Anotado con @ResponseBody)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Y puede recibir como parámetro</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Model</strong> &#8594; Datos a emplear en la <strong>View</strong>.</p>
</li>
<li>
<p>Parametros anotados con <strong>@PathVariable</strong> &#8594; Dato que llega en el path de la Url.</p>
</li>
<li>
<p>Parametros anotados con <strong>@RequestParam</strong> &#8594; Dato que llega en los parametros de la Url.</p>
</li>
<li>
<p><strong>HttpServletRequest</strong></p>
</li>
<li>
<p><strong>HttpServletResponse</strong></p>
</li>
<li>
<p><strong>HttpSession</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_activación_de_controller">Activación de @Controller</h4>
<div class="paragraph">
<p>Para activar esta anotación, habra que indicarle al contexto de Spring a partir de que paquete puede buscarla. Se puede hacer con XML y con JavaConfig</p>
</div>
<div class="paragraph">
<p>Con XML, se emplea la etiqueta <strong>ComponentScan</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">controllers</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Esta etiqueta activa el descubrimineto de las clases anotadas con @Component, @Repository, @Controller y @Service</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Con JavaConfig, se emplea la anotacion <strong>@ComponentScan</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebMvc</span>
<span class="annotation">@ComponentScan</span>(basePackages={ <span class="string"><span class="delimiter">&quot;</span><span class="content">controllers</span><span class="delimiter">&quot;</span></span> })
<span class="directive">public</span> <span class="type">class</span> <span class="class">ContextoGlobal</span> {

}</code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Esta anotacion activa el descubrimineto de las clases anotadas con @Component, @Repository, @Controller y @Service</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="__pathvariable">@PathVariable</h4>
<div class="paragraph">
<p>Anotacion que permite obtener información de la url que provoca la ejecucion del controlador.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(path=<span class="string"><span class="delimiter">&quot;</span><span class="content">/saludar/{nombre}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> ModelAndView saludar(<span class="annotation">@PathVariable</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> nombre){
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para el anterior ejemplo, dada la siguiente url <strong><a href="http://………/saludar/Victor" class="bare">http://………/saludar/Victor</a></strong>, el valor del parametro <strong>nombre</strong>, será <strong>Victor</strong></p>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Se pueden definir expresiones regulares para alimentar a los @PathVariable, siguiendo la firma <strong>{varName:regex}</strong>, por ejemplo</p>
</div>
<div class="paragraph">
<p>@RequestMapping("/spring-web/{symbolicName:[a-z-]}-{version:\\d\\.\\d\\.\\d}{extension:\\.[a-z]}")
public void handle(@PathVariable String version, @PathVariable String extension) {
    // &#8230;&#8203;
}</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="__requestparam">@RequestParam</h4>
<div class="paragraph">
<p>Anotacion que permite obtener información de los parametros de la url que provoca la ejecucion del controlador.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(path=<span class="string"><span class="delimiter">&quot;</span><span class="content">/saludar</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> ModelAndView saludar(<span class="annotation">@RequestParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> nombre){
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para el anterior ejemplo, dada la siguiente url <strong><a href="http://………./saludar?nombre=Victor" class="bare">http://………./saludar?nombre=Victor</a></strong>, el valor del parametro <strong>nombre</strong>, será <strong>Victor</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="__requestbody">@RequestBody</h4>
<div class="paragraph">
<p>Permite tranformar el contenido del <strong>body</strong> de peticiones <strong>POST</strong> o <strong>PUT</strong> a un objeto java, tipicamente una representación en JSON.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(path=<span class="string"><span class="delimiter">&quot;</span><span class="content">/alta</span><span class="delimiter">&quot;</span></span>, method=RequestMethod.POST)
<span class="directive">public</span> <span class="predefined-type">String</span> getDescription(<span class="annotation">@RequestBody</span> UserStats stats){
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">resultado</span><span class="delimiter">&quot;</span></span>;
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">UserStats</span>{
    <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
    <span class="directive">private</span> <span class="predefined-type">String</span> lastName;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>En el ejemplo anterior, se convertirán a objeto, contenidos del <strong>body</strong> de la petición como por ejemplo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{ <span class="key"><span class="delimiter">&quot;</span><span class="content">firstName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Elmer</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Fudd</span><span class="delimiter">&quot;</span></span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para transformaciones a JSON, se emplea la siguiente libreria de <strong>Jackson</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.codehaus.jackson<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jackson-mapper-asl<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.4.2<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__responsebody">@ResponseBody</h4>
<div class="paragraph">
<p>Analogo al anterior, pero para generar un resultado.</p>
</div>
<div class="paragraph">
<p>Se aplica sobre métodos que retornan un objeto de información.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// controller</span>
<span class="annotation">@ResponseBody</span>
<span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/description</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Description getDescription(<span class="annotation">@RequestBody</span> UserStats stats){
    <span class="keyword">return</span> <span class="keyword">new</span> Description(stats.getFirstName() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + stats.getLastname() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> hates wacky wabbits</span><span class="delimiter">&quot;</span></span>);
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">UserStats</span>{
    <span class="directive">private</span> <span class="predefined-type">String</span> firstName;
    <span class="directive">private</span> <span class="predefined-type">String</span> lastName;
    <span class="comment">// + getters, setters</span>
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Description</span>{
    <span class="directive">private</span> <span class="predefined-type">String</span> description;
    <span class="comment">// + getters, setters, constructor</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Precisa dar de alta el API de marshall en el classpath.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.codehaus.jackson<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jackson-mapper-asl<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.4.2<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Es muy empleado en servicios REST.</p>
</div>
</div>
<div class="sect3">
<h4 id="_model">Model</h4>
<div class="paragraph">
<p>Se pueden añadir Beans .al objeto <strong>Model</strong> de un controlador en el ambito <strong>request</strong> con la anotación <strong>@ModelAttribute</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyController</span> {

        <span class="annotation">@ModelAttribute</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">public</span> Persona addPersonaToModel() {
                <span class="keyword">return</span> <span class="keyword">new</span> Persona(<span class="string"><span class="delimiter">&quot;</span><span class="content">Victor</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se puede asociar a la <strong>session</strong>, para ello se emplea la anotación <strong>@SessionAttributes("nombreDelBeanDelModeloAAlmacenarEnLosAtributosDeLaSession")</strong>, incluyendola como anotación de clase en la clase <strong>Controller</strong> que declare el bean del modelo con <strong>@ModelAttribute</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="annotation">@SessionAttributes</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyController</span> {

        <span class="annotation">@ModelAttribute</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">public</span> Persona addPersonaToModel() {
                <span class="keyword">return</span> <span class="keyword">new</span> Persona(<span class="string"><span class="delimiter">&quot;</span><span class="content">Victor</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los objetos en Model, pueden ser inyectados directamente en los métodos del controlador con <strong>@ModelAttribute</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/saludar</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">String</span> saludar (<span class="annotation">@ModelAttribute</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>) Persona persona, Model model) {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">exito</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_viewresolver">ViewResolver</h3>
<div class="paragraph">
<p>El último componente a definir del flujo es el <strong>ViewResolver</strong>, este componente se encarga de resolver que <strong>View</strong> se ha emplear a partir del objeto <strong>View</strong> retornado por el <strong>Controller</strong>.</p>
</div>
<div class="paragraph">
<p>Pueden existir distintos <strong>Bean</strong> definidos de tipo <strong>ViewResolver</strong>, pudiendose ordenar con la propiedad <strong>Order</strong>.</p>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Es importante que de emplear el InternalResourceViewResolver, este sea el ultimo (Valor mas alto).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Se proporcionan varias implementaciones, alguna de ellas</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>InternalResourceViewResolver</strong> &#8594; Es el más habitual, permite interpretar el <strong>String</strong> devuelto por el <strong>Controller</strong>, como parte de la url de un recurso, componiendo la URL con un prefijo y un sufijo.</p>
</li>
<li>
<p><strong>BeanNameViewResolver</strong> &#8594; Busca un <strong>Bean</strong> declarado de tipo <strong>View</strong> cuyo <strong>Id</strong> sea igual al <strong>String</strong> retornado por el <strong>Controller</strong>.</p>
</li>
<li>
<p><strong>ContentNegotiatingViewResolver</strong> &#8594; Delega en otros <strong>ViewResolver</strong> dependiendo del <strong>ContentType</strong>.</p>
</li>
<li>
<p><strong>FreeMarkerViewResolver</strong> &#8594; Similar al <strong>InternalResourceViewResolver</strong>, pero el recurso buscado debe ser una plantilla Freemarker.</p>
</li>
<li>
<p><strong>JasperReportsViewResolver</strong> &#8594; Similar al <strong>InternalResourceViewResolver</strong>, pero el recurso buscado debe ser una plantilla JasperReport.</p>
</li>
<li>
<p><strong>ResourceBundleViewResolver</strong> &#8594; Busca la implementacion de la View en un fichero de properties.</p>
</li>
<li>
<p><strong>TilesViewResolver</strong> &#8594; Busca una plantillas de <strong>Tiles</strong> con nombre igual al <strong>String</strong> retornado por el <strong>Controller</strong></p>
</li>
<li>
<p><strong>VelocityViewResolver</strong> &#8594; Similar al <strong>InternalResourceViewResolver</strong>, pero el recurso buscado debe ser una plantilla Velocity.</p>
</li>
<li>
<p><strong>XmlViewResolver</strong> &#8594; Similar a <strong>BeanNameViewResolver</strong>, salvo porque los <strong>Bean</strong> de las <strong>View</strong> han de ser declaradas en el fichero <strong>/WEB-INF/views.xml</strong></p>
</li>
<li>
<p><strong>XsltViewResolver</strong> &#8594; Similar al <strong>InternalResourceViewResolver</strong>, pero el recurso buscado debe ser una plantilla XSLT.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_internalresourceviewresolver">InternalResourceViewResolver</h4>
<div class="paragraph">
<p>Se ha de definir el Bean</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.view.InternalResourceViewResolver</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;propertyname</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">prefix</span><span class="error">&quot;</span><span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/views/</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;propertyname</span><span class="error">=</span><span class="error">&quot;</span><span class="attribute-name">suffix</span><span class="error">&quot;</span><span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.jsp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xmlviewresolver">XmlViewResolver</h4>
<div class="paragraph">
<p>Se ha de definir el Bean</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.view.XmlViewResolver</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">location</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/views.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y en el fichero <strong>/WEB-INF/views.xml</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pdf/listado</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.aplicacion.presentacion.vistas.ListadoPdfView</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">excel/listado</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.aplicacion.presentacion.vistas.ListadoExcelView</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json/listado</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.view.json.MappingJacksonJsonView</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_resourcebundleviewresolver">ResourceBundleViewResolver</h4>
<div class="paragraph">
<p>Se ha de definir el Bean</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewResolver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.view.ResourceBundleViewResolver</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basename</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">views</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y en el fichero <strong>views.properties</strong> que estará en la raiz del classpath.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">listado.(class)=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
listado.url=/WEB-INF/jasperTemplates/reporteAfines.jasper
listado.reportDataKey=listadoKey</code></pre>
</div>
</div>
<div class="paragraph">
<p>Donde <strong>url</strong> y <strong>reportDataKey</strong>, son propiedades del objeto <strong>JasperReportsPdfView</strong>, y <strong>listado</strong> el <strong>String</strong> que retorna el <strong>Controller</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_view">View</h3>
<div class="paragraph">
<p>Son los componentes que renderizaran la resuesta a la petición procesada por Spring MVC.</p>
</div>
<div class="paragraph">
<p>Existen diversas implementaciones dependiendo de la tecnologia encargada de renderizar.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AbstractExcelView</p>
</li>
<li>
<p>AbstractAtomFeedView</p>
</li>
<li>
<p>AbstractRssFeedView</p>
</li>
<li>
<p>MappingJackson2JsonView</p>
</li>
<li>
<p>MappingJackson2XmlView</p>
</li>
<li>
<p>AbstractPdfView</p>
</li>
<li>
<p>AbstractJasperReportView</p>
</li>
<li>
<p>AbstractPdfStamperView</p>
</li>
<li>
<p>AbstractTemplateView</p>
</li>
<li>
<p>InternalResourceView</p>
</li>
<li>
<p>JstlView &#8594; Es la que se emplea habitualmente para los JSP, exige la libreria JSTL.</p>
</li>
<li>
<p>TilesView</p>
</li>
<li>
<p>XsltView</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_abstractexcelview">AbstractExcelView</h4>
<div class="paragraph">
<p>El API de Spring proporciona una clase abstracta que esta destinada a hacer de puente entre el API capaz de generar un Excel y Spring, pero no genera el Excel, para ello hay que incluir una libreria como <strong>POI</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.apache.poi<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>poi<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.10.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Algunas de las clases que proporciona <strong>POI</strong> son</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HSSFWorkbook</p>
</li>
<li>
<p>HSSFSheet</p>
</li>
<li>
<p>HSSFRow</p>
</li>
<li>
<p>HSSFCell</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PoiExcellView</span> <span class="directive">extends</span> AbstractExcelView {
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">void</span> buildExcelDocument(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; model, HSSFWorkbook workbook, HttpServletRequest request, HttpServletResponse response) <span class="directive">throws</span> <span class="exception">Exception</span> {
                <span class="comment">// model es el objeto Model que viene del Controller</span>
        <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; listBooks = (<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt;) model.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">listBooks</span><span class="delimiter">&quot;</span></span>);
        <span class="comment">// Crear una nueva hoja excel</span>
        HSSFSheet sheet = workbook.createSheet(<span class="string"><span class="delimiter">&quot;</span><span class="content">Java Books</span><span class="delimiter">&quot;</span></span>);
        sheet.setDefaultColumnWidth(<span class="integer">30</span>);
        HSSFRow header = sheet.createRow(<span class="integer">0</span>);
        header.createCell(<span class="integer">0</span>).setCellValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Book Title</span><span class="delimiter">&quot;</span></span>);
        header.createCell(<span class="integer">1</span>).setCellValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Author</span><span class="delimiter">&quot;</span></span>);
        <span class="type">int</span> rowCount = <span class="integer">1</span>;
        <span class="keyword">for</span> (<span class="predefined-type">Book</span> aBook : listBooks) {
            HSSFRow aRow = sheet.createRow(rowCount++);
            aRow.createCell(<span class="integer">0</span>).setCellValue(aBook.getTitle());
            aRow.createCell(<span class="integer">1</span>).setCellValue(aBook.getAuthor());
        }
        response.setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-disposition</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">attachment; filename=books.xls</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abstractpdfview">AbstractPdfView</h4>
<div class="paragraph">
<p>De forma analoga al anterior, para los PDF, se tiene la libreria <strong>Lowagie</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>com.lowagie<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>itext<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>4.2.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Algunas de las clases que proporciona <strong>Lowagie</strong> son</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Document</p>
</li>
<li>
<p>PdfWriter</p>
</li>
<li>
<p>Paragraph</p>
</li>
<li>
<p>Table</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ITextPdfView</span> <span class="directive">extends</span> AbstractPdfView {
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">void</span> buildPdfDocument(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; model, <span class="predefined-type">Document</span> doc, PdfWriter writer, HttpServletRequest request, HttpServletResponse response) <span class="directive">throws</span> <span class="exception">Exception</span> {
                <span class="comment">// model es el objeto Model que viene del Controller</span>
                 <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; listBooks = (<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt;) model.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">listBooks</span><span class="delimiter">&quot;</span></span>);
        doc.add(<span class="keyword">new</span> Paragraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">Recommended books for Spring framework</span><span class="delimiter">&quot;</span></span>));
        Table table = <span class="keyword">new</span> Table(<span class="integer">2</span>);
                table.addCell(<span class="string"><span class="delimiter">&quot;</span><span class="content">Book Title</span><span class="delimiter">&quot;</span></span>);
                table.addCell(<span class="string"><span class="delimiter">&quot;</span><span class="content">Author</span><span class="delimiter">&quot;</span></span>);
                <span class="keyword">for</span> (<span class="predefined-type">Book</span> aBook : listBooks) {
            table.addCell(aBook.getTitle());
            table.addCell(aBook.getAuthor());
        }
        doc.add(table);
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jasperreportspdfview">JasperReportsPdfView</h4>
<div class="paragraph">
<p>En este caso Spring proporciona una clase concreta, que es capaz de procesar las platillas de <strong>JasperReports</strong>, lo unico que necesita es la libreria de <strong>JaspertReport</strong>, la plantilla compilada <strong>jasper</strong> y un objeto <strong>JRBeanCollectionDataSource</strong> que contenga la información a representar en la plantilla.</p>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>La plantilla sin compilar será un fichero <strong>jrxml</strong>, que es un xml editable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>jasperreports<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jasperreports<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>3.5.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>A tener en cuenta que la version de la libreria de JasperReport debe coincidir con la del programa iReport empleando para generar la plantilla.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reporteAfines</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/jasperTemplates/reporte.jasper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">reportDataKey</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">listadoKey</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p><strong>reportDataKey</strong> indica la clave dentro del objeto <strong>Model</strong> que referencia al objeto <strong>JRBeanCollectionDataSource</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AfinesReportController</span> {
        <span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/reporte</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">public</span> <span class="predefined-type">String</span> generarReporteAfines(Model model){
                JRBeanCollectionDataSource jrbean = <span class="keyword">new</span> JRBeanCollectionDataSource(listado, <span class="predefined-constant">false</span>);
                model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">listadoKey</span><span class="delimiter">&quot;</span></span>, jrbean);
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">reporteAfines</span><span class="delimiter">&quot;</span></span>;
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mappingjackson2jsonview">MappingJackson2JsonView</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>jackson-databind<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>2.4.1<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Es para versiones de Spring posteriores a 4, para la 3 se emplea otro API y la clase <strong>MappingJacksonJsonView</strong></p>
</div>
<div class="paragraph">
<p>Los Bean a convertir a JSON, han de tener propiedades.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_formularios">Formularios</h3>
<div class="paragraph">
<p>Para trabajar con formularios Spring proporciona una libreria de etiquetas</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="error">&lt;</span>%@ taglibprefix=&quot;sf“ uri=&quot;http://www.springframework.org/tags/form&quot;%<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="imageblock thumb">
<div class="content">
<img src="images/mvc_etiquetas_formularios.png" alt="mvc etiquetas formularios">
</div>
</div>
<div class="paragraph">
<p>Un ejemplo de definición de formulario podria ser</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;form:form</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">altaUsuario</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">modelAttribute</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;table&gt;</span>
                <span class="tag">&lt;tr&gt;</span>
                        <span class="tag">&lt;td&gt;</span>Nombre:<span class="tag">&lt;/td&gt;</span>
                        <span class="tag">&lt;td&gt;</span><span class="tag">&lt;form:input</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
                <span class="tag">&lt;/tr&gt;</span>
                <span class="tag">&lt;tr&gt;</span>
                        <span class="tag">&lt;td&gt;</span>Apellidos:<span class="tag">&lt;/td&gt;</span>
                        <span class="tag">&lt;td&gt;</span><span class="tag">&lt;form:input</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">apellidos</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/td&gt;</span>
                <span class="tag">&lt;/tr&gt;</span>
                <span class="tag">&lt;tr&gt;</span>
                        <span class="tag">&lt;td&gt;</span>Sexo:<span class="tag">&lt;/td&gt;</span>
                        <span class="tag">&lt;form:select</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sexo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">items</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${listadoSexos}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/tr&gt;</span>
                <span class="tag">&lt;tr&gt;</span>
                        <span class="tag">&lt;td</span> <span class="attribute-name">colspan</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Guardar info</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                        <span class="tag">&lt;/td&gt;</span>
                <span class="tag">&lt;/tr&gt;</span>
        <span class="tag">&lt;/table&gt;</span>
<span class="tag">&lt;/form:form&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>No es necesario definir el action si se emplea la misma url para cargar el formulario y para recibirlo, basta con cambiar unicamente el METHOD HTTP
No hay diferencia entre <strong>commandName</strong> y <strong>modelAtribute</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>En el ejemplo anterior, se han definido a nivel del formulario.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>action</strong> &#8594; Indica la Url del Controlador.</p>
</li>
<li>
<p><strong>modelAttribute</strong> &#8594; Indica la clave con la que se envía el objeto que se representa en el formulario. (de forma analoga se puede emplear <strong>commandName</strong>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para recuperar en el controlador el objeto enviado, se emplea la anotación <strong>@ModelAttribute</strong></p>
</div>
<div class="paragraph">
<p>El objeto que se representa en el formulario ha de existir al representar el formulario.
Es típico para los formularios definir dos controladores uno GET y otro POST.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>El GET inicializara el objeto.</p>
</li>
<li>
<p>El POST tratara el envío del formulario.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">altaPersona</span><span class="delimiter">&quot;</span></span>, method=RequestMethod.GET)
<span class="directive">public</span> <span class="predefined-type">String</span> inicializacionFormularioAltaPersonas(Model model){
        Persona p = <span class="keyword">new</span> Persona(<span class="predefined-constant">null</span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hombre</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">null</span>);
        model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>, p);
        model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">listadoSexos</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span>{<span class="string"><span class="delimiter">&quot;</span><span class="content">Hombre</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">Mujer</span><span class="delimiter">&quot;</span></span>});
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">formularioAltaPersona</span><span class="delimiter">&quot;</span></span>;
}
<span class="annotation">@RequestMapping</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">altaPersona</span><span class="delimiter">&quot;</span></span>, method=RequestMethod.POST)
<span class="directive">public</span> <span class="predefined-type">String</span> procesarFormularioAltaPersonas(
        <span class="annotation">@ModelAttribute</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>) Persona p,  Model model){
                servicio.altaPersona(p);
                model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">estado</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span>);
                model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>, p);
                model.addAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">listadoSexos</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">Hombre</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">Mujer</span><span class="delimiter">&quot;</span></span>});
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">formularioAltaPersona</span><span class="delimiter">&quot;</span></span>;
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_etiquetas">Etiquetas</h4>
<div class="paragraph">
<p>Spring proporciona dos librerias de etiquetas</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Formularios</p>
</li>
<li>
<p><strong>&lt;form:form&gt;&lt;/form:form&gt;</strong> &#8594; Crea una etiqueta HTML form.</p>
</li>
<li>
<p><strong>&lt;form:errors&gt;&lt;/form:errors&gt;</strong> &#8594; Permite la visualización de los errores asociados a los campos del <strong>ModelAttribute</strong></p>
</li>
<li>
<p><strong>&lt;form:checkboxes items="" path=""/&gt;</strong> &#8594;</p>
<div class="literalblock">
<div class="content">
<pre>&lt;form:checkbox path=""/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:hidden path=""/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:input path=""/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:label path=""&gt;&lt;/form:label&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:textarea path=""/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:password path=""/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:radiobutton path=""/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:radiobuttons path=""/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:select path=""&gt;&lt;/form:select&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:option value=""&gt;&lt;/form:option&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:options/&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;form:button&gt;&lt;/form:button&gt;</pre>
</div>
</div>
</li>
<li>
<p>Core</p>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:argument&gt;&lt;/spring:argument&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:bind path=""&gt;&lt;/spring:bind&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:escapeBody&gt;&lt;/spring:escapeBody&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:eval expression=""&gt;&lt;/spring:eval&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:hasBindErrors name=""&gt;&lt;/spring:hasBindErrors&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:htmlEscape defaultHtmlEscape=""&gt;&lt;/spring:htmlEscape&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:message&gt;&lt;/spring:message&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:nestedPath path=""&gt;&lt;/spring:nestedPath&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:param name=""&gt;&lt;/spring:param&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:theme&gt;&lt;/spring:theme&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:transform value=""&gt;&lt;/spring:transform&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;spring:url value=""&gt;&lt;/spring:url&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_paths_absolutos">Paths Absolutos</h4>
<div class="paragraph">
<p>En ocasiones, se requiere acceder a un controlador desde distintas JSP, las cuales estan a distinto nivel en el path, por ejemplo desde <strong>/gestion/persona</strong> y desde <strong>/administracion</strong>, se quiere acceder a <strong>/buscar</strong>, teniendo en cuenta que la propiedad <strong>action</strong> representa un path relativo, no serviria en mismo formulario, salvo que se pongan path absolutos, para los cual, se necesita obtener la url de la aplicación, hay varias alternativas</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Expresiones EL</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="HTML"><span class="tag">&lt;form</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${pageContext.request.contextPath}/buscar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Libreria de etquetas JSTL core</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="HTML"><span class="tag">&lt;form</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;c:url value=</span><span class="delimiter">&quot;</span></span><span class="error">/</span><span class="attribute-name">buscar</span><span class="error">&quot;</span> <span class="tag">/&gt;</span>&quot; method=&quot;GET&quot; /<span class="error">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_inicialización">Inicialización</h4>
<div class="paragraph">
<p>Otra opción para inicializar los objetos necesarios para el formulario, sería crear un método anotado con <strong>@ModelAttribute</strong>, indicando la clave del objeto del Modelo que disparará la ejecución de este método.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ModelAttribute</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Persona initPersona(){
        <span class="keyword">return</span> <span class="keyword">new</span> Persona();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validaciones">Validaciones</h3>
<div class="paragraph">
<p>Spring MVC soporta validaciones de JSR-303.</p>
</div>
<div class="paragraph">
<p>Para aplicarlas se necesita una implementación como <strong>hibernate-validator</strong>, para añadirla con Maven.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.hibernate<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>hibernate-validator<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>5.1.3.Final<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para activar la validación entre <strong>View</strong> y <strong>Controller</strong>, se añade a los parámetros de los métodos del <strong>Controller</strong>, la anotación <strong>@Valid</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(method = RequestMethod.POST)
<span class="directive">public</span> Persona altaPersona(<span class="annotation">@Valid</span> <span class="annotation">@RequestBody</span> Persona persona) {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Si además se quiere conocer el estado de la validación para ejecutar la lógica del controlador, se puede indicar en los parámetros que se recibe un objeto <strong>Errors</strong>, que tiene un método <strong>hasErrors()</strong> que indica si hay errores de validación.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> altaPersona(<span class="annotation">@Valid</span> <span class="annotation">@ModelAttribute</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">persona</span><span class="delimiter">&quot;</span></span>) Persona p,
        Errors errors, Model model){}

        <span class="keyword">if</span> (errors.hasErrors()) {
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>;
        } <span class="keyword">else</span> {
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">ok</span><span class="delimiter">&quot;</span></span>;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y en la clase del <strong>Model</strong>, las anotaciones correspondientes de JSR-303</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">Persona</span> {
        <span class="annotation">@NotEmpty</span>(message=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hay que rellenar el campo nombre</span><span class="delimiter">&quot;</span></span>)
        <span class="directive">private</span> <span class="predefined-type">String</span> nombre;
        <span class="annotation">@NotEmpty</span>
        <span class="directive">private</span> <span class="predefined-type">String</span> apellido;
        <span class="directive">private</span> <span class="type">int</span> edad;
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_mensajes_personalizados">Mensajes personalizados</h4>
<div class="paragraph">
<p>Como se ve en el anterior ejemplo, se ha personalizado el mensaje para la validación <strong>@NotEmpty</strong> del campo <strong>nombre</strong></p>
</div>
<div class="paragraph">
<p>Se puede definir el mensaje en un properties, teniendo en cuenta que el property tendra la siguiente firma</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">&lt;validador&gt;.&lt;entidad&gt;.&lt;caracteristica&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Por ejemplo para la validación anterior de <strong>nombre</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">notempty.persona.nombre = Hay que rellenar el campo nombre</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se puede referenciar a una propiedad cualquiera, pudiendo ser cualquier clave.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@NotEmpty</span>(message=<span class="string"><span class="delimiter">&quot;</span><span class="content">{notempty.persona.nombre}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">String</span> nombre;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_anotaciones_jsr_303">Anotaciones JSR-303</h4>
<div class="paragraph">
<p>Las anotaciones están definidas en el paquete <strong>javax.validation.constraints</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@Max</strong></p>
</li>
<li>
<p><strong>@Min</strong></p>
</li>
<li>
<p><strong>@NotNull</strong></p>
</li>
<li>
<p><strong>@Null</strong></p>
</li>
<li>
<p><strong>@Future</strong></p>
</li>
<li>
<p><strong>@Past</strong></p>
</li>
<li>
<p><strong>@Size</strong></p>
</li>
<li>
<p><strong>@Pattern</strong></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_validaciones_custom">Validaciones Custom</h4>
<div class="paragraph">
<p>Se pueden definir validadores nuevos e incluirlos en la validación automatizada, para ello hay que implementar la interface <strong>org.springframework.validation.Validator</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PersonaValidator</span> <span class="directive">implements</span> <span class="predefined-type">Validator</span> {
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">boolean</span> supports(<span class="predefined-type">Class</span>&lt;?&gt; clazz) {
                <span class="keyword">return</span> Persona.class.equals(clazz);
        }
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> validate(<span class="predefined-type">Object</span> obj, Errors e) {
                Persona persona = (Persona) obj;
                e.rejectValue(<span class="string"><span class="delimiter">&quot;</span><span class="content">nombre</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">formulario.persona.error.nombre</span><span class="delimiter">&quot;</span></span>);
        }
}</code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>El metodo de supports, indica que clases se soportan para esta validación, si retornase true, aceptaria todas, no es lo habitual ya que tendrá al menos una caracteristica concreta que será la validada.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Una vez definido el validador, para añadirlo al flujo de validación de un <strong>Controller</strong>, se ha de añadir una instancia de ese validador al <strong>Binder</strong> del <strong>Controller</strong>, creando un método en el <strong>Controller</strong>, anotado con <strong>@InitBinder</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@InitBinder</span>
<span class="directive">protected</span> <span class="type">void</span> initBinder(<span class="directive">final</span> WebDataBinder binder) {
        binder.addValidators(<span class="keyword">new</span> PersonaValidator());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Los errores asociados a estas validaciones pueden ser visualizados en la <strong>View</strong> empleando la etiqueta <strong>&lt;form:errors/&gt;</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;form:errors</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>La propiedad path, es el camino que hay que seguir en el objeto de <strong>Model</strong> para acceder a la propiedad validada.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_internacionalización_i18n">Internacionalización - i18n</h3>
<div class="paragraph">
<p>Para poder aplicar la internacionalización, hay que trabajar con ficheros properties manejados como <strong>Bundles</strong>, esto en Spring se consigue definiendo un <strong>Bean</strong> con id <strong>messageSource</strong> de tipo <strong>AbstractMessageSource</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.context.support.ReloadableResourceBundleMessageSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basename</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/WEB-INF/messages/messages</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez defido el Bean deberán existir tantos ficheros como idiomas soportados con la firma</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="path">/WEB-INF/messages/messages_&lt;COD-PAIS&gt;_&lt;COD-DIALECTO&gt;.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Como por ejemplo</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="path">/WEB-INF/messages/messages_es.properties
/WEB-INF/messages/messages_es_es.properties
/WEB-INF/messages/messages_en.properties</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para acceder a estos mensajes desde las <strong>View</strong> existe una libreria de etiquetas</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="error">&lt;</span>%@ taglib uri=&quot;http://www.springframework.org/tags&quot; prefix=&quot;spring&quot;%<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Que porporciona la etiqueta</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:message</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;clave en el properties</span></span><span class="error">&gt;</span>&quot;/<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien es posible emplear JSTL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>jstl<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>jstl<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>1.2<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="error">&lt;</span>%@ taglib prefix=&quot;fmt&quot; uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; %<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;fmt:message</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;clave en el properties</span></span><span class="error">&gt;</span>&quot;/<span class="error">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interceptor">Interceptor</h3>
<div class="paragraph">
<p>Permiten interceptar las peticiones al <strong>DispatcherServlet</strong>.</p>
</div>
<div class="paragraph">
<p>Son clases que extienden de <strong>HandlerInterceptorAdapter</strong>, que permite actuar sobre la petición con tres métodos.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>preHandle()</strong> –&gt; Se invoca antes que se ejecute la petición, retorna un booleano, si es <strong>True</strong> continua la ejecución normalmente, si es <strong>False</strong> la para.</p>
</li>
<li>
<p><strong>postHandle()</strong> –&gt; Se invoca despues de que se ejecute la petición, permite manipular el objeto <strong>ModelAndView</strong> antes de pasarselo a la <strong>View</strong>.</p>
</li>
<li>
<p><strong>afterCompletion()</strong> –&gt; Called after the complete request has finished. Seldom use, cant find any use case.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los <strong>Interceptor</strong> pueden ser asociados</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A cada <strong>HandlerMapping</strong> en particular, con la propiedad <strong>interceptors</strong>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.handler.SimpleUrlHandlerMapping</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;props&gt;</span>
                        <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/index.html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>indexController<span class="tag">&lt;/prop&gt;</span>
                <span class="tag">&lt;/props&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;list&gt;</span>
                        <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auditoriaInterceptor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
                <span class="tag">&lt;/list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">auditoriaInterceptor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.mvc.interceptor.AuditoriaInterceptor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">indexController</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.mvc.interceptor.IndexController</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>O de forma general a todos</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con XML, se emplearia la etiqueta del namespace <strong>mvc</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mvc:interceptors&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.ejemplo.mvc.interceptor.AuditoriaInterceptor</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/mvc:interceptors&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con JavaConfig, sobreescribiendo el método <strong>addInterceptors</strong> obtenido por la herencia de <strong>WebMvcConfigurerAdapter</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@EnableWebMvc</span>
<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">WebConfig</span> <span class="directive">extends</span> WebMvcConfigurerAdapter {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(<span class="keyword">new</span> LocaleInterceptor());
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se proporcionan las siguientes implementaciones</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ConversionServiceExposingInterceptor</strong> &#8594; Situa el <strong>ConversionService</strong> en la <strong>request</strong>.</p>
</li>
<li>
<p><strong>LocaleChangeInterceptor</strong> &#8594; Permite interpretar el parámetro <strong>locale</strong> de la petición para cambiar el <strong>Locale</strong> de la aplicación.</p>
</li>
<li>
<p><strong>ResourceUrlProviderExposingInterceptor</strong> &#8594; Situa el <strong>ResourceUrlProvider</strong> en la <strong>request</strong>.</p>
</li>
<li>
<p><strong>ThemeChangeInterceptor</strong> &#8594; Permite interpretar el parámetro <strong>theme</strong> de la petición para cambiar el <strong>Tema</strong> (conjunto de estilos) de la aplicación.</p>
</li>
<li>
<p><strong>UriTemplateVariablesHandlerInterceptor</strong> &#8594; Se encarga de resolver las variables del Path y ponerlas en la <strong>request</strong>.</p>
</li>
<li>
<p><strong>UserRoleAuthorizationInterceptor</strong> &#8594; Compreba la autorizacion del usuario actual, validando sus roles.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_localechangeinterceptor">LocaleChangeInterceptor</h4>
<div class="paragraph">
<p>Se declara el <strong>Interceptor</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mvc:interceptors&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localeChangeInterceptor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.i18n.LocaleChangeInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">paramName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">language</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/mvc:interceptors&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para cambiar el <strong>Locale</strong> basta con acceder a la URL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="URL">http://...................?language=es</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Por defecto el parametro que representa el codigo idiomatico es <strong>locale</strong></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Se puede configurar como se almacena la referencia al <strong>Locale</strong>, para ello basta con definir un Bean llamado <strong>localeResolver</strong> de tipo</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para almacenamiento en una <strong>Cookie</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localeResolver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.i18n.CookieLocaleResolver</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultLocale</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">es</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cookieName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAppLocaleCookie</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cookieMaxAge</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3600</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Para almacenamiento en la <strong>Session</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localeResolver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.i18n.SessionLocaleResolver</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>El por defecto, busca en la cabecera <strong>accept-language</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localeResolver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_themechangeinterceptor">ThemeChangeInterceptor</h4>
<div class="paragraph">
<p>Se declara el <strong>Interceptor</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;mvc:interceptors&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">themeChangeInterceptor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.theme.ThemeChangeInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">paramName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theme</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/mvc:interceptors&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para cambiar el <strong>Tema</strong> basta con acceder a la URL</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="URL">http://...................?theme=aqua</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se ha de declarar un Bean que indique el nombre del fichero <strong>properties</strong> que almacenará el nombre de los ficheros de estilos a emplear en cada <strong>Tema</strong>, este Bean se ha de llamar <strong>themeSource</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">themeSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ui.context.support.ResourceBundleThemeSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basenamePrefix</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">theme-</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede configurar como se almacena la referencia al <strong>Tema</strong>, para ello basta con definir un Bean llamado <strong>themeResolver</strong> de tipo</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para almacenamiento en una <strong>Cookie</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">themeResolver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.theme.CookieThemeResolver</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultThemeName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Para almacenamiento en la <strong>Session</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">themeResolver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.i18n.SessionThemeResolver</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultThemeName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para poder aplicar alguna de las hojas de estilos definidas en el tema, se puede emplear la etiqueta <strong>spring:theme</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;link</span><span class="error"> </span> <span class="attribute-name">rel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stylesheet</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;spring:theme code='css'/</span></span><span class="error">&gt;</span>&quot; type=&quot;text/css&quot; /<span class="error">&gt;</span>

<span class="tag">&lt;spring:theme</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">welcome.message</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rest">Rest</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Los servicios REST son servicios basados en recursos, montados sobre HTTP, donde se da significado al Method HTTP.</p>
</div>
<div class="paragraph">
<p>La palabra REST viene de</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Representacion</strong>: Permite representar los recursos en multiples formatos, aunque el mas habitual es JSON.</p>
</li>
<li>
<p><strong>Estado</strong>: Se centra en el estado del recurso y no en las operaciones que se pueden realizar con el.</p>
</li>
<li>
<p><strong>Transferencia</strong>: Transfiere los recursos al cliente.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Los significados que se dan a los Method HTTP son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>POST</strong>: Permite crear un nuevo recurso.</p>
</li>
<li>
<p><strong>GET</strong>: Permite leer/obtener un recurso existente.</p>
</li>
<li>
<p><strong>PUT</strong> o <strong>PATCH</strong>: Permiten actualizar un recurso existente.</p>
</li>
<li>
<p><strong>DELETE</strong>: Permite borrar un recurso.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Spring MVC, ofrece una anotacion <strong>@RestController</strong>, que auna las anotaciones <strong>@Controller</strong> y <strong>@ResponseBody</strong>, esta ultima empleada para representar la respuesta directamente con los objetos retornados por los métodos de controlador.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RestController</span>
<span class="annotation">@RequestMapping</span>(path=<span class="string"><span class="delimiter">&quot;</span><span class="content">/personas</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ServicioRestPersonaControlador</span> {

        <span class="annotation">@RequestMapping</span>(path=<span class="string"><span class="delimiter">&quot;</span><span class="content">/{id}</span><span class="delimiter">&quot;</span></span>, method= RequestMethod.GET, produces=MediaType.APPLICATION_JSON_VALUE)
        <span class="directive">public</span> Persona getPersona(<span class="annotation">@PathVariable</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> id){
                <span class="keyword">return</span> <span class="keyword">new</span> Persona(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">victor</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">herrero</span><span class="delimiter">&quot;</span></span>, <span class="integer">37</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">M</span><span class="delimiter">&quot;</span></span>, <span class="float">1.85</span>);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>De esta representación se encargan los <strong>HttpMessageConverter</strong>.</p>
</div>
<div class="sect2">
<h3 id="_httpmessageconverter">HttpMessageConverter</h3>
<div class="paragraph">
<p>Son los encargados de procesar objetos a su representacion en JSON, XML, etc&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Tienen en cuenta la cabecera <strong>Accept</strong> de la petición HTTP para la respuesta y la cabecera <strong>Content-Type</strong> para los datos que llegan en el cuerpo de la petición.</p>
</div>
<div class="paragraph">
<p>Por defecto se tienen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ByteArrayHttpMessageConverter</strong> &#8594; convierte los arrays de bytes</p>
</li>
<li>
<p><strong>StringHttpMessageConverter</strong> &#8594; convierte las cadenas de caracteres</p>
</li>
<li>
<p><strong>ResourceHttpMessageConverter</strong> &#8594; convierte a objetos <strong>org.springframework.core.io.Resource</strong> desde y hacia cualquier <strong>Stream</strong>.</p>
</li>
<li>
<p><strong>SourceHttpMessageConverter</strong> &#8594; convierte a <strong>javax.xml.transform.Source</strong></p>
</li>
<li>
<p><strong>FormHttpMessageConverter</strong> &#8594; convierte datos de formulario (application/x-www-form-urlencoded) desde y hacia un <strong>MultiValueMap&lt;String, String&gt;</strong>.</p>
</li>
<li>
<p><strong>Jaxb2RootElementHttpMessageConverter</strong> &#8594; convierte objetos Java desde y hacia XML, con media type <strong>text/xml</strong> o <strong>application/xml</strong> (solo sí la librería de JAXB2 está presente en el classpath).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>2.5.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>MappingJackson2HttpMessageConverter</strong> &#8594; convierte objetos Java desde y hacia JSON (solo sí la librería de Jackson2 está presente en el classpath).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>jackson-databind<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>2.5.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>MappingJacksonHttpMessageConverter</strong> &#8594; convierte objetos Java desde y hacia JSON (sólo si la librería de Jackson está presente en el classpath).</p>
</li>
<li>
<p><strong>AtomFeedHttpMessageConverter</strong> &#8594; convierte objetos Java del tipo <strong>Feed</strong> que proporciona la librería Rome desde y hacia feeds Atom, media type <strong>application/atom+xml</strong> (solo si si la librería Roma está presente en el classpath).</p>
</li>
<li>
<p><strong>RssChannelHttpMessageConverter</strong> &#8594; convierte objetos Java del tipo <strong>Channel</strong> que proporciona la librería Rome desde y hacia
feeds RSS (sólo si si la librería Roma está presente en el classpath).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_personalizar_el_mapping_de_la_entidad">Personalizar el Mapping de la entidad</h3>
<div class="paragraph">
<p>En transformaciones a XML o JSON, de querer personalizar el Mapping de la entidad retornada, se puede hacer empleando las anotaciones de JAXB, como son <strong>@XmlRootElement</strong>, <strong>@XmlElement</strong> o <strong>@XmlAttribute</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_estado_de_la_petición">Estado de la petición</h3>
<div class="paragraph">
<p>Cuando se habla de servicios REST, es importante ofrecer el estado de la petición al cliente, para ello se emplea el codigo de estado de HTTP.</p>
</div>
<div class="paragraph">
<p>Para incluir este codigo en las respuestas, se puede encapsular las entidades retornadas con <strong>ResponseEntity</strong>, el cual es capaz de representar tambien el codigo de estado con las constantes de <strong>HttpStatus</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RequestMapping</span>(value=<span class="string"><span class="delimiter">&quot;</span><span class="content">/{id}</span><span class="delimiter">&quot;</span></span>, method=RequestMethod.GET)
<span class="directive">public</span> ResponseEntity&lt;Spittle&gt; spittleById(<span class="annotation">@PathVariable</span> <span class="type">long</span> id) {
        Spittle spittle = spittleRepository.findOne(id);
        HttpStatus status = spittle != <span class="predefined-constant">null</span> ? HttpStatus.OK : HttpStatus.NOT_FOUND;
        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(spittle, status);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_localización_del_recurso">Localización del recurso</h3>
<div class="paragraph">
<p>En la creación del recurso, peticion POST, se ha de retornar en la cabera <strong>location</strong> de la respuesta la Url para acceder al recurso que se acaba de generar, siendo estas cabeceras retornadas gracias de nuevo al objeto <strong>ResponseEntity</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">HttpHeaders headers = <span class="keyword">new</span> HttpHeaders();
<span class="predefined-type">URI</span> locationUri = <span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/spittr/spittles/</span><span class="delimiter">&quot;</span></span> + spittle.getId());
headers.setLocation(locationUri);
ResponseEntity&lt;Spittle&gt; responseEntity = <span class="keyword">new</span> ResponseEntity&lt;Spittle&gt;(spittle, headers, HttpStatus.CREATED)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cliente_se_servicios_con_resttemplate">Cliente se servicios con RestTemplate</h3>
<div class="paragraph">
<p>Las operaciones que se pueden realizar con RestTemplate son</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Delete</strong> &#8594; Realiza una petición DELETE HTTP en un recurso en una URL especificada</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> deleteSpittle(<span class="type">long</span> id) {
        RestTemplate rest = <span class="keyword">new</span> RestTemplate();
        rest.delete(<span class="predefined-type">URI</span>.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/spittr-api/spittles/</span><span class="delimiter">&quot;</span></span> + id));
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Exchange</strong> &#8594; Ejecuta un método HTTP especificado contra una URL, devolviendo un ResponseEntity que contiene un objeto mapeado del cuerpo de respuesta</p>
</li>
<li>
<p><strong>Execute</strong> &#8594; Ejecuta un método HTTP especificado contra una URL, devolviendo un objeto mapeado en el cuerpo de la respuesta.</p>
</li>
<li>
<p><strong>GetForEntity</strong> &#8594; Envía una solicitud HTTP GET, devolviendo un ResponseEntity que contiene un objeto mapeado del cuerpo de respuesta</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Spittle fetchSpittle(<span class="type">long</span> id) {
        RestTemplate rest = <span class="keyword">new</span> RestTemplate();
        ResponseEntity&lt;Spittle&gt; response = rest.getForEntity(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/spittr-api/spittles/{id}</span><span class="delimiter">&quot;</span></span>, Spittle.class, id);
        <span class="keyword">if</span>(response.getStatusCode() == HttpStatus.NOT_MODIFIED) {
                <span class="keyword">throw</span> <span class="keyword">new</span> NotModifiedException();
        }
                <span class="keyword">return</span> response.getBody();
        }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>GetForObject</strong> &#8594; Envía una solicitud HTTP GET, devolviendo un objeto asignado desde un cuerpo de respuesta</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Spittle<span class="type">[]</span> fetchFacebookProfile(<span class="predefined-type">String</span> id) {
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; urlVariables = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>();
        urlVariables.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, id);
        RestTemplate rest = <span class="keyword">new</span> RestTemplate();
        <span class="keyword">return</span> rest.getForObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://graph.facebook.com/{spitter}</span><span class="delimiter">&quot;</span></span>,        Profile.class, urlVariables);
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>HeadForHeaders</strong> &#8594; Envía una solicitud HTTP HEAD, devolviendo los encabezados HTTP para los URL de recursos</p>
</li>
<li>
<p><strong>OptionsForAllow</strong> &#8594; Envía una solicitud HTTP OPTIONS, devolviendo el encabezado Allow URL especificada</p>
</li>
<li>
<p><strong>PostForEntity</strong> &#8594; Envia datos en el cuerpo de una URL, devolviendo una ResponseEntity que contiene un objeto en el cuerpo de respuesta</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        RestTemplate rest = <span class="keyword">new</span> RestTemplate();
        ResponseEntity&lt;Spitter&gt; response = rest.postForEntity(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/spittr-api/spitters</span><span class="delimiter">&quot;</span></span>, spitter, Spitter.class);
        Spitter spitter = response.getBody();
        <span class="predefined-type">URI</span> url = response.getHeaders().getLocation();
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>PostForLocation</strong> &#8594; POSTA datos en una URL, devolviendo la URL del recurso recién creado</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">String</span> postSpitter(Spitter spitter) {
        RestTemplate rest = <span class="keyword">new</span> RestTemplate();
        <span class="keyword">return</span> rest.postForLocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/spittr-api/spitters</span><span class="delimiter">&quot;</span></span>, spitter).toString();
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>PostForObject</strong> &#8594; POSTA datos en una URL, devolviendo un objeto mapeado de la respuesta cuerpo</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Spitter postSpitterForObject(Spitter spitter) {
        RestTemplate rest = <span class="keyword">new</span> RestTemplate();
        <span class="keyword">return</span> rest.postForObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/spittr-api/spitters</span><span class="delimiter">&quot;</span></span>, spitter, Spitter.class);
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Put</strong> &#8594; PUT pone los datos del recurso en la URL especificada</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> updateSpittle(Spittle spittle) <span class="directive">throws</span> SpitterException {
        RestTemplate rest = <span class="keyword">new</span> RestTemplate();
        <span class="predefined-type">String</span> url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/spittr-api/spittles/</span><span class="delimiter">&quot;</span></span> + spittle.getId();
        rest.put(<span class="predefined-type">URI</span>.create(url), spittle);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_webservice">Spring WebService</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Framework que permite publicar Beans de Spring como Servicios Web SOAP.</p>
</div>
<div class="paragraph">
<p>La más nueva especificación en JEE para los Servicios Web SOAP, es JAX-WS, proporciona anotaciones como @WebService y @WebMethod.</p>
</div>
<div class="sect2">
<h3 id="_servicio_standalone">Servicio Standalone</h3>
<div class="paragraph">
<p>La JRE a partir de 1.6, proporciona una implementacion de JAX-WS, la cual se puede emplear con Spring para publicar un servicio, para ello, se debe crear un Bean de Spring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ServicioEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.curso.spring.Servicio</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Anotando la clase con <strong>@WebService</strong> y los métodos expuestos con <strong>@WebMethod</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@WebService</span>(serviceName=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicio</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">Servicio</span> {
  <span class="annotation">@WebMethod</span>
  <span class="directive">public</span> Persona metodo(Persona persona){
    <span class="comment">//Implementacion del servicio</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y declarar un bean de Spring de tipo <strong>SimpleJaxWsServiceExporter</strong> que buscará todos aquellos Bean de Spring anotados con las etiquetas del estandar JAX-WS (@Webservice) y los publicará como EndPoint, por defecto en <strong><a href="http://localhost:8080" class="bare">http://localhost:8080</a></strong>, aunque a través del objeto <strong>SimpleJaxWsServiceExporter</strong> se tiene control sobre las caracteristicas del servicio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.jaxws.SimpleJaxWsServiceExporter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baseAddress</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Basta con cargar el contexto de Spring para que se instancie el <strong>SimpleJaxWsServiceExporter</strong>, y el servicio quedará publicado.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">ApplicationContext.xml</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cliente_servicio">Cliente Servicio</h3>
<div class="paragraph">
<p>Para consumir el servicio el propio API proporciona una implementación de un Proxy <strong>JaxWsPortProxyFactoryBean</strong>, el cual absorbe toda la problematica de conectar al servicio, proporcionando acceso a las funcionalidades del servicio a traves de la interface que cumple el servicio.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">&lt;bean id=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicio</span><span class="delimiter">&quot;</span></span>
  <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean</span><span class="delimiter">&quot;</span></span>&gt;
  &lt;<span class="class">property</span> name=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceInterface</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.curso.spring.IServicio</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsdlDocumentUrl</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/servicio?WSDL</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">namespaceUri</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://spring.curso.com/</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceName</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicio</span><span class="delimiter">&quot;</span></span> /&gt;
  &lt;property name=<span class="string"><span class="delimiter">&quot;</span><span class="content">portName</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="content">ServicioPort</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hay que indicar:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La interface del servicio.</p>
</li>
<li>
<p>El WSDL del servicio.</p>
</li>
<li>
<p>El namespace XML empleado en el servicio</p>
</li>
<li>
<p>El nombre del servicio.</p>
</li>
<li>
<p>El nombre del port donde se publica.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Este Bean se puede inyectar a cualquier otro Bean de Spring como un <strong>com.curso.spring.IServicio</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.curso.spring.Cliente</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicio</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">servicio</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mapping_de_entidades">Mapping de entidades</h3>
<div class="paragraph">
<p>Para la creación del esquema que define los datos a intercambiar con el servicio, se emplea JAXB, por lo que se podría personalizar dicho mapeo con las anotaciones de JAXB, como <strong>@XmlRootElement</strong> o <strong>@XmlElement</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@XmlRootElement</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Persona</span> {
  <span class="directive">private</span> <span class="type">int</span> id;
  <span class="directive">private</span> <span class="predefined-type">String</span> nombre;
  <span class="directive">private</span> <span class="predefined-type">Date</span> fecha;

  <span class="annotation">@XmlElement</span>(name=<span class="string"><span class="delimiter">&quot;</span><span class="content">identificador</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="type">int</span> getId() {
    <span class="keyword">return</span> id;
  }

  ....
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_despliegue_en_contenedor_web">Despliegue en contenedor web</h3>
<div class="paragraph">
<p>Para el despliegue en un contenedor web, se precisa de una nueva dependencia, se puede encontrar mas información <a href="https://jax-ws-commons.java.net/spring/">aquí</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_security">Spring Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La seguridad en Spring:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basada en otorgar el acceso.</p>
</li>
<li>
<p>Jerárquica y perimetral. Aplica niveles.</p>
</li>
<li>
<p>Transportable.</p>
</li>
</ul>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Perimetral = estas dentro o no.
Jerarquica = se pueden aplicar niveles de acceso a los contenidos.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La seguridad en JEE:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Basada en restricciones.</p>
</li>
<li>
<p>Perimetral.</p>
</li>
<li>
<p>Dificil migrar.</p>
</li>
</ul>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Restricciones = Todo es accesible hasta que se restringe el acceso.
No es estandar dentro de los contenedores JEE, no es facil migrar.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_arquitectura_2">Arquitectura</h3>
<div class="imageblock thumb">
<div class="content">
<img src="images/security_arquitectura.png" alt="security arquitectura">
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Acceder a la app de fbi.war sin seguridad, se ve que accede hasta el fondo, a todas las funcionalidades sin restriccion.</p>
</div>
<div class="paragraph">
<p>localhost:8081/fbi &#8594; "mostrar expedientes" &#8594; "clasificar"
											&#8594; "desclasificar"
											&#8594; "mostrar"</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_dependencias_con_maven">Dependencias con Maven</h3>
<div class="paragraph">
<p>Se han de añadir las siguientes dependencias al proyecto.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.security<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-security-taglibs<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.2.4.RELEASE<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.security<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-security-config<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.2.4.RELEASE<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.security<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-security-crypto<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;version&gt;</span>3.2.4.RELEASE<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filtro_de_seguridad">Filtro de seguridad</h3>
<div class="paragraph">
<p>La seguridad con Spring, se basa en una clasede Spring <strong>FilterChainProxy</strong>, este filtro no será más que un Bean de Spring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">springSecurityFilterChain</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.security.web.FilterChainProxy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>El Bean de Spring de tipo <strong>FilterChainProxy</strong>, no es necesario definirlo directamente, ya que es una de las configuraciones por defecto que se añaden al activar la seguridad en Spring.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sobre este Bean, delegará un Filtro Web especial, el <strong>DelegatingFilterProxy</strong>, que como su nombre indica, delega en el contexto de Spring lo que intercepta.</p>
</div>
<div class="paragraph">
<p>Con XML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;filter&gt;</span>
        <span class="tag">&lt;display-name&gt;</span>springSecurityFilterChain<span class="tag">&lt;/display-name&gt;</span>
        <span class="tag">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="tag">&lt;/filter-name&gt;</span>
        <span class="tag">&lt;filter-class&gt;</span>
                org.springframework.web.filter.DelegatingFilterProxy
        <span class="tag">&lt;/filter-class&gt;</span>
<span class="tag">&lt;/filter&gt;</span>
<span class="tag">&lt;filter-mapping&gt;</span>
        <span class="tag">&lt;filter-name&gt;</span>springSecurityFilterChain<span class="tag">&lt;/filter-name&gt;</span>
        <span class="tag">&lt;url-pattern&gt;</span>/*<span class="tag">&lt;/url-pattern&gt;</span>
<span class="tag">&lt;/filter-mapping&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Con Java Config</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppInitializer</span> <span class="directive">implements</span> WebApplicationInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext servletContext) <span class="directive">throws</span> ServletException {
                <span class="comment">// ...</span>
                servletContext.addFilter(<span class="string"><span class="delimiter">&quot;</span><span class="content">springSecurityFilterChain</span><span class="delimiter">&quot;</span></span>,
                        <span class="keyword">new</span> DelegatingFilterProxy(<span class="string"><span class="delimiter">&quot;</span><span class="content">springSecurityFilterChain</span><span class="delimiter">&quot;</span></span>))
                                .addMappingForUrlPatterns(<span class="predefined-constant">null</span>, <span class="predefined-constant">false</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span>);
                <span class="comment">// ...</span>
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_contexto_de_seguridad">Contexto de Seguridad</h3>
<div class="paragraph">
<p>Se ha de añadir la anotación <strong>@EnableWebSecurity</strong> a una clase con <strong>@Configuration</strong> para que se genere el objeto <strong>WebSecurityConfigurer</strong>, que tiene la configuración por defecto de Spring Security.</p>
</div>
<div class="paragraph">
<p>Está configuración puede ser sobreescrita haciendo a su vez extender la clase <strong>@Configuration</strong> de <strong>WebSecurityConfigurerAdapter</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebSecurity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConfiguracionSpringSecurity</span> <span class="directive">extends</span> WebSecurityConfigurerAdapter {

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authenticationmanagerbuilder">AuthenticationManagerBuilder</h3>
<div class="paragraph">
<p>Permite definir de donde se han de obtener los usuarios y roles que se emplearán en la aplicación, para ello sobrescribir el método correspondiente de la clase <strong>WebSecurityConfigurerAdapter</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> configure(AuthenticationManagerBuilder auth) <span class="directive">throws</span> <span class="exception">Exception</span> {
        auth.inMemoryAuthentication().withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fernando</span><span class="delimiter">&quot;</span></span>).password(<span class="string"><span class="delimiter">&quot;</span><span class="content">1234</span><span class="delimiter">&quot;</span></span>).roles(<span class="string"><span class="delimiter">&quot;</span><span class="content">AGENTE</span><span class="delimiter">&quot;</span></span>);
        auth.inMemoryAuthentication().withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mulder</span><span class="delimiter">&quot;</span></span>).password(<span class="string"><span class="delimiter">&quot;</span><span class="content">fox</span><span class="delimiter">&quot;</span></span>).roles(<span class="string"><span class="delimiter">&quot;</span><span class="content">AGENTE_ESPECIAL</span><span class="delimiter">&quot;</span></span>);
        auth.inMemoryAuthentication().withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scully</span><span class="delimiter">&quot;</span></span>).password(<span class="string"><span class="delimiter">&quot;</span><span class="content">dana</span><span class="delimiter">&quot;</span></span>).roles(<span class="string"><span class="delimiter">&quot;</span><span class="content">AGENTE_ESPECIAL</span><span class="delimiter">&quot;</span></span>);
        auth.inMemoryAuthentication().withUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">Skinner</span><span class="delimiter">&quot;</span></span>).password(<span class="string"><span class="delimiter">&quot;</span><span class="content">walter</span><span class="delimiter">&quot;</span></span>).roles(<span class="string"><span class="delimiter">&quot;</span><span class="content">DIRECTOR</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>El objeto <strong>AuthenticationManagerBuilder</strong>, tiene un método <strong>jdbcAuthentication()</strong> que permite definir la conexion contra una base de datos para obtener los usuarios y roles.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_proteccion_de_recursos">Proteccion de recursos</h3>
<div class="paragraph">
<p>Permite configurar las seguridad Web sobre las peticiones http.</p>
</div>
<div class="paragraph">
<p>Patrón de recursos protegido y rol que puede acceder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
        http
                .authorizeRequests()
                        .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/**</span><span class="delimiter">&quot;</span></span>).access(<span class="string"><span class="delimiter">&quot;</span><span class="content">hasAnyRole('AGENTE_ESPECIAL','DIRECTOR')</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>En este caso, esta limitado el aceso a cualquier recurso a aquellos usuarios que tienen como ROL = ROLE_AGENTE_ESPECIAL, además de que el proceso de Login, se realiza con formulario.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Para excluir recursos de la protección.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http
        .authorizeRequests()
                .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/paginas/*</span><span class="delimiter">&quot;</span></span>).permitAll()
                .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/css/*</span><span class="delimiter">&quot;</span></span>).permitAll()
                .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/imagenes/*</span><span class="delimiter">&quot;</span></span>).permitAll();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_login">Login</h3>
<div class="paragraph">
<p>Para definir un proceso de Login a través de formulario con una pagina de login personalizada.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http
        .formLogin()
                .loginPage(<span class="string"><span class="delimiter">&quot;</span><span class="content">/paginas/nuestro-login.jsp</span><span class="delimiter">&quot;</span></span>)
                .failureUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/paginas/nuestro-login.jsp?login_error</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Dado que cuando se intenta acceder a un recurso y este está asegurado, se nos redirigirá a la página de login, para conocer a que recurso se queria realmente acceder, Spring crea una <strong>Session</strong> temporal donde almacena la URL.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_logout">Logout</h3>
<div class="paragraph">
<p>Para activar el logout indicando la url para realizar el logout, definir la pagina a la que se redirecciona una vez realizado el logout y el nombre de las cookies que se han de borrar en el proceso.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http
        .logout()
                .logoutUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/logout</span><span class="delimiter">&quot;</span></span>)                                                 <span class="integer">2</span>
                .invalidateHttpSession(<span class="predefined-constant">true</span>)
                .logoutSuccessUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/paginas/desconectado.jsp</span><span class="delimiter">&quot;</span></span>)
                .deleteCookies(<span class="string"><span class="delimiter">&quot;</span><span class="content">JSESSIONID</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Por tanto para realizar el logout, basta con invocar la url <strong>/logout</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;c:url value='/logout'/</span></span><span class="error">&gt;</span>&quot;<span class="error">&gt;</span>desconectar<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_csrf">CSRF</h3>
<div class="paragraph">
<p>El CSRF (Cross-site request forgery) o control de accesos desde sitio externos, permite mediante la adición de una huella aleatoria en las transacciones entre servidor y cliente, controlar que no se acceda al servidor desde otro sitio que no sea la propia aplicación.</p>
</div>
<div class="paragraph">
<p>Consiste en añadir un campo oculto para guardar el token en todos los formularios que utilicen el método POST:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${_csrf.parameterName}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${_csrf.token}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este Token, tambien se puede añadir con la libreria de etiquetas de Spring security:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><span class="tag">&lt;sec:csrfInput</span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Este control se puede desactivar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">        http
                .csrf().disable();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_userdetailservice">UserDetailService</h3>
<div class="paragraph">
<p>Permite personalizar la forma en la que se realiza la autenticación.</p>
</div>
<div class="paragraph">
<p>Spring proporciona implementaciones de referencia como <strong>InMemoryUserDetailsManager</strong> o <strong>JdbcUserDetailsManager</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> configure(AuthenticationManagerBuilder auth) <span class="directive">throws</span> <span class="exception">Exception</span> {
        auth.userDetailsService(userDetailsService());
}

<span class="directive">public</span> UserDetailsService userDetailsService(){
    <span class="predefined-type">Properties</span> usuarios = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fernando</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">1234,ROLE_AGENTE,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mulder</span><span class="delimiter">&quot;</span></span>  ,<span class="string"><span class="delimiter">&quot;</span><span class="content">fox,ROLE_AGENTE_ESPECIAL,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scully</span><span class="delimiter">&quot;</span></span>  ,<span class="string"><span class="delimiter">&quot;</span><span class="content">dana,ROLE_AGENTE_ESPECIAL,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Skinner</span><span class="delimiter">&quot;</span></span> ,<span class="string"><span class="delimiter">&quot;</span><span class="content">walter,ROLE_DIRECTOR,enabled</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> <span class="keyword">new</span> InMemoryUserDetailsManager(usuarios);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_encriptación">Encriptación</h3>
<div class="paragraph">
<p>Se trata de posibilitar el medio para que se almacenen las contraseñas encriptadas, pero que se sigan pudiendo resolver, para ello se ha de definir un <strong>Encoder</strong> y asociarlo al <strong>AuthenticationManagerBuilder</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Override</span>
<span class="directive">public</span> <span class="type">void</span> configure(AuthenticationManagerBuilder auth) <span class="directive">throws</span> <span class="exception">Exception</span> {
        PasswordEncoder encoder = <span class="keyword">new</span> BCryptPasswordEncoder();
        auth.userDetailsService(userDetailsService()).passwordEncoder(encoder);
}

<span class="directive">public</span> UserDetailsService userDetailsService(){
    <span class="predefined-type">Properties</span> usuarios = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fernando</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">$2a$10$SMPYtil7Hs2.cV7nrMjrM.dRAkuoLdYM8NdVrF.GeHfs/MrzcQ/zi,ROLE_AGENTE,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mulder</span><span class="delimiter">&quot;</span></span>  ,<span class="string"><span class="delimiter">&quot;</span><span class="content">$2a$10$M2JRRHUHTfv4uMR4NWmCLebk1r9DyWSwCMZmuq4LKbImOkfhGFAIa,ROLE_AGENTE_ESPECIAL,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scully</span><span class="delimiter">&quot;</span></span>  ,<span class="string"><span class="delimiter">&quot;</span><span class="content">$2a$10$cbF5xp0grCOGcI6jZvPhA.asgmILATW1hNbM2MEqGJEFnRhhQd3ba,ROLE_AGENTE_ESPECIAL,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Skinner</span><span class="delimiter">&quot;</span></span> ,<span class="string"><span class="delimiter">&quot;</span><span class="content">$2a$10$ZFtPIULMcxPe3r/5VunbVujMD7Lw8hkqAmJlxmK5Y1TK3L1bf8ULG,ROLE_DIRECTOR,enabled</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> <span class="keyword">new</span> InMemoryUserDetailsManager(usuarios);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adicionalmente se puede realizar dicha configuración aprovechando una caracteristicas de las clases anotadas con <strong>@Configuration</strong>, donde se ejecutan todos los métodos anotados con <strong>@Autowired</strong>, recibiendo la inyección de los parametros definidos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> PasswordEncoder passwordEncoder(){
        PasswordEncoder encoder = <span class="keyword">new</span> BCryptPasswordEncoder();
        <span class="keyword">return</span> encoder;
}

<span class="annotation">@Autowired</span>
<span class="directive">public</span> <span class="type">void</span> configureGlobalSecurity(AuthenticationManagerBuilder auth, PasswordEncoder pe) <span class="directive">throws</span> <span class="exception">Exception</span> {
        auth.userDetailsService(userDetailsService()).passwordEncoder(pe);
}

<span class="directive">public</span> UserDetailsService userDetailsService(){
    <span class="predefined-type">Properties</span> usuarios = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Fernando</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">$2a$10$SMPYtil7Hs2.cV7nrMjrM.dRAkuoLdYM8NdVrF.GeHfs/MrzcQ/zi,ROLE_AGENTE,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Mulder</span><span class="delimiter">&quot;</span></span>  ,<span class="string"><span class="delimiter">&quot;</span><span class="content">$2a$10$M2JRRHUHTfv4uMR4NWmCLebk1r9DyWSwCMZmuq4LKbImOkfhGFAIa,ROLE_AGENTE_ESPECIAL,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Scully</span><span class="delimiter">&quot;</span></span>  ,<span class="string"><span class="delimiter">&quot;</span><span class="content">$2a$10$cbF5xp0grCOGcI6jZvPhA.asgmILATW1hNbM2MEqGJEFnRhhQd3ba,ROLE_AGENTE_ESPECIAL,enabled</span><span class="delimiter">&quot;</span></span>);
        usuarios.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">Skinner</span><span class="delimiter">&quot;</span></span> ,<span class="string"><span class="delimiter">&quot;</span><span class="content">$2a$10$ZFtPIULMcxPe3r/5VunbVujMD7Lw8hkqAmJlxmK5Y1TK3L1bf8ULG,ROLE_DIRECTOR,enabled</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> <span class="keyword">new</span> InMemoryUserDetailsManager(usuarios);
}</code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Para la configuración anterior, no será necesario definir el método <strong>configure(AuthenticationManagerBuilder auth)</strong>, ya que puede ser sustituido por este otro.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_remember_me">Remember Me</h3>
<div class="paragraph">
<p>Funcionalidad que permite incluir una <strong>Cookie</strong> para que la aplicación no pida al usuario que realice el proceso de <strong>login</strong>, recordandolo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http
        .rememberMe()
                .rememberMeParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">remember-me-param</span><span class="delimiter">&quot;</span></span>)
                .rememberMeCookieName(<span class="string"><span class="delimiter">&quot;</span><span class="content">my-remember-me</span><span class="delimiter">&quot;</span></span>)
                .tokenValiditySeconds(<span class="integer">86400</span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_seguridad_en_la_capa_transporte_https">Seguridad en la capa transporte - HTTPS</h3>
<div class="paragraph">
<p>Se puede indicar a Spring que peticiones necesitan de un canal seguro (https), así como establecer redirecciones automaticas entre puertos.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http
        .requiresChannel()
                .anyRequest().requiresSecure()
.and()
        .portMapper()
                .http(<span class="integer">8080</span>).mapsTo(<span class="integer">8443</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Para activar HTTPS, se ha de realizar configuraciones en el servidor, en el caso de un tomcat, se haria algo así.</p>
</div>
<div class="listingblock">
<div class="title">En el fichero de configuración <strong>server.xml</strong> copiar</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Connector</span> <span class="attribute-name">SSLEnabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">acceptCount</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">connectionTimeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">executor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tomcatThreadPool</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">keyAlias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcserver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">keystoreFile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${catalina.base}/conf/tcserver.keystore</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">keystorePass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeme</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">maxKeepAliveRequests</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">15</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8443</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">protocol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">redirectPort</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8443</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scheme</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">secure</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sesiones_concurrentes">Sesiones concurrentes</h3>
<div class="paragraph">
<div class="title">En el directorio <strong>${catalina.base}/conf</strong> copiar un fichero de claves <strong>tcserver.keystore</strong> con los datos definidos en la configuración anterior.</div>
<p>Se puede controlar la concurrencia de sesiones, permitiendo controlar que varios navegadores accedan con el mismo usuario. El procedimiento crea un contador, que cuando cumple con el numero especificado, no deja crear nuevas conexiones.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http
        .sessionManagement()
                .maximumSessions(<span class="integer">1</span>)
                .maxSessionsPreventsLogin(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tiene un problema cuando se cierra el navegador y no se da a desconectar, ya que no se ejecuta la actualización del contador, luego cuando se llegue al máximo ya solo se podría acceder desde los navegadores que consiguieron el acceso.</p>
</div>
<div class="paragraph">
<p>Para solventar este problema, se dipone de un Listener que se encarga de está eventualidad.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">AppInitializer</span> <span class="directive">implements</span> WebApplicationInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> onStartup(ServletContext servletContext) <span class="directive">throws</span> ServletException {
        servletContext.addListener(<span class="keyword">new</span> HttpSessionEventPublisher());
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sessionfixation">SessionFixation</h3>
<div class="paragraph">
<p>Es un efecto que se puede producir en las aplicaciones web, que consiste en la sobrescritura de los roles en el objeto sesión.</p>
</div>
<div class="paragraph">
<p>La idea basicamente es que al realizarse el proceso de <strong>login</strong> sobre una sesión ya creada (repetir el login), sino se crea de nuevo un objeto sessión con su correspondiente identificador de sesión (JSESSIONID), es decir se recicla el objeto sesión, se puede producir que existan dos usuarios con la misma sesión, pero con los datos de roles del segundo usuario, que puede tener mas permisos.</p>
</div>
<div class="paragraph">
<p>Spring por defecto lo contempla.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http
        .sessionManagement()
            .sessionFixation()
            .migrateSession();</code></pre>
</div>
</div>
<div class="paragraph">
<p>A mayores, se puede proporcionar una migración de los datos de la sesión antigua a la nueva, para poder seguir manteniendo información aunque se produzca el cambio de usuario.</p>
</div>
</div>
<div class="sect2">
<h3 id="_libreria_de_etiquetas">Libreria de etiquetas</h3>
<div class="paragraph">
<p>Para añadir las etiquetas propias de la seguridad se ha de incluir la cabecerá</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="error">&lt;</span>%@ taglib prefix=&quot;sec&quot;        uri=&quot;http://www.springframework.org/security/tags&quot;%<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Permite el acceso al objeto de authenticación para</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Controlar que partes de la <strong>View</strong> se van a renderizar</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sec:authorize</span> <span class="attribute-name">access</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hasRole('ROLE_DIRECTOR')</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;c:url value='/expedientesx/clasificar?id=${expediente.id}'/</span></span><span class="error">&gt;</span>&quot;<span class="error">&gt;</span>clasificar<span class="tag">&lt;/a&gt;</span>
        <span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;c:url value='/expedientesx/desclasificar?id=${expediente.id}'/</span></span><span class="error">&gt;</span>&quot;<span class="error">&gt;</span>desclasificar<span class="tag">&lt;/a&gt;</span>
<span class="tag">&lt;/sec:authorize&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note speaker">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Este tipo de seguridad, unicamente protege que en el uso normal de la aplicación un usuario pueda ver un enlace o información, a la que no tiene acceso, para evitar errores de acceso, pero no protege la funcionalidad (negocio) en si.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Mostrar información del usuario</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sec:authentication</span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">principal.username</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_expresiones_spel">Expresiones SpEL</h3>
<div class="paragraph">
<p>Para crear las expresiones que se han ido empleando, el lenguaje de expresiones de Spring (SpEL), ofrece una serie de comandos</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hasRole(role)</p>
</li>
<li>
<p>hasAnyRole([role1,role2])</p>
</li>
<li>
<p>permitAll</p>
</li>
<li>
<p>denyAll</p>
</li>
<li>
<p>isAnonymous()</p>
</li>
<li>
<p>isAuthenticated()</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_seguridad_de_métodos">Seguridad de métodos</h3>
<div class="paragraph">
<p>Para activar la seguridad de los métodos, se ha de incluir la anotación <strong>@EnableGlobalMethodSecurity</strong> en la clase <strong>@Configuration</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebSecurity</span>
<span class="annotation">@EnableGlobalMethodSecurity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConfiguracionSpringSecurity</span> <span class="directive">extends</span> WebSecurityConfigurerAdapter {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien es recomendable definir una página de error cuando se produzcan intentos de acceso no autorizados</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http
        .exceptionHandling()
                .accessDeniedPage(<span class="string"><span class="delimiter">&quot;</span><span class="content">/paginas/acceso-denegado.jsp</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring Security, es compatible con anotaciones propias y de la especificación java JSR-250.
Las propias se dividen en dos grupos</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@Secured</strong> que se activa con <strong>securedEnabled</strong></p>
</li>
<li>
<p><strong>prepost</strong> que se activa con <strong>prePostEnabled</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Para activar las de JSR-250 habrá que activar <strong>jsr250Enabled</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebSecurity</span>
<span class="annotation">@EnableGlobalMethodSecurity</span>(securedEnabled = <span class="predefined-constant">true</span>, jsr250Enabled=<span class="predefined-constant">true</span>, prePostEnabled = <span class="predefined-constant">true</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ConfiguracionSpringSecurity</span> <span class="directive">extends</span> WebSecurityConfigurerAdapter {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Las anotaciones de Spring son</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@Secured</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Secured</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_AGENTE_ESPECIAL,ROLE_DIRECTOR</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> clasificar(Expediente expediente);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@PreAuthorize</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PreAuthorize</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hasRole('ROLE_DIRECTOR') or #expediente.investigador == authentication.name</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> desclasificar(Expediente expediente);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@PostAuthorize</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PostAuthorize</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">hasRole('ROLE_DIRECTOR') or returnObject.investigador == authentication.name</span><span class="delimiter">&quot;</span></span>)
Expediente mostrar(<span class="predefined-type">Long</span> id);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@PreFilter</strong></p>
</li>
<li>
<p><strong>@PostFilter</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@PostFilter</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">(hasRole('ROLE_AGENTE') and not filterObject.clasificado) </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">or (hasAnyRole('ROLE_AGENTE_ESPECIAL','ROLE_DIRECTOR') and not filterObject.informe.contains(principal.username))</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">List</span>&lt;Expediente&gt; listarTodos();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Las anotaciones de JSR-250 son</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>@RolesAllowed</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RolesAllowed</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">ROLE_AGENTE_ESPECIAL,ROLE_DIRECTOR</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> desclasificar(Expediente expediente);</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>PermitAll</p>
</li>
<li>
<p>DenyAll</p>
</li>
<li>
<p>RunAs</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_spring_boot">Spring Boot</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introducción_a_spring_boot">Introducción a Spring Boot</h3>
<div class="paragraph">
<p>Framework orientado a la construcción/configuración de proyectos de la familia Spring basado en <strong>Convention-Over-Configuration</strong>, por lo que minimiza la cantidad de código de configuración de las aplicaciones.</p>
</div>
<div class="paragraph">
<p>Afecta principalmente a dos aspectos de los proyectos</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Configuracion de dependencias</strong>: Proporcionado por <strong>Starters</strong> Aunque sigue empleando Maven o Gradle para configurar las dependencias del proyecto, abstrae de las versiones de los APIs y lo que es más importante de las versiones compatibles de unos APIs con otros, dado que proporciona un conjunto de librerias que ya están probadas trabajado juntas.</p>
</li>
<li>
<p><strong>Configuracion de los APIs</strong>: Cada API de Spring que se incluye, ya tendrá una preconfiguración por defecto, la cual si se desea se podrá cambiar, además de incluir elementos tan comunes en los desarrollos como un contenedor de servlets embebido ya configurado, estas preconfiguraciones se establecen simplemente por el hecho de que la libreria esté en el classpath, como un Datasource de una base de datos, JDBCTemplate, Java Persistence API (JPA), Thymeleaf templates, Spring Security o Spring MVC.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Además proporciona otras herramientas como</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La consola Spring Boot CLI</p>
</li>
<li>
<p>Actuator</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_instalación_de_spring_boot_cli">Instalación de Spring Boot CLI</h3>
<div class="paragraph">
<p>Permite la creación de aplicaciones Spring, de forma poco convencional, centrandose unicamente en el código, la consola se encarga de resolver dependencias y configurar el entorno de ejecución.</p>
</div>
<div class="paragraph">
<p>Emplea scripts de Groovy.</p>
</div>
<div class="paragraph">
<p>Para descargar la distribución pinchar <a href="http://repo.spring.io/release/org/springframework/boot/spring-boot-cli/1.4.2.RELEASE/spring-boot-cli-1.4.2.RELEASE-bin.zip">aquí</a></p>
</div>
<div class="paragraph">
<p>Descomprimir y añadir a la variable entorno PATH la ruta <strong>$SPRING_BOOT_CLI_HOME/bin</strong></p>
</div>
<div class="paragraph">
<p>Se puede acceder a la consola en modo ayuda (completion), con lo que se obtiene ayuda para escribir los comandos con TAB, para ello se introduce</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">&gt; spring shell</code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez en la consola se puede acceder a varios comandos uno de ellos es el de la ayuda general <strong>help</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">Spring-CLI# help</code></pre>
</div>
</div>
<div class="paragraph">
<p>O la ayuda de alguno de los comandos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">Spring-CLI# help init</code></pre>
</div>
</div>
<div class="paragraph">
<p>Con Spring Boot se puede creear un poryecto MVC tan rapido como definir la siguiente clase Groovy <strong>HelloController.groovy</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@RestController</span>
<span class="type">class</span> <span class="class">HelloController</span> {

        <span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
        <span class="keyword">def</span> <span class="function">hello</span>() {
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
        }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y ejecutar desde la consola Spring Boot CLI</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">&gt; spring run HelloController.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>La consola se encarga de resolver las dependencias, de compilar y de establecer las configuraciones por defecto para una aplicacion Web MVC, en el web.xml, &#8230;&#8203; por lo que una vez ejecutado el comando de la consola, al abrir el navegador con la url <a href="http://localhost:8080" class="bare">http://localhost:8080</a> se accede a la aplicación.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creación_e_implementación_de_una_aplicación">Creación e implementación de una aplicación</h3>
<div class="paragraph">
<p>Lo primero a resolver al crear una aplicación son las dependencias, para ellos Spring Boot ofrece el siguiente mecanismo basando en la herencia del POM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://maven.apache.org/POM/4.0.0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        ...

        <span class="tag">&lt;parent&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;version&gt;</span>1.4.2.RELEASE<span class="tag">&lt;/version&gt;</span>
                <span class="tag">&lt;relativePath</span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span>
        <span class="tag">&lt;/parent&gt;</span>

        ...

<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De no poderse establecer dicha herencia, por heredar de otro proyecto, se ofrece la posibilidad de añadir la siguiente dependedencia.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project&gt;</span>

        ...

        <span class="tag">&lt;dependencyManagement&gt;</span>
             <span class="tag">&lt;dependencies&gt;</span>
                <span class="tag">&lt;dependency&gt;</span>
                    <span class="comment">&lt;!-- Import dependency management from Spring Boot --&gt;</span>
                    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
                    <span class="tag">&lt;artifactId&gt;</span>spring-boot-dependencies<span class="tag">&lt;/artifactId&gt;</span>
                    <span class="tag">&lt;version&gt;</span>1.4.2.RELEASE<span class="tag">&lt;/version&gt;</span>
                    <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
                    <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
                <span class="tag">&lt;/dependency&gt;</span>
            <span class="tag">&lt;/dependencies&gt;</span>
        <span class="tag">&lt;/dependencyManagement&gt;</span>

        ...

<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta dependencia permite a Spring Boot hacer el trabajo sucio para manejar el ciclo de vida de un proyecto Spring normal, pero normalmente se precisarán otras dependencias, para esto Spring Boot ofrece los <strong>Starters</strong>, por ejemplo esta seria la dependencia para un proyecto Web MVC</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
                <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez solventadas las dependencias, habrá que configurar el proyecto, ya hemos mencionado que la configuración quedará muy reducida, en este caso unicamnete necesitamos definir una clase anotada con <strong>@SpringBootApplication</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HolaMundoApplication</span> {
        ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Esta anotacion en realidad es la suma de otras tres:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@Configuration &#8594; Se designa a la clase como un posible origen de definiciones de Bean.</p>
</li>
<li>
<p>@ComponentScan &#8594; Se indica que se buscarán otras clases con anotaciones que definan componentes de Spring como @Controller</p>
</li>
<li>
<p>@EnableAutoConfiguration &#8594; Es la que incluye toda la configuración por defecto para los distintos APIs seleccionados.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con esto ya se tendría el proyecto preparado para incluir unicamente el código de aplicación necesario, por ejemplo un Controller de Spring MVC</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HolaMundoController</span> {
        <span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
        <span class="annotation">@ResponseBody</span>
        <span class="directive">public</span> <span class="predefined-type">String</span> holaMundo() {
                <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hola Mundo!!!!!</span><span class="delimiter">&quot;</span></span>;
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez finalizada la aplicación, se podría ejecutar de varias formas</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Como jar autoejecutable, para lo que habrá que definir un método <strong>Main</strong> que invoque <strong>SpringApplication.run()</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HolaMundoApplication</span> {
        <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
                SpringApplication.run(HolaMundoApplication.class, args);
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y posteriormente ejecutandolo con</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Una tarea de Maven</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">mvn spring-boot:run</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Una tarea de Gradle</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">gradle bootRun</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>O como jar autoejecutable, generando primero el jar</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Con Maven</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">mvn package</code></pre>
</div>
</div>
<div class="paragraph">
<p>O Gradle</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">gradle build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Y ejecutando desde la linea de comandos</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">java -jar HolaMundo-0.0.1-SNAPSHOT.jar</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>O desplegando como WAR en un contenedor web, para lo cual hay que añadir el plugin de WAR</p>
<div class="ulist">
<ul>
<li>
<p>En Maven, con cambiar el package bastará</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;packaging&gt;</span>war<span class="tag">&lt;/packaging&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>En Gradle alicando el plugin de WAR y cambiando la configuracion JAR por la WAR</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">war</span><span class="delimiter">'</span></span>

war {
        baseName = <span class="string"><span class="delimiter">'</span><span class="content">HolaMundo</span><span class="delimiter">'</span></span>
        version = <span class="string"><span class="delimiter">'</span><span class="content">0.0.1-SNAPSHOT</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>En estos casos, dado que no se ha generado el <strong>web.xml</strong>, es necesario realizar dicha inicialización, para ello Srping Boot ofrece la clase <strong>org.springframework.boot.web.support.SpringBootServletInitializer</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HolaMundoServletInitializer</span> <span class="directive">extends</span> SpringBootServletInitializer {
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
                <span class="keyword">return</span> builder.sources(HolaMundoApplication.class);
        }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_recolección_de_métricas">Recolección de métricas</h3>
<div class="paragraph">
<p>El API de Actuator, permite recoger información del contexto de Spring en ejecución, como</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Qué beans se han configurado en el contexto de Spring.</p>
</li>
<li>
<p>Qué configuraciones automáticas se han establecido con Spring Boot.</p>
</li>
<li>
<p>Qué variables de entorno, propiedades del sistema, argumentos de la línea de comandos están disponibles para la aplicación.</p>
</li>
<li>
<p>Estado actual de los subprocesos</p>
</li>
<li>
<p>Rastreo de solicitudes HTTP recientes gestionadas por la aplicación</p>
</li>
<li>
<p>Métricas relacionadas con el uso de memoria, recolección de basura, solicitudes web, y uso de fuentes de datos.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Estas metricas se exponen via Web o via shell.</p>
</div>
<div class="paragraph">
<p>Para activarlo, es necesario incluir una dependencia</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Y a partir de ahi, bajo la aplicación desplegada, se encuentran los path con la info, que retornan JSON</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Estado</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/ListadoDeTareas/health" class="bare">http://localhost:8080/ListadoDeTareas/health</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mapeos de URL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/ListadoDeTareas/mappings" class="bare">http://localhost:8080/ListadoDeTareas/mappings</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Descarga de estado de la memoria de la JVM</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/ListadoDeTareas/heapdump" class="bare">http://localhost:8080/ListadoDeTareas/heapdump</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Beans de la aplicacion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="http://localhost:8080/ListadoDeTareas/beans" class="bare">http://localhost:8080/ListadoDeTareas/beans</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_uso_de_java_con_start_spring_io">Uso de Java con start.spring.io</h3>
<div class="paragraph">
<p>Es uno de los modos de emplear el API de <strong>Spring Initializr</strong>, al que tambien se tiene acceso desde</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Spring Tool Suite</p>
</li>
<li>
<p>IntelliJ IDEA</p>
</li>
<li>
<p>Spring Boot CLI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Es una herramienta que permite crear estructuras de proyectos de forma rapida, a través de plantillas.</p>
</div>
<div class="paragraph">
<p>Desde la pagina <a href="http://start.spring.io/">start.spring.io</a> se puede generar una plantilla de proyecto.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/boot_start.spring.io.png" alt="boot start.spring.io">
</div>
</div>
<div class="paragraph">
<p>Lo que se ha de proporcionar es</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tipo de proyecto (Maven o Gradle)</p>
</li>
<li>
<p>Versión de Spring Boot</p>
</li>
<li>
<p>GroupId</p>
</li>
<li>
<p>ArtifactId</p>
</li>
<li>
<p>Dependencias</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Existe una vista avanzada donde se pueden indicar otros parametros como</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Versión de java</p>
</li>
<li>
<p>El tipo de packaging</p>
</li>
<li>
<p>El lenguaje del proyecto</p>
</li>
<li>
<p>Seleccion mas detallada de las dependencias</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La estructura del proyecto con dependencia web generado será</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/boot_estructura_basica_proyecto_maven.png" alt="boot estructura basica proyecto maven">
</div>
</div>
<div class="paragraph">
<p>En esta estructura, cabe destacar el directorio <strong>static</strong>, destinado a contener cualquier recurso estatico de una aplicación web.</p>
</div>
<div class="paragraph">
<p>Desde Spring Tools Suite, se puede acceder a esta misma funcionalidad desde <strong>New &gt; Other &gt; Spring &gt; Spring Starter Project</strong>, es necesario tener internet, ya que STS se conecta a <strong>start.spring.io</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/boot_sts_starter_project.png" alt="boot sts starter project">
</div>
</div>
<div class="paragraph">
<p>Una vez seleccionada la opcion, se muestra un ofrmulario similar al de la web</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/boot_sts_starter_project_formulario.png" alt="boot sts starter project formulario">
</div>
</div>
<div class="paragraph">
<p>Y desde Spring CLI con el comando <strong>init</strong> tambien, un ejemplo de comando seria</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">Spring-CLI# init --build maven --groupId com.ejemplo.spring.boot.web --version 1.0 --java-version 1.8 --dependencies web --name HolaMundo HolaMundo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Que genera la estructura anterior dentro de la carpeta <strong>HolaMundo</strong></p>
</div>
<div class="paragraph">
<p>Se puede obtener ayuda sobre los parametros con el comando</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">Spring-CLI# init --list</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_starters">Starters</h3>
<div class="paragraph">
<p>Son dependencias ya preparadas por Spring, para dotar del conjunto de librerias necesarias para obtener un funcionalidad sin que existan conflictos entre las versiones de las distintas librerias.</p>
</div>
<div class="paragraph">
<p>Se pueden conocer las dependencias reales con las siguientes tareas</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">mvn dependency:tree</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">gradle dependencies</code></pre>
</div>
</div>
<div class="paragraph">
<p>De necesitarse, se pueden sobrescribir las versiones o incluso excluir librerias, de las que nos proporcionan los <strong>Starter</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="XML"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
                <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tag">&lt;/artifactId&gt;</span>
                <span class="tag">&lt;exclusions&gt;</span>
                        <span class="tag">&lt;exclusion&gt;</span>
                                <span class="tag">&lt;groupId&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/groupId&gt;</span>
                        <span class="tag">&lt;/exclusion&gt;</span>
        <span class="tag">&lt;/exclusions&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Gradle</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-web</span><span class="delimiter">&quot;</span></span>) {
        exclude <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.fasterxml.jackson.core</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_soporte_a_propiedades">Soporte a propiedades</h3>
<div class="paragraph">
<p>Spring Boot permite configurar unas 300 propiedades, <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html">aqui</a> una lista de ellas.</p>
</div>
<div class="paragraph">
<p>Se pueden configurar los proyectos de Spring Boot unicamnete modificando propiedades, estas se pueden definir en</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Argumentos de la linea de comandos</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">java -jar app-0.0.1-SNAPSHOT.jar --spring.main.show-banner=false</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>JNDI</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">java:comp/env/spring.main.show-banner=false</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Propiedades del Sistema Java</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">java -jar app-0.0.1-SNAPSHOT.jar -Dspring.main.show-banner=false</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Variables de entorno del SO</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">SET SPRING_MAIN_SHOW_BANNER=false;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Un fichero <strong>application.properties</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="PROPERTIES">spring.main.show-banner=false</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Un fichero <strong>application.yml</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="key">spring</span>:
<span class="error">        </span><span class="key">main</span>:
<span class="error">        </span><span class="error">        </span><span class="key">show-banner</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>De existir varias de las siguientes, el orden de preferencia es el del listado, por lo que la mas prioritaria es la linea de comandos.</p>
</div>
<div class="paragraph">
<p>Los ficheros <strong>application.properties</strong> y <strong>application.yml</strong> pueden situarse en varios lugares</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En un directorio <strong>config</strong> hijo del directorio desde donde se ejecuta la aplicación.</p>
</li>
<li>
<p>En el directorio desde donde se ejecuta la aplicación.</p>
</li>
<li>
<p>En un paquete <strong>config</strong> del proyecto</p>
</li>
<li>
<p>En la raiz del classpath.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Siendo el orden de preferencia el del listado, si aparecieran los dos ficheros, el <strong>.propertes</strong> y el <strong>.yml</strong>, tiene prioridad el properties.</p>
</div>
<div class="paragraph">
<p>Algunas de las propiedades que se pueden definir son:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>spring.main.show-banner</strong> 				&#8594; Mostrar el banner de spring en el log (por defecto true).</p>
</li>
<li>
<p><strong>spring.thymeleaf.cache</strong>	 				&#8594; Deshabilitar la cache del generador de plantillas thymeleaf</p>
</li>
<li>
<p><strong>spring.freemarker.cache</strong> 				&#8594; Deshabilitar la cache del generador de plantillas freemarker</p>
</li>
<li>
<p><strong>spring.groovy.template.cache</strong>			&#8594; Deshabilitar la cache de plantillas generadas con groovy</p>
</li>
<li>
<p><strong>spring.velocity.cache</strong>					&#8594; Deshabilitar la cache del generador de plantillas velocity</p>
</li>
<li>
<p><strong>spring.profiles.active</strong>	 				&#8594; Perfil activado en la ejecución</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>La cache de las plantillas, se emplea en producción para mejorar el rendimiento, pero se debe desactivar en desarrollo ya que sino se ha de parar el servidor cada vez que se haga un cambio en las plantillas.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuracion_del_servidor">Configuracion del Servidor</h4>
<div class="ulist">
<ul>
<li>
<p><strong>server.port</strong> 							&#8594; Puerto del Contenedor Web donde se exponen los recursos (por defecto 8080, para ssl 8443).</p>
</li>
<li>
<p><strong>server.ssl.key-store</strong> 					&#8594; Ubicación del fichero de certificado (Ej: <a href="file:///path/to/mykeys.jks" class="bare">file:///path/to/mykeys.jks</a>).</p>
</li>
<li>
<p><strong>server.ssl.key-store-password</strong>			&#8594; Contraseña del almacen.</p>
</li>
<li>
<p><strong>server.ssl.key-password</strong> 				&#8594; Contraseña del certificado.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Para generar un certificado, se puede emplear la herramienta keytool* que incluye la jdk</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">keytool -keystore mykeys.jks -genkey -alias tomcat -keyalg RSA</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuracion_del_logger">Configuracion del Logger</h4>
<div class="ulist">
<ul>
<li>
<p><strong>logging.level.root</strong>						&#8594; Nivel del log para el log principal (Ej: WARN)</p>
</li>
<li>
<p><strong>logging.level.&lt;paquete&gt;</strong>					&#8594; Nivel del log para un log particular (Ej: DEBUG)</p>
</li>
<li>
<p><strong>logging.path</strong> 							&#8594; Ubicacion del fichero de log (Ej: /var/logs/)</p>
</li>
<li>
<p><strong>logging.file</strong> 							&#8594; Nombre del fichero de log (Ej: miApp.log)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuracion_del_datasource">Configuracion del Datasource</h4>
<div class="ulist">
<ul>
<li>
<p><strong>spring.datasource.url</strong>	 				&#8594; Cadena de conexión con el origen de datos por defecto de la auto-configuración (Ej: jdbc:mysql://localhost/tet)</p>
</li>
<li>
<p><strong>spring.datasource.username</strong>	 			&#8594; Nombre de usuario para conectar al origen de datos por defecto de la auto-configuración (Ej: dbuser)</p>
</li>
<li>
<p><strong>spring.datasource.password</strong> 				&#8594; Password del usuario que se conecta al origen de datos por defecto de la auto-configuración (Ej: dbpass)</p>
</li>
<li>
<p><strong>spring.datasource.driver-class-name</strong>		&#8594; Driver a emplear para conectra con el origen de datos por defecto de la auto-configuración (Ej: com.mysql.jdbc.Driver)</p>
</li>
<li>
<p><strong>spring.datasource.jndi-name</strong> 			&#8594; Nombre JNDI del datasorce que se quiere emplear como origen de datos por defecto de la auto-configuración.</p>
</li>
<li>
<p><strong>spring.datasource.name</strong>					&#8594; El nombre del origen de datos</p>
</li>
<li>
<p><strong>spring.datasource.initialize</strong>			&#8594; Whether or not to populate using data.sql (default:true)</p>
</li>
<li>
<p><strong>spring.datasource.schema</strong> 				&#8594; The name of a schema (DDL) script resource</p>
</li>
<li>
<p><strong>spring.datasource.data</strong>					&#8594; The name of a data (DML) script resource</p>
</li>
<li>
<p><strong>spring.datasource.sql-script-encoding</strong>	&#8594; The character set for reading SQL scripts</p>
</li>
<li>
<p><strong>spring.datasource.platform</strong>				&#8594; The platform to use when reading the schema resource (for example, "schema-{platform}.sql")</p>
</li>
<li>
<p><strong>spring.datasource.continue-on-error</strong>		&#8594; Whether or not to continue if initialization fails (default: false)</p>
</li>
<li>
<p><strong>spring.datasource.separator</strong>				&#8594; The separator in the SQL scripts (default: ;)</p>
</li>
<li>
<p><strong>spring.datasource.max-active</strong>			&#8594; Maximum active connections (default: 100)</p>
</li>
<li>
<p><strong>spring.datasource.max-idle</strong>				&#8594; Maximum idle connections (default: 8)</p>
</li>
<li>
<p><strong>spring.datasource.min-idle</strong>				&#8594; Minimum idle connections (default: 8)</p>
</li>
<li>
<p><strong>spring.datasource.initial-size</strong>			&#8594; The initial size of the connection pool (default: 10)</p>
</li>
<li>
<p><strong>spring.datasource.validation-query</strong>		&#8594; A query to execute to verify the connection</p>
</li>
<li>
<p><strong>spring.datasource.test-on-borrow</strong>		&#8594; Whether or not to test a connection as it’s borrowed from the pool (default: false)</p>
</li>
<li>
<p><strong>spring.datasource.test-on-return</strong> 		&#8594; Whether or not to test a connection as it’s returned to the pool (default: false)</p>
</li>
<li>
<p><strong>spring.datasource.test-while-idle</strong>		&#8594; Whether or not to test a connection while it is idle (default: false)</p>
</li>
<li>
<p><strong>spring.datasource.max-wait</strong> 				&#8594; The maximum time (in milliseconds) that the pool will wait when no connections are available before failing (default: 30000)</p>
</li>
<li>
<p><strong>spring.datasource.jmx-enabled</strong> 			&#8594; Whether or not the data source is managed by JMX (default: false)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Solo se puede configurar un unico datasource por auto-configuración, para definir otro, se ha de definir el bean correspondiente</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_properties">Custom Properties</h4>
<div class="paragraph">
<p>Se puede definir nuevas propiedades y emplearlas en la aplicacióndentro de los Bean</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Para ello se ha de definir un atributo de clase que refleje la propiedad y su método de SET</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="predefined-type">String</span> prefijo;
<span class="directive">public</span> <span class="type">void</span> setPrefijo(<span class="predefined-type">String</span> prefijo) {
        <span class="local-variable">this</span>.prefijo = prefijo;
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Para las propiedades con nombre compuesto, se ha de configurar el prefijo con la anotación <strong>@ConfigurationProperties</strong> a nivel de clase</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Controller</span>
<span class="annotation">@RequestMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ConfigurationProperties</span>(prefix=<span class="string"><span class="delimiter">&quot;</span><span class="content">saludo</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HolaMundoController</span> {}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>Para que la funcionalidad de properties funcione, se debe añadir <strong>@EnableConfigurationProperties</strong>, pero con Spring Boot no es necesario, ya que está incluido por defecto.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jpa_2">JPA</h3>
<div class="paragraph">
<p>Al añadir el starter de JPA, por defecto Spring Boot va a localizar todos los Bean detro del paquete y subpaquetes donde se encuentra la clase anotada con <strong>@SpringBootApplication</strong> en busca de interfaces Repositorio, que extiendan la interface <strong>JpaRepository</strong>, de no encontrarse la interface que define el repositorio dentro del paquete o subapaquetes, se puede referenciar con <strong>@EnableJpaRepositories</strong></p>
</div>
<div class="paragraph">
<p>Cuando se emplea JPA con Hibernate como implementación, esté último tiene la posibilidad de configurar su comportamiento con respecto al schema de base de datos, pudiendo indicarle que lo cree, que lo actualice, que lo borre, que lo valide&#8230;&#8203; esto se consigue con la propiedad <strong>hibernate.ddl-auto</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="key">spring</span>:
<span class="error">        </span><span class="key">jpa</span>:
<span class="error">        </span><span class="error">        </span><span class="key">hibernate</span>:
<span class="error">        </span><span class="error">        </span><span class="error">        </span><span class="key">ddl-auto</span>: <span class="string"><span class="content">validate</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_profiles_2">Profiles</h3>
<div class="paragraph">
<p>Se pueden anotar <strong>@Bean</strong> con <strong>@Profile</strong>, para que dicho Bean sea solo añadido al contexto de Spring cuando el profile indicado esté activo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">production</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">DataSource</span> dataSource() {
        <span class="predefined-type">DataSource</span> ds = <span class="keyword">new</span> <span class="predefined-type">DataSource</span>();
        ds.setDriverClassName(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.mysql.Driver</span><span class="delimiter">&quot;</span></span>);
        ds.setUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:5432/test</span><span class="delimiter">&quot;</span></span>);
        ds.setUsername(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>);
        ds.setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">return</span> ds;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tambien se puede definir un conjunto de propiedades que solo se empleen si un perfil esta acivo, para ello, se ha de crear un nuevo fichero <strong>application-{profile}.properties</strong>.</p>
</div>
<div class="paragraph">
<p>En el caso de los ficheros de YAML, solo se define un fichero, el <strong>application.yml</strong>, y en el se definen todos los perfiles, separados por <strong>---</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="YAML"><span class="head"><span class="head">---</span></span>
<span class="key">spring</span>:
<span class="error">        </span><span class="key">profiles</span>: <span class="string"><span class="content">production</span></span>
<span class="error">        </span><span class="key">datasource</span>:
<span class="error">        </span><span class="error">        </span><span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://localhost:5432/test</span></span>
<span class="error">        </span><span class="error">        </span><span class="key">username</span>: <span class="string"><span class="content">admin</span></span>
<span class="error">        </span><span class="error">        </span><span class="key">password</span>: <span class="string"><span class="content">admin</span></span>
<span class="error">        </span><span class="error">        </span><span class="key">jpa</span>:
<span class="error">        </span><span class="error">        </span><span class="error">        </span><span class="key">database-platform</span>: <span class="string"><span class="content">org.hibernate.dialect.MySQLDialect</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Para activar un <strong>Profile</strong>, se emplea la propiedad <strong>spring.profiles.active</strong>, la cual puede establecerse como:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Variable de entorno</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">SET SPRING_PROFILES_ACTIVE=production;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Con un parametro de inicio</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">java -jar applicacion-0.0.1-SNAPSHOT.jar --spring.profiles.active=production</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_errores">Errores</h3>
<div class="paragraph">
<p>Por defecto Spring Boot proporciona una pagina para represenar los errores que se producen en las aplicaciones llamada <strong>whitelabel</strong>, para sustituirla por una personalizada, basta con definir alguno de los siguientes componentes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cuanlquier Bena que implemente <strong>View</strong> con Id <strong>error</strong>, que será resuelto por <strong>BeanNameViewResolver</strong>.</p>
</li>
<li>
<p>Plantilla <strong>Thymeleaf</strong> llamada <strong>error.html</strong> si <strong>Thymeleaf</strong> esta configurado.</p>
</li>
<li>
<p>Plantilla <strong>FreeMarker</strong> llamada <strong>error.ftl</strong> si <strong>FreeMarker</strong> esta configurado.</p>
</li>
<li>
<p>Plantilla <strong>Velocity</strong> llamada <strong>error.vm</strong> si <strong>Velocity</strong> esta configurado.</p>
</li>
<li>
<p>Plantilla <strong>JSP</strong> llamada <strong>error.jsp</strong> si se emplean vistas JSP.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Dentro de la vista, se puede acceder a la siguiente información relativa al error</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>timestamp</strong>	&#8594; La hora a la que ha ocurrido el error</p>
</li>
<li>
<p><strong>status</strong> 		&#8594; El código HTTP</p>
</li>
<li>
<p><strong>error</strong> 		&#8594; La causa del error</p>
</li>
<li>
<p><strong>exception</strong> 	&#8594; El nombre de la clase de la excepción.</p>
</li>
<li>
<p><strong>message</strong> 	&#8594; El mensaje del error</p>
</li>
<li>
<p><strong>errors</strong> 		&#8594; Los errores si hay mas de uno</p>
</li>
<li>
<p><strong>trace</strong> 		&#8594; La traza del error</p>
</li>
<li>
<p><strong>path</strong> 		&#8594; La URL a la que se accedia cuando se produjo el error.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_seguridad_de_las_aplicaciones">Seguridad de las aplicaciones</h3>
<div class="paragraph">
<p>Para añadir Spring security a un proyecto, habrá que añadir</p>
</div>
<div class="ulist">
<ul>
<li>
<p>En Maven</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>En Gradle</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-security</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Al añadir Spring Security al Classpath, automaticamente Spring Boot, hace que la aplicación sea segura, nada es accesible.</p>
</div>
<div class="paragraph">
<p>Se creará un usuario por defecto <strong>user</strong> cuyo password e generará cada vez que se arranque la aplicación y se pintará en el log</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="CONSOLE">Using default security password: ce9dadfa-4397-4a69-9fc7-af87e0580a10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Evidentemente esto es configurable, dado que cada aplicación, tendrá sus condiciones de seguridad, para establecer la configuración se puede añadir una nueva clase de configuración, anotada con <strong>@Configuration</strong> y además para que permita configurar la seguridad, debe estar anotada con <strong>@EnableWebSecurity</strong> y extender de <strong>WebSecurityConfigurerAdapter</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableWebSecurity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SecurityConfig</span> <span class="directive">extends</span> WebSecurityConfigurerAdapter {
        <span class="annotation">@Autowired</span>
        <span class="directive">private</span> ReaderRepository readerRepository;

        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">void</span> configure(HttpSecurity http) <span class="directive">throws</span> <span class="exception">Exception</span> {
                http
                        .authorizeRequests()
                        .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>).access(<span class="string"><span class="delimiter">&quot;</span><span class="content">hasRole('READER')</span><span class="delimiter">&quot;</span></span>)
                        .antMatchers(<span class="string"><span class="delimiter">&quot;</span><span class="content">/**</span><span class="delimiter">&quot;</span></span>).permitAll()
                        .and()
                        .formLogin()
                        .loginPage(<span class="string"><span class="delimiter">&quot;</span><span class="content">/login</span><span class="delimiter">&quot;</span></span>)
                        .failureUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">/login?error=true</span><span class="delimiter">&quot;</span></span>);
        }
        <span class="annotation">@Override</span>
        <span class="directive">protected</span> <span class="type">void</span> configure(AuthenticationManagerBuilder auth) <span class="directive">throws</span> <span class="exception">Exception</span> {
                auth
                        .userDetailsService(<span class="keyword">new</span> UserDetailsService() {
                                <span class="annotation">@Override</span>
                                <span class="directive">public</span> UserDetails loadUserByUsername(<span class="predefined-type">String</span> username) <span class="directive">throws</span> UsernameNotFoundException {
                                        <span class="keyword">return</span> readerRepository.findOne(username);
                                }
                        });
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>En esta clase, se puede configurar tanto los requisitos para acceder a recursos via web (autorización), como la vía de obtener los usuarios validos de la aplicación (autenticación), como otras configuraciones propias de la seguridad, como SSL, la pagina de login, &#8230;&#8203;</p>
</div>
</div>
<div class="sect2">
<h3 id="_soporte_jms">Soporte JMS</h3>
<div class="paragraph">
<p>Para emplear JMS de nuevo Spring Boot, proporciona un starter, en este caso para varias tecnologias: ActiveMQ, Artemis y HornetQ</p>
</div>
<div class="paragraph">
<p>Para añadir por ejemplo ActiveMQ, se añadirá a dependencia Maven</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
        <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
        <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-activemq<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Una vez Spring Boot encuentra en el classpath el jar de <strong>ActiveMQ</strong>, creará un Broker por defecto</p>
</div>
<div class="paragraph">
<p>Propiedades a configurar de ActiveMQ</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>spring.activemq.broker-url</strong>			&#8594; (Ej: tcp:/localhost:9876)</p>
</li>
<li>
<p><strong>spring.activemq.user</strong>				&#8594; (EJ: admin)</p>
</li>
<li>
<p><strong>spring.activemq.password</strong>			&#8594; (Ej: secret)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Añadir la anotacion <strong>@EnableJms</strong> a la clase de aplicación.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SpringBootApplication</span>
<span class="annotation">@EnableJms</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Application</span> {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Definición de los Bean que consumen los mensajes del servicio JMS</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Receiver</span> {
    <span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">mailbox</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> receiveMessage(Email email) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Received &lt;</span><span class="delimiter">&quot;</span></span> + email + <span class="string"><span class="delimiter">&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Definición de un Bean que envia mensajes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBean</span> {
    <span class="directive">private</span> <span class="directive">final</span> JmsTemplate jmsTemplate;
    <span class="annotation">@Autowired</span>
    <span class="directive">public</span> MyBean(JmsTemplate jmsTemplate) {
        <span class="local-variable">this</span>.jmsTemplate = jmsTemplate;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Se puede redefinir la factoria de contenedores</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Bean</span>
<span class="directive">public</span> JmsListenerContainerFactory&lt;?&gt; myFactory(ConnectionFactory connectionFactory,
                                                DefaultJmsListenerContainerFactoryConfigurer configurer) {
    DefaultJmsListenerContainerFactory factory = <span class="keyword">new</span> DefaultJmsListenerContainerFactory();
    <span class="comment">// This provides all boot's default to this factory, including the message converter</span>
    configurer.configure(factory, connectionFactory);
    <span class="comment">// You could still override some of Boot's default if necessary.</span>
    <span class="keyword">return</span> factory;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indicandolo posteriormente en los listener</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Component</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Receiver</span> {
    <span class="annotation">@JmsListener</span>(destination = <span class="string"><span class="delimiter">&quot;</span><span class="content">mailbox</span><span class="delimiter">&quot;</span></span>, containerFactory = <span class="string"><span class="delimiter">&quot;</span><span class="content">myFactory</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> receiveMessage(Email email) {
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Received &lt;</span><span class="delimiter">&quot;</span></span> + email + <span class="string"><span class="delimiter">&quot;</span><span class="content">&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-03-03 10:54:29 PST
</div>
</div>
</body>
</html>